{
  "$id": "https://civic-interconnect.github.io/ct-spec/en/spec/schemas/scenario.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ScenarioYaml",
  "type": "object",
  "required": ["topic", "window", "personas"],
  "properties": {
    "topic": { "type": "string" },

    "threat_type": {
      "anyOf": [
        { "type": "string", "enum": ["benign", "malicious", "mixed"] },
        { "type": "null" }
      ]
    },
    "threat_notes": { "type": ["string", "null"] },

    "window": {
      "type": "object",
      "required": ["start", "end"],
      "properties": {
        "start": { "type": "string", "format": "date-time" },
        "end": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": false
    },

    "notes": { "type": ["string", "null"] },

    "personas": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "name",
          "count",
          "acct_type",
          "automation_flag",
          "post_rate_per_hour",
          "active_hours",
          "acct_age_days"
        ],
        "properties": {
          "name": { "type": "string" },
          "count": { "type": "integer", "minimum": 1 },

          "acct_type": {
            "description": "Declared account type.",
            "allOf": [
              { "$ref": "https://civic-interconnect.github.io/ct-spec/en/spec/schemas/provenance_tag.schema.json#/$defs/AcctType" }
            ]
          },

          "automation_flag": {
            "description": "Posting method / automation status.",
            "allOf": [
              { "$ref": "https://civic-interconnect.github.io/ct-spec/en/spec/schemas/provenance_tag.schema.json#/$defs/AutomationFlag" }
            ]
          },

          "post_rate_per_hour": { "type": "number", "minimum": 0.0 },

          "active_hours": {
            "type": "array",
            "items": { "type": "integer", "minimum": 0, "maximum": 23 },
            "uniqueItems": true
          },

          "acct_age_days": {
            "type": "array",
            "items": { "type": "integer", "minimum": 0 },
            "minItems": 2,
            "maxItems": 2,
            "description": "Two integers: [min_days, max_days]."
          },

          "reshare_prob": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
          "c2pa_prob": { "type": "number", "minimum": 0.0, "maximum": 1.0 },

          "client_family_weights": {
            "type": "object",
            "description": "Weights (non-negative) by client family; consumers may normalize.",
            "propertyNames": {
              "$ref": "https://civic-interconnect.github.io/ct-spec/en/spec/schemas/provenance_tag.schema.json#/$defs/ClientFamily"
            },
            "additionalProperties": { "type": "number", "minimum": 0.0 }
          }
        },
        "additionalProperties": false
      }
    },

    "events": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["kind"],
        "properties": {
          "kind": { "type": "string", "enum": ["burst", "synchrony_wave"] },
          "start": { "type": "string", "format": "date-time" },
          "end": { "type": "string", "format": "date-time" },
          "center": { "type": "string", "format": "date-time" },
          "span_minutes": { "type": "integer", "minimum": 1 },
          "participation_rate": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
