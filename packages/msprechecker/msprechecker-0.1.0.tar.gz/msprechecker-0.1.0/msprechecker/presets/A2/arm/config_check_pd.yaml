conf/ms_controller.json:
  deploy_mode:
    expected:
      if: "${.deploy_mode} != 'pd_separate'}"
      then:
        type: eq
        value: "pd_disaggregation"  
      else: null
    reason: "多机PD分离场景下，deploy_mode应该是pd_separate或pd_disaggregation"
    severity: high
  tls_config:
    request_coordinator_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    request_server_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    http_server_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    cluster_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    etcd_server_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low

conf/ms_coordinator.json:
  digs_scheduler_config:
    deploy_mode:
      expected:
        if: "${.deploy_mode} != 'pd_separate'}"
        then:
          type: eq
          value: "pd_disaggregation"  
        else: null
      reason: "多机PD分离场景下，deploy_mode应该是pd_separate或pd_disaggregation"
      severity: high
  tls_config:
    controller_server_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    request_server_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    mindie_client_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    mindie_mangment_tls_enable:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low

conf/config.json:
  ServerConfig:
    httpsEnabled:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    inferMode:
      expected:
        type: eq
        value: "dmi"
      reason: "PD分离场景下，inferMode应该是dmi"
      severity: high
    interCommTLSEnabled:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
  BackendConfig:
    interNodeTLSEnabled:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    ModelDeployConfig:
      ModelConfig:
        - worldSize:
            expected:
              type: range
              value: [1, 8]
            reason: "Atlas 800I A2服务器上，worldSize取值范围为1到8，表示每个server示例用到卡数"
            severity: high
          tp:
            expected:
              type: eq
              value: ${conf/config.json.BackendConfig.ModelDeployConfig.ModelConfig[0].worldSize}
            reason: "PD分离场景下，tp需要等于worldSize"
            severity: high

deployment/mindie_server.yaml:
  - null
  - spec:
      replicas:
        expected:
          type: ">="
          value: 2
        reason: "表示拉起的pod数，因为至少存在一个P节点和一个D节点，不能小于2"
        severity: high
      template:
        spec:
          containers[0]:
            resources:
              requests:
                huawei.com/Ascend910:
                  expected:
                    type: eq
                    value: ${conf/config.json.BackendConfig.ModelDeployConfig.ModelConfig[0].worldSize}
                  reason: "Atlas 800I A2环境上，单机PD分离场景下，huawei.com/Ascend910应该等于mindie-server配置文件config.json中worldSize"
                  severity: high
              limits:
                huawei.com/Ascend910:
                  expected:
                    type: eq
                    value: ${conf/config.json.BackendConfig.ModelDeployConfig.ModelConfig[0].worldSize}
                  reason: "Atlas 800I A2环境上，单机PD分离场景下，huawei.com/Ascend910应该等于mindie-server配置文件config.json中worldSize"
                  severity: high