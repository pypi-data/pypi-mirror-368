{"version":3,"file":"redirect-DfjkTFaH.js","sources":["../../src/utils/redirect.ts"],"sourcesContent":["import { Router } from 'vue-router';\nimport { isUrl } from './url';\n\nfunction normalizePath(path: string): string {\n  return path.startsWith('/') ? path.slice(1) : path;\n}\n\ntype RedirectAction =\n  | {\n      action: 'REPLACE_LOCAL_HREF';\n      newHref: string;\n    }\n  | {\n      action: 'GOTO_FORM_EDITOR';\n      path: string;\n      queryParams: Record<string, string>;\n    }\n  | {\n      action: 'GOTO_FORM_PLAYER';\n      path: string;\n      queryParams: Record<string, string>;\n    };\n\nexport function redirectAction(\n  environment: 'editor' | 'preview' | 'player',\n  url: string,\n  queryParams: Record<string, string> = {},\n): RedirectAction {\n  if (isUrl(url)) {\n    const _url = new URL(url);\n    const search1 = new URLSearchParams(queryParams);\n    const search2 = new URLSearchParams(_url.search);\n    const search = new URLSearchParams([...search2, ...search1]);\n    _url.search = search.toString();\n\n    return {\n      action: 'REPLACE_LOCAL_HREF',\n      newHref: _url.toString(),\n    };\n  } else {\n    const path = url.replace(/\\/$/, '');\n    if (environment === 'player') {\n      return {\n        action: 'GOTO_FORM_PLAYER',\n        path: normalizePath(path),\n        queryParams,\n      };\n    } else if (environment === 'editor') {\n      return {\n        action: 'GOTO_FORM_EDITOR',\n        path: normalizePath(path),\n        queryParams,\n      };\n    } else if (environment === 'preview') {\n      return {\n        action: 'GOTO_FORM_PLAYER',\n        path: normalizePath(path),\n        queryParams,\n      };\n    } else {\n      throw new Error(`Invalid routing ${environment}`);\n    }\n  }\n}\n\nexport async function redirect(\n  environment: 'editor' | 'preview' | 'player',\n  router: Router,\n  url: string,\n  queryParams: Record<string, string> = {},\n): Promise<void> {\n  const action = redirectAction(environment, url, queryParams);\n\n  switch (action.action) {\n    case 'REPLACE_LOCAL_HREF':\n      window.location.href = action.newHref;\n      break;\n    case 'GOTO_FORM_EDITOR':\n      await router.push({\n        name: 'formEditor',\n        params: {\n          formPath: action.path,\n        },\n        query: action.queryParams,\n      });\n      break;\n    case 'GOTO_FORM_PLAYER':\n      await router.push({\n        name: environment === 'preview' ? 'formPreview' : 'formPlayer',\n        params: {\n          formPath: action.path,\n        },\n        query: action.queryParams,\n      });\n      break;\n    default:\n      throw new Error('Invalid routing');\n  }\n}\n"],"names":["normalizePath","path","redirectAction","environment","url","queryParams","isUrl","_url","search1","search2","search","redirect","router","action"],"mappings":"kYAGA,SAASA,EAAcC,EAAsB,CAC3C,OAAOA,EAAK,WAAW,GAAG,EAAIA,EAAK,MAAM,CAAC,EAAIA,CAChD,CAkBO,SAASC,EACdC,EACAC,EACAC,EAAsC,CAAA,EACtB,CAChB,GAAIC,EAAMF,CAAG,EAAG,CACd,MAAMG,EAAO,IAAI,IAAIH,CAAG,EAClBI,EAAU,IAAI,gBAAgBH,CAAW,EACzCI,EAAU,IAAI,gBAAgBF,EAAK,MAAM,EACzCG,EAAS,IAAI,gBAAgB,CAAC,GAAGD,EAAS,GAAGD,CAAO,CAAC,EAC3D,OAAAD,EAAK,OAASG,EAAO,SAAA,EAEd,CACL,OAAQ,qBACR,QAASH,EAAK,SAAA,CAAS,CAE3B,KAAO,CACL,MAAMN,EAAOG,EAAI,QAAQ,MAAO,EAAE,EAClC,GAAID,IAAgB,SAClB,MAAO,CACL,OAAQ,mBACR,KAAMH,EAAcC,CAAI,EACxB,YAAAI,CAAA,EAEJ,GAAWF,IAAgB,SACzB,MAAO,CACL,OAAQ,mBACR,KAAMH,EAAcC,CAAI,EACxB,YAAAI,CAAA,EAEJ,GAAWF,IAAgB,UACzB,MAAO,CACL,OAAQ,mBACR,KAAMH,EAAcC,CAAI,EACxB,YAAAI,CAAA,EAGF,MAAM,IAAI,MAAM,mBAAmBF,CAAW,EAAE,CAEpD,CACF,CAEA,eAAsBQ,EACpBR,EACAS,EACAR,EACAC,EAAsC,CAAA,EACvB,CACf,MAAMQ,EAASX,EAAeC,EAAaC,EAAKC,CAAW,EAE3D,OAAQQ,EAAO,OAAA,CACb,IAAK,qBACH,OAAO,SAAS,KAAOA,EAAO,QAC9B,MACF,IAAK,mBACH,MAAMD,EAAO,KAAK,CAChB,KAAM,aACN,OAAQ,CACN,SAAUC,EAAO,IAAA,EAEnB,MAAOA,EAAO,WAAA,CACf,EACD,MACF,IAAK,mBACH,MAAMD,EAAO,KAAK,CAChB,KAAMT,IAAgB,UAAY,cAAgB,aAClD,OAAQ,CACN,SAAUU,EAAO,IAAA,EAEnB,MAAOA,EAAO,WAAA,CACf,EACD,MACF,QACE,MAAM,IAAI,MAAM,iBAAiB,CAAA,CAEvC"}