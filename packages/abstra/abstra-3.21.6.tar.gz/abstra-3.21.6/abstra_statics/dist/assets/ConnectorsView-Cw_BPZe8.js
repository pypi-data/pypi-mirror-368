import{_ as V}from"./DocsButton.vue_vue_type_script_setup_true_lang-BnwqPwfA.js";import{_ as E}from"./AbstraButton.vue_vue_type_script_setup_true_lang-D-iosY4j.js";import{r as M,e as T,O as b,d as N,B as f,m as c,G as o,g as a,D as e,M as d,p as y,b0 as q,$ as l,Z as h,V as _,aG as B,ap as A,S as L,l as C,Y as I,aq as j,F as m,U as $,b1 as O,b2 as z,b3 as S,q as D,al as G,bQ as P,aJ as F,bm as R,bn as Y}from"./jwt-decode.esm-Dca5fHH5.js";import{G as J}from"./PhDotsThreeVertical.vue-B1x6I4wD.js";import{C as v,a as Q}from"./router-D5wfdag3.js";import{A as U}from"./index-BLK1I0IS.js";import{C as x}from"./index-mvr8okoq.js";import{S as Z}from"./index-ZQBk4l6i.js";import"./constants-B1LrRAnj.js";import"./index-Cyx2lZTa.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="1263b564-55db-4687-8f39-09c9da4fd48e",r._sentryDebugIdIdentifier="sentry-dbid-1263b564-55db-4687-8f39-09c9da4fd48e")}catch{}})();class H{async getLoginUrl(t,i,n,g){return v.get(`projects/${t}/connectors/${n}/connections/${i}/login-url`,{scopeIds:g.join(",")})}async listConnectors(t){return v.get(`projects/${t}/connectors`)}async listConnections(t){return v.get(`projects/${t}/connections`)}async deleteConnection(t){const{projectId:i,connectionName:n,connectorType:g}=t;return v.delete(`projects/${i}/connectors/${g}/connections/${n}`)}async renameConnection(t){const{projectId:i,connectionName:n,connectorType:g,newConnectionName:k}=t;return v.patch(`projects/${i}/connectors/${g}/connections/${n}`,{newConnectionName:k})}}class K{constructor(t,i){this.projectId=t,this.api=i,this.state=M({connectors:[],connections:[],addingConnection:null,editingConnection:null})}state;hasChanges=T(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName);async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){this.state.value.connections=(await this.api.listConnections(this.projectId)).map(t=>{const i=this.state.value.connectors.find(n=>n.type===t.connectorType);if(!i)throw new Error(`Unknown connector type: ${t.connectorType}`);return{name:t.name,connectorTitle:i.title,connectorType:t.connectorType,icon:i.logoUrl}})}handleDeletionClick=async t=>{b.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(t)})};handleDeleteConnection=async t=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()};handleEditConnectionClick(t){this.state.value.editingConnection={...t,newName:t.name}}async getLoginUrl(t,i,n){return this.api.getLoginUrl(this.projectId,i,t,n)}slugify(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(t){const i=this.state.value.connections.filter(n=>n.connectorType===t).length;return i===0?t:`${t}-${i}`}handleAddConnectionSubmit=async()=>{const t=this.state.value.addingConnection?.connector.type,i=this.state.value.addingConnection?.selectedScopeIds;if(!t||!i)throw new Error("No connector or scope selected");const{url:n}=await this.getLoginUrl(t,this.getUniqueName(t),i);window.location.href=n};renameConnection=async()=>{const{editingConnection:t}=this.state.value;if(!t)throw new Error("No connection is being edited");const i=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType,newConnectionName:t.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};b.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:i})};showAddConfirmationModal=t=>{this.state.value.addingConnection={selectedScopeIds:t.scopes.map(i=>i.id),connector:t}};handleScopeToggle=(t,i)=>{i?this.state.value.addingConnection.selectedScopeIds.push(t):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==t)}}const W=N({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean}},setup(r){return(t,i)=>(c(),f(e(x),{class:B({"connector-card":!0,unavailable:t.unavailable})},{default:o(()=>[a(e(d),{style:{width:"100%"},vertical:"",gap:12},{default:o(()=>[a(e(d),{justify:"space-between"},{default:o(()=>[a(e(U),{src:t.logoUrl,shape:"square",size:"large"},null,8,["src"]),t.unavailable?(c(),f(e(q),{key:0,style:{height:"fit-content"}},{default:o(()=>[l("Talk to us")]),_:1})):y("",!0)]),_:1}),a(e(d),{vertical:""},{default:o(()=>[a(e(h),{strong:""},{default:o(()=>[l(_(t.title),1)]),_:1}),a(e(h),{type:"secondary"},{default:o(()=>[l(_(t.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}}),X=A(W,[["__scopeId","data-v-e3719550"]]),ee=r=>(R("data-v-40b20da6"),r=r(),Y(),r),te=ee(()=>D("div",{style:{"flex-grow":"1"}},null,-1)),ne={class:"connectors-grid"},oe=N({__name:"ConnectorsView",setup(r){const i=L().params.projectId,n=new K(i,new H),g=T(()=>[...n.state.value.connectors.filter(u=>!u.unavailable),...n.state.value.connectors.filter(u=>u.unavailable)]);n.fetchInitialState();function k(u){u.unavailable?Q.showNewMessage(F.translate("i18n_connectors_ask_for_access",null,u.title)):n.showAddConfirmationModal(u)}return(u,p)=>(c(),C(m,null,[a(e(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:o(()=>[a(e(d),{align:"center",justify:"space-between"},{default:o(()=>[a(e(I),null,{default:o(()=>[l("Connectors")]),_:1})]),_:1}),a(e(j),null,{default:o(()=>[l(" Add and manage external integrations to your project. "),a(V)]),_:1}),e(n).state.value.connections.length?(c(),f(e(d),{key:0,vertical:""},{default:o(()=>[a(e(I),{level:2},{default:o(()=>[l("Installed")]),_:1}),a(e(d),{vertical:"",gap:10},{default:o(()=>[(c(!0),C(m,null,$(e(n).state.value.connections,s=>(c(),f(e(x),{key:s.name},{default:o(()=>[a(e(d),{align:"center",gap:20},{default:o(()=>[a(e(U),{src:s.icon,height:"40px",shape:"square"},null,8,["src"]),a(e(h),{strong:""},{default:o(()=>[l(_(s.connectorTitle),1)]),_:2},1024),te,a(e(h),{content:s.name,copyable:"",code:""},null,8,["content"]),a(e(O),null,{overlay:o(()=>[a(e(z),null,{default:o(()=>[a(e(S),{onClick:w=>e(n).handleEditConnectionClick(s)},{default:o(()=>[l(" Rename ")]),_:2},1032,["onClick"]),a(e(S),{danger:"",onClick:w=>e(n).handleDeletionClick(s)},{default:o(()=>[l(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[a(e(J))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):y("",!0),a(e(d),{vertical:""},{default:o(()=>[e(n).state.value.connections.length?(c(),f(e(I),{key:0,level:2},{default:o(()=>[l("Available")]),_:1})):y("",!0),D("div",ne,[(c(!0),C(m,null,$(g.value,s=>(c(),f(X,{key:s.type,title:s.title,"logo-url":s.logoUrl,description:s.description,unavailable:s.unavailable,onClick:w=>k(s)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})]),_:1}),a(e(b),{open:!!e(n).state.value.editingConnection,title:`${e(n).state.value.editingConnection?.connectorTitle} Connection`,onCancel:p[2]||(p[2]=s=>e(n).state.value.editingConnection=null)},{footer:o(()=>[a(e(d),{justify:"end"},{default:o(()=>[a(E,{disabled:!e(n).hasChanges.value,onClick:p[1]||(p[1]=s=>e(n).renameConnection())},{default:o(()=>[l(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:o(()=>[e(n).state.value.editingConnection?(c(),f(e(G),{key:0,value:e(n).state.value.editingConnection.newName,"onUpdate:value":p[0]||(p[0]=s=>e(n).state.value.editingConnection.newName=s)},null,8,["value"])):y("",!0)]),_:1},8,["open","title"]),a(e(b),{open:!!e(n).state.value.addingConnection,title:`Add ${e(n).state.value.addingConnection?.connector.title} Connection`,"ok-text":"Authorize","wrap-class-name":"full-modal",onCancel:p[3]||(p[3]=s=>e(n).state.value.addingConnection=null),onOk:e(n).handleAddConnectionSubmit},{default:o(()=>[e(n).state.value.addingConnection?(c(),C(m,{key:0},[a(e(j),null,{default:o(()=>[l(" Please select the scopes you want to authorize for this connection. You can change these later by deleting and re-adding the connection. ")]),_:1}),a(e(d),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:o(()=>[(c(!0),C(m,null,$(e(n).state.value.addingConnection.connector.scopes,s=>(c(),f(e(d),{key:s.id,justify:"space-between",align:"center"},{default:o(()=>[a(e(d),{vertical:""},{default:o(()=>[a(e(h),null,{default:o(()=>[l(_(s.description),1)]),_:2},1024),a(e(h),{type:"secondary"},{default:o(()=>[l(_(s.id),1)]),_:2},1024)]),_:2},1024),a(e(P),{checked:e(n).state.value.addingConnection.selectedScopeIds.includes(s.id),onChange:w=>e(n).handleScopeToggle(s.id,w)},null,8,["checked","onChange"])]),_:2},1024))),128))]),_:1})],64)):y("",!0)]),_:1},8,["open","title","onOk"])],64))}}),ge=A(oe,[["__scopeId","data-v-40b20da6"]]);export{ge as default};
//# sourceMappingURL=ConnectorsView-Cw_BPZe8.js.map
