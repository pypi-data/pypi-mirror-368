import{g as l,I as F,d as L,e as N,X as M,aM as V,l as v,m as d,F as I,G as a,D as e,ak as k,aQ as O,aj as E,aP as U,Z as C,$ as y,B as f,p as x,bp as J,M as j,aH as G,aI as H,V as A,b0 as Q,b8 as X,a_ as Y,bc as Z,S as q,Y as W}from"./jwt-decode.esm-Dca5fHH5.js";import{_ as K}from"./AbstraButton.vue_vue_type_script_setup_true_lang-D-iosY4j.js";import{I as ee}from"./PhCopy.vue-DigtJVV6.js";import{T as te,R as ae}from"./tasksController-BZzAjAcg.js";import{s as le}from"./metadata-CdAmAdig.js";import{t as ne}from"./ant-design-12Ybi1Rk.js";import{c as re}from"./string-BYR4BIXr.js";import{R as se}from"./dayjs-C3kKJZJG.js";import{d as z,c as S}from"./router-D5wfdag3.js";import{a as oe,b as ie}from"./build-B7ZDvyug.js";import{P as de}from"./project-BZzoNeQM.js";import"./tables-BsqTY_wE.js";import{a as ue}from"./asyncComputed-IJY6wgme.js";import"./linters-DMK5Dyyj.js";import"./record-BZIfMWML.js";import"./polling-CKeyL76l.js";import"./PhWebhooksLogo.vue-JOavTArk.js";import"./index-Cyx2lZTa.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[o]="c99bf677-7b10-4405-abe4-2b55bbb23433",s._sentryDebugIdIdentifier="sentry-dbid-c99bf677-7b10-4405-abe4-2b55bbb23433")}catch{}})();var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function P(s){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?Object(arguments[o]):{},g=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(n).filter(function(p){return Object.getOwnPropertyDescriptor(n,p).enumerable}))),g.forEach(function(p){ce(s,p,n[p])})}return s}function ce(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}var D=function(o,n){var g=P({},o,n.attrs);return l(F,P({},g,{icon:pe}),null)};D.displayName="SyncOutlined";D.inheritAttrs=!1;const fe={key:4,style:{"min-width":"100px"}},ge=L({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean}},setup(s,{expose:o}){const n=s,{setup:g,tearDown:p,state:r,getColumns:m,fetchTasks:b,clearAllTasks:T}=te({api:n.api,poll:!0,stages:n.stages}),w=t=>t.dataIndex===void 0&&"children"in t&&Array.isArray(t.children)&&t.children.length===0,h=N(()=>n.stages?r.tasks.map(t=>{const u=n.stages?.find(i=>i.id===t.targetStageId);return u?{...t,targetStageTitle:u.stageTitle,targetStageType:u.stageType,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1}:{...t,targetStageTitle:null,targetStageType:null,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!0}}):r.tasks.map(t=>({...t,deleted:!1,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString()}))),R=(t,u,i)=>{const _=t.current??1,c=t.pageSize??10;r.pagination.currentIndex=_-1,r.pagination.pageSize=c,b()},B=(t,u)=>`/_editor/${t}/${u}`,$=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),Z.success({content:"Copied to clipboard"})};return o({clearAllTasks:T}),M(()=>g()),V(()=>p()),(t,u)=>(d(),v(I,null,[l(e(E),{layout:"vertical"},{default:a(()=>[l(e(z),{gutter:10},{default:a(()=>[l(e(S),{span:10},{default:a(()=>[l(e(k),{label:"Stage"},{default:a(()=>[l(e(O),{value:e(r).filters.stage,"onUpdate:value":u[0]||(u[0]=i=>e(r).filters.stage=i),options:e(r).filterOptions.stages,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),l(e(S),{span:6},{default:a(()=>[l(e(k),{label:"Status"},{default:a(()=>[l(e(O),{value:e(r).filters.status,"onUpdate:value":u[1]||(u[1]=i=>e(r).filters.status=i),options:e(r).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),l(e(S),{span:8},{default:a(()=>[l(e(k),{label:"Created at date"},{default:a(()=>[l(e(se),{value:e(r).filters.dateRange,"onUpdate:value":u[2]||(u[2]=i=>e(r).filters.dateRange=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(e(Y),{columns:e(m)(),"data-source":h.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(r).pagination.currentIndex+1,pageSize:e(r).pagination.pageSize,total:e(r).pagination.totalCount},onChange:R},{bodyCell:a(({column:i,text:_,record:c})=>[i.key==="payload"?(d(),f(e(J),{key:0,"tree-data":e(ne)(c.payload),selectable:!1},null,8,["tree-data"])):i.key==="targetStageTitle"?(d(),v(I,{key:1},[c.deleted?(d(),f(e(C),{key:0},{default:a(()=>[y("Not found")]),_:1})):(d(),f(e(j),{key:1,gap:"small",justify:"center"},{default:a(()=>[(d(),f(G(e(le)(c.targetStageType)),{size:"20"})),t.editor?(d(),f(e(H),{key:0,href:B(c.targetStageType,c.targetStageId)},{default:a(()=>[y(A(c.targetStageTitle),1)]),_:2},1032,["href"])):(d(),f(e(C),{key:1},{default:a(()=>[y(A(c.targetStageTitle),1)]),_:2},1024))]),_:2},1024))],64)):i.dataIndex==="status"?(d(),f(e(j),{key:2,gap:"small",justify:"center"},{default:a(()=>[l(e(Q),null,{default:a(()=>[y(A(e(re)(String(_)))+" ",1),_==="started"?(d(),f(e(D),{key:0,spin:!0,style:{"margin-left":"4px"}})):x("",!0)]),_:2},1024)]),_:2},1024)):i.dataIndex==="actions"?(d(),f(K,{key:3,type:"text",size:"small",tooltip:"Copy Payload Data",onClick:X(me=>$(c.payload),["stop"])},{default:a(()=>[l(e(ee))]),_:2},1032,["onClick"])):w(i)?(d(),v("div",fe)):x("",!0)]),footer:a(()=>[l(e(z),{justify:"end",gutter:10},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(U),{size:"small"})]),_:1}),l(e(S),null,{default:a(()=>[l(e(C),null,{default:a(()=>[y(" auto updating ")]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Le=L({__name:"Tasks",setup(s){const n=q().params.projectId,g=new ae(n),{result:p}=ue(async()=>{const b=(await oe.list(n)).find(h=>h.latest);if(!b)return null;const[T,w]=await Promise.all([ie.get(b.id),de.get(n)]);return{buildSpec:T,project:w}}),r=N(()=>!p.value||!p.value.buildSpec?null:p.value.buildSpec.runtimes.map(m=>({id:m.id,stageTitle:m.title,stageType:m.type})));return(m,b)=>(d(),v(I,null,[l(e(W),null,{default:a(()=>[y("Tasks")]),_:1}),r.value?(d(),f(ge,{key:0,class:"tasks",api:e(g),stages:r.value},null,8,["api","stages"])):x("",!0)],64))}});export{Le as default};
//# sourceMappingURL=Tasks-yFjrkinr.js.map
