import{_ as te}from"./DocsButton.vue_vue_type_script_setup_true_lang-BnwqPwfA.js";import{C as ne}from"./ContentLayout-SexkWDKT.js";import{g as u,I as C,ci as re,cj as ae,d as X,e as B,r as L,l as I,m as c,D as i,bl as oe,G as d,B as p,p as h,aq as Z,q as S,$ as b,V as T,ck as le,H as M,M as ie,cl as se,n as K,aH as ue,b1 as ce,b8 as de,b2 as fe,b3 as j,ba as pe,au as N,ap as ee,S as me,Y as he,bm as ye,bn as be}from"./jwt-decode.esm-Dca5fHH5.js";import{C as _,p as ve}from"./router-D5wfdag3.js";import{a as ge}from"./ant-design-12Ybi1Rk.js";import{f as Oe,I as we,G as Pe,D as Fe,_ as je,a as V,s as _e}from"./files-BlaoayzA.js";import{f as q}from"./string-BYR4BIXr.js";import{G as Ce}from"./PhFolder.vue-zXTy4Frb.js";import{a as ke}from"./asyncComputed-IJY6wgme.js";import"./tables-BsqTY_wE.js";import"./constants-B1LrRAnj.js";import"./index-Cyx2lZTa.js";import"./record-BZIfMWML.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="efcf8563-1e2b-48de-a506-858aaa148021",r._sentryDebugIdIdentifier="sentry-dbid-efcf8563-1e2b-48de-a506-858aaa148021")}catch{}})();var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"},De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"},Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function x(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),o.forEach(function(s){Ne(r,s,t[s])})}return r}function Ne(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var H=function(e,t){var o=x({},e,t.attrs);return u(C,x({},o,{icon:re}),null)};H.displayName="DeleteOutlined";H.inheritAttrs=!1;function Y(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),o.forEach(function(s){Se(r,s,t[s])})}return r}function Se(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var R=function(e,t){var o=Y({},e,t.attrs);return u(C,Y({},o,{icon:ae}),null)};R.displayName="EditOutlined";R.inheritAttrs=!1;function J(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),o.forEach(function(s){ze(r,s,t[s])})}return r}function ze(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var z=function(e,t){var o=J({},e,t.attrs);return u(C,J({},o,{icon:$e}),null)};z.displayName="FileAddOutlined";z.inheritAttrs=!1;function Q(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),o.forEach(function(s){Ae(r,s,t[s])})}return r}function Ae(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var U=function(e,t){var o=Q({},e,t.attrs);return u(C,Q({},o,{icon:De}),null)};U.displayName="FolderAddOutlined";U.inheritAttrs=!1;function W(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),o.forEach(function(s){Ee(r,s,t[s])})}return r}function Ee(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var A=function(e,t){var o=W({},e,t.attrs);return u(C,W({},o,{icon:Ie}),null)};A.displayName="UploadOutlined";A.inheritAttrs=!1;class G{constructor(e){this.projectId=e}static fromProjectId(e){return new G(e)}async list(){return _.get(`projects/${this.projectId}/files`)}async upload(e,t){const o={"Content-Type":"multipart/form-data"},s=new File([new Blob(t?[t]:[])],Oe(e));return _.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,s,o)}async download(e){return _.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return _.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,t){return _.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(t)}`,{})}}const Me={class:"files-navigator"},Ve={key:0},Be={key:1},He={key:0,class:"file-size"},Re=X({__name:"FilesNavigator",props:{files:{},loading:{type:Boolean},onCreate:{type:Function},onDownload:{type:Function},onDelete:{type:Function},onRefetch:{type:Function},onRename:{type:Function},onOpen:{type:Function},onMkdir:{type:Function},separator:{}},setup(r){const e=r,t=n=>a=>({key:a.pathParts.join(e.separator),title:n.keepFullPath?a.pathParts.join(e.separator):V(a.pathParts),isLeaf:a.type==="file",file:a,children:n.keepFullPath?void 0:a.children?.map(l=>{const f=e.files?.find(g=>g.pathParts.join(e.separator)===l.join(e.separator));if(!f)throw new Error("Child node not found");return t({keepFullPath:n.keepFullPath})(f)})??[]}),o=n=>{if(!O.value.trim())return N("span",n);const a=q(O.value,n);return a?N("span",n.split("").map((l,f)=>a.includes(f)?N("span",{class:"char-match"},l):l)):N("span",n)},s=n=>{if(n.type==="directory")return"";const a=n.size;if(a<1024)return`${a} B`;const l=a/1024;if(l<1024)return`${l.toFixed(2)} KB`;const f=l/1024;return f<1024?`${f.toFixed(2)} MB`:`${(f/1024).toFixed(2)} GB`},w=B(()=>O.value.trim()?e.files?.filter(n=>n.pathParts.length===1&&q(O.value,n.pathParts.join(e.separator))).map(t({keepFullPath:!0})):e.files?.filter(n=>n.pathParts.length===1).map(t({keepFullPath:!1}))),F=n=>n.isLeaf?1:n.children?.reduce((a,l)=>a+F(l),0)??0,P=B(()=>w.value?w?.value.reduce((n,a)=>n+F(a),0):0),k=L(!1);function $(n){if(n&&n.type==="file")return;const a=document.createElement("input");a.type="file",a.onchange=async()=>{const l=a.files?.[0],f=await l?.arrayBuffer();if(l)try{k.value=!0,await e.onCreate?.([...n?.pathParts??[],l.name??"Untitled file"],f?new Uint8Array(f):void 0),await e.onRefetch?.()}catch{ve("Failed to upload file","File already exists")}finally{k.value=!1}},a.click()}function D(n){if(n&&n.type==="file")return;const a=prompt("Enter the name of the new file");if(!a)return;const l=n?[...n.pathParts,a]:[a];e.onCreate?.(l)}async function E(n){if(!n||!e.onDownload)return;const a=await e.onDownload(n.pathParts),l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=V(n.pathParts),l.click()}async function v(n){if(!n)return;const a="Are you sure you want to delete this "+(n.type==="file"?"file":"directory and all its contents")+"?";await ge(a)&&(await e.onDelete?.(n.pathParts),await e.onRefetch?.())}async function y(n){if(!n)return;const a=prompt("Enter the new name of the file",V(n.pathParts));if(!a)return;const l=[...n.pathParts.slice(0,-1),a];await e.onRename?.(n.pathParts,l),await e.onRefetch?.()}async function m(n){const a=prompt("Enter the name of the new folder");if(!a)return;const l=[a];e.onMkdir?.(l)}const O=L("");return(n,a)=>(c(),I("div",Me,[u(i(oe),{value:O.value,"onUpdate:value":a[0]||(a[0]=l=>O.value=l),loading:e.loading,placeholder:"Search files"},null,8,["value","loading"]),u(i(ie),{justify:"space-between"},{default:d(()=>[P.value>0?(c(),p(i(Z),{key:0},{default:d(()=>[S("b",null,[b(T(P.value)+" File",1),P.value!==1?(c(),I("span",Ve,"s")):h("",!0),O.value?(c(),I("span",Be," found ")):h("",!0)])]),_:1})):h("",!0),n.loading?h("",!0):(c(),p(i(le),{key:1},{default:d(()=>[n.onCreate?(c(),p(i(M),{key:0,onClick:a[1]||(a[1]=()=>D())},{default:d(()=>[u(i(z)),b(" New File ")]),_:1})):h("",!0),n.onCreate?(c(),p(i(M),{key:1,onClick:a[2]||(a[2]=()=>$())},{default:d(()=>[u(i(A)),b(" Upload ")]),_:1})):h("",!0),n.onMkdir?(c(),p(i(M),{key:2,onClick:a[3]||(a[3]=()=>m())},{default:d(()=>[u(i(U)),b(" New Folder ")]),_:1})):h("",!0)]),_:1}))]),_:1}),u(je,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:d(()=>[w.value&&w.value.length>0?(c(),p(i(se),{key:0,class:"files-tree","tree-data":w.value,selectable:"",onSelect:a[5]||(a[5]=(l,{node:{file:f}})=>e.onOpen?.(f.pathParts))},{title:d(({title:l,isLeaf:f,file:g})=>[S("span",null,[(c(),p(ue(o(l)))),f?(c(),I("span",He,"("+T(s(g))+")",1)):h("",!0)]),u(i(ce),{onClick:a[4]||(a[4]=de(()=>{},["stop"]))},{overlay:d(()=>[u(i(fe),{disabled:n.loading},{default:d(()=>[f&&n.onDownload?(c(),p(i(j),{key:0,onClick:()=>E(g)},{default:d(()=>[u(i(Fe)),b(" Download ")]),_:2},1032,["onClick"])):h("",!0),n.onRename?(c(),p(i(j),{key:1,onClick:()=>y(g)},{default:d(()=>[u(i(R)),b(" Rename ")]),_:2},1032,["onClick"])):h("",!0),!f&&n.onCreate?(c(),p(i(j),{key:2,onClick:()=>D(g)},{default:d(()=>[u(i(z)),b(" New File ")]),_:2},1032,["onClick"])):h("",!0),n.onCreate?(c(),p(i(j),{key:3,loading:n.loading,onClick:()=>$(g)},{default:d(()=>[u(i(A)),b(" Upload ")]),_:2},1032,["loading","onClick"])):h("",!0),n.onDelete?(c(),p(i(j),{key:4,danger:"",onClick:()=>v(g)},{default:d(()=>[u(i(H)),b(" Delete ")]),_:2},1032,["onClick"])):h("",!0)]),_:2},1032,["disabled"])]),default:d(()=>[u(i(Pe),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024)]),icon:d(({file:l})=>[K(n.$slots,"icon",{file:l},()=>[l.type==="directory"?(c(),p(i(Ce),{key:0})):(c(),p(i(we),{key:1}))],!0)]),_:3},8,["tree-data"])):(c(),p(i(pe),{key:1,description:n.loading?"Loading...":"No files"},null,8,["description"]))]),_:3})]))}}),Ue=ee(Re,[["__scopeId","data-v-e1f4fc13"]]),Ge=r=>(ye("data-v-4b0cf5fc"),r=r(),be(),r),Le={class:"files-layout"},Te=Ge(()=>S("br",null,null,-1)),qe=X({__name:"Files",setup(r){const t=me().params.projectId,o=G.fromProjectId(t),{loading:s,result:w,refetch:F}=ke(()=>o.list()),P=v=>v.reduce((y,m)=>{const O=m.type==="file"?[]:m.children?.map(a=>a.path.split("/"))??[],n={pathParts:m.path.split("/"),size:m.type==="file"?_e(m.size):0,lastModified:m.date,type:m.type,children:O};if(y.push(n),m.type==="directory"&&m.children&&m.children.length>0){const a=P(m.children);y.push(...a)}return y},[]),k=B(()=>w.value?P(w.value):[]);async function $(v,y){const m=v.join("/");await o.upload(m,y),await F()}function D(v){const y=v.join("/");return o.download(y)}function E(v){const y=v.join("/");return o.delete(y)}return(v,y)=>(c(),p(ne,null,{default:d(()=>[S("div",Le,[u(i(he),null,{default:d(()=>[b("Files")]),_:1}),u(i(Z),null,{default:d(()=>[b(" Here you can upload, download and delete files in your persistent dir."),Te,b(" Files can be used in your scripts. "),u(te,{path:"tools/files"}),K(v.$slots,"description",{},void 0,!0)]),_:3}),u(Ue,{files:k.value,loading:i(s),separator:"/",onCreate:$,onDownload:D,onDelete:E,onRefetch:i(F)},null,8,["files","loading","onRefetch"])])]),_:3}))}}),ot=ee(qe,[["__scopeId","data-v-4b0cf5fc"]]);export{ot as default};
//# sourceMappingURL=Files-CJ0_vt1o.js.map
