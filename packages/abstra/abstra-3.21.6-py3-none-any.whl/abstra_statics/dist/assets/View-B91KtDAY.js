import{a as V}from"./asyncComputed-IJY6wgme.js";import{d as b,r as E,B as g,m,D as a,M as pe,G as n,g as r,c9 as me,ca as G,$ as h,aQ as L,H as _,aK as j,aj as S,ak as w,al as T,e as Y,l as Z,F as H,U as ye,b0 as fe,V as ge,an as Q,aY as X,S as he,X as ve,p as A,Y as _e,aq as we}from"./jwt-decode.esm-Dca5fHH5.js";import{S as R}from"./index-ZQBk4l6i.js";import{_ as be}from"./DocsButton.vue_vue_type_script_setup_true_lang-BnwqPwfA.js";import{A as N}from"./index-tjv1V0Nf.js";import{C as J}from"./CrudView-wZnp03a2.js";import{G as W}from"./PhPencil.vue-DCNvh_hA.js";import{C as Ce}from"./repository-DLftv6Us.js";import{C as U,p as k}from"./router-D5wfdag3.js";import{E as ee}from"./record-BZIfMWML.js";import{a as M}from"./ant-design-12Ybi1Rk.js";import{A as z,T as ke}from"./index-mvr8okoq.js";import"./constants-B1LrRAnj.js";import"./url-CoyBb3Dp.js";import"./PhDotsThreeVertical.vue-B1x6I4wD.js";import"./fetch-CmLIxYFV.js";import"./index-Cyx2lZTa.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="2b869221-6ec7-4e27-880c-cc0c5001c3e0",i._sentryDebugIdIdentifier="sentry-dbid-2b869221-6ec7-4e27-880c-cc0c5001c3e0")}catch{}})();const Pe=b({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(i,{emit:e}){const o=i,t=E(o.signupPolicy.strategy),l=E(o.signupPolicy.strategy==="patternOnly"?o.signupPolicy.emailPatterns:[]),s=E(o.signupPolicy.strategy==="patternOnly"?o.signupPolicy.emailPatterns.map(c=>({label:c})):[]),y=c=>{const C=c;if(l.value=C,C.length===0){t.value="inviteOnly",f("inviteOnly");return}s.value=C.map(P=>({label:P})),o.signupPolicy.emailPatterns=c,e("updated",o.signupPolicy)},p=()=>{e("save")},f=c=>{t.value=c,c!=="patternOnly"&&(c==="inviteOnly"&&o.signupPolicy.allowOnlyInvited(),e("updated",o.signupPolicy))};return(c,C)=>(m(),g(a(pe),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:n(()=>[r(a(me),{value:t.value,"onUpdate:value":f},{default:n(()=>[r(a(R),{direction:"vertical"},{default:n(()=>[r(a(G),{value:"inviteOnly"},{default:n(()=>[h("Allow listed users only")]),_:1}),r(a(R),null,{default:n(()=>[r(a(G),{value:"patternOnly"},{default:n(()=>[h("Allow everyone from this domain:")]),_:1}),r(a(L),{mode:"tags",value:c.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:"@domain.com or sub.domain.com",disabled:t.value!=="patternOnly",options:s.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":y},null,8,["value","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),r(a(_),{disabled:!c.signupPolicy.hasChanges,type:"primary",onClick:p},{default:n(()=>[h(" Save changes ")]),_:1},8,["disabled"])]),_:1}))}}),Ue=b({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(i,{emit:e}){const t=i.roleOptions.map(p=>({label:p.name,value:p.name})),l=j({email:"",roles:[]});function s(){e("cancel")}function y(){l.email&&e("created",l)}return(p,f)=>(m(),g(a(N),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:n(()=>[r(a(R),null,{default:n(()=>[r(a(_),{onClick:s},{default:n(()=>[h("Cancel")]),_:1}),r(a(_),{type:"primary",onClick:y},{default:n(()=>[h("Submit")]),_:1})]),_:1})]),default:n(()=>[r(a(S),{model:l,layout:"vertical"},{default:n(()=>[r(a(w),{key:"email",label:"Email",required:!0},{default:n(()=>[r(a(T),{value:l.email,"onUpdate:value":f[0]||(f[0]=c=>l.email=c)},null,8,["value"])]),_:1}),r(a(w),{key:"role",label:"Role"},{default:n(()=>[r(a(L),{value:l.roles,"onUpdate:value":f[1]||(f[1]=c=>l.roles=c),mode:"multiple",options:a(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Re=b({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(i,{emit:e}){const o=i,t=o.roleOptions.map(p=>({label:p.name,value:p.name})),l=j({email:o.email,roles:o.roles});function s(){e("cancel")}function y(){e("updated",l)}return(p,f)=>(m(),g(a(N),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:n(()=>[r(a(R),null,{default:n(()=>[r(a(_),{onClick:s},{default:n(()=>[h("Cancel")]),_:1}),r(a(_),{type:"primary",onClick:y},{default:n(()=>[h("Submit")]),_:1})]),_:1})]),default:n(()=>[r(a(S),{model:l,layout:"vertical"},{default:n(()=>[r(a(w),{key:"email",label:"Email"},{default:n(()=>[r(a(T),{value:l.email,"onUpdate:value":f[0]||(f[0]=c=>l.email=c)},null,8,["value"])]),_:1}),r(a(w),{key:"role",label:"Role"},{default:n(()=>[r(a(L),{value:l.roles,"onUpdate:value":f[1]||(f[1]=c=>l.roles=c),mode:"multiple",options:a(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Ee=b({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const e=i,o=Y(()=>({columns:[{title:"Email"},{title:"Roles"},{title:"",align:"right"}],rows:e.users.map(t=>({key:t.email,cells:[{type:"text",text:t.email},{type:"slot",key:"roles",payload:{roles:t.roles}},{type:"actions",actions:[{icon:W,label:"Edit",onClick:()=>e.onEdit(t)},{icon:Q,label:"Delete",onClick:()=>e.onDelete(t)}]}]}))??[]}));return(t,l)=>(m(),g(J,{"entity-name":"users",title:"",loading:t.loading,description:"List all app users.","empty-title":"No users yet",table:o.value,"create-button-text":"Add users",create:t.onCreate},{roles:n(({payload:s})=>[(m(!0),Z(H,null,ye(s.roles,y=>(m(),g(a(fe),{key:y,bordered:""},{default:n(()=>[h(ge(y),1)]),_:2},1024))),128))]),_:1},8,["loading","table","create"]))}}),xe=b({__name:"NewRole",emits:["created","cancel"],setup(i,{emit:e}){const o=j({name:"",description:""});function t(){e("cancel")}function l(){o.name&&e("created",o)}return(s,y)=>(m(),g(a(N),{open:"",title:"New role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:t},{extra:n(()=>[r(a(R),null,{default:n(()=>[r(a(_),{onClick:t},{default:n(()=>[h("Cancel")]),_:1}),r(a(_),{type:"primary",onClick:l},{default:n(()=>[h("Submit")]),_:1})]),_:1})]),default:n(()=>[r(a(S),{model:o,layout:"vertical"},{default:n(()=>[r(a(w),{key:"name",label:"Name",required:!0},{default:n(()=>[r(a(T),{value:o.name,"onUpdate:value":y[0]||(y[0]=p=>o.name=p)},null,8,["value"])]),_:1}),r(a(w),{key:"description",label:"Description"},{default:n(()=>[r(a(X),{value:o.description,"onUpdate:value":y[1]||(y[1]=p=>o.description=p),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Oe=b({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(i,{emit:e}){const o=i,t=j({description:o.description});function l(){e("cancel")}function s(){e("updated",t)}return(y,p)=>(m(),g(a(N),{open:"",title:"Update role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:l},{extra:n(()=>[r(a(R),null,{default:n(()=>[r(a(_),{onClick:l},{default:n(()=>[h("Cancel")]),_:1}),r(a(_),{type:"primary",onClick:s},{default:n(()=>[h("Submit")]),_:1})]),_:1})]),default:n(()=>[r(a(S),{model:t,layout:"vertical"},{default:n(()=>[r(a(w),{key:"name",label:"Name"},{default:n(()=>[r(a(T),{value:o.name,disabled:""},null,8,["value"])]),_:1}),r(a(w),{key:"role",label:"Role"},{default:n(()=>[r(a(X),{value:t.description,"onUpdate:value":p[0]||(p[0]=f=>t.description=f),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),$e=b({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const e=i,o=Y(()=>({columns:[{title:"Name"},{title:"Description"},{title:"",align:"right"}],rows:e.roles.map(t=>({key:t.id,cells:[{type:"text",text:t.name},{type:"text",text:t.description},{type:"actions",actions:[{icon:W,label:"Edit",onClick:()=>e.onEdit(t)},{icon:Q,label:"Delete",onClick:()=>e.onDelete(t)}]}]}))??[]}));return(t,l)=>(m(),g(J,{"entity-name":"roles",loading:t.loading,title:"",description:"List all app roles.","empty-title":"No roles yet",table:o.value,"create-button-text":"Add roles",create:t.onCreate},null,8,["loading","table","create"]))}});class x{constructor(e){this.dto=e,this.record=ee.from(e)}static pattern=new RegExp("^@?(?!-)[A-Za-z0-9-]{1,}(?<!-)(\\.[A-Za-z]{2,})+$");record;static from(e){return new x(e)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(e){this.record.set("emailPatterns",e)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":"patternOnly"}get changes(){return this.record.changes}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(e){return x.pattern.test(e)}}class De{urlPath="signup-policy";async update(e,o){return U.patch(`projects/${e}/${this.urlPath}`,o)}async get(e){return U.get(`projects/${e}/${this.urlPath}`)}}const K=new De;class Ae{constructor(e){this.projectId=e}async update(e){const{emailPatterns:o}=e.changes;if(!o)return e;const t=await K.update(this.projectId,{emailPatterns:o});return x.from(t)}async get(){const e=await K.get(this.projectId);return x.from(e)}}class q{constructor(e){this.dto=e,this.record=ee.from(e)}record;static from(e){return new q(e)}toDTO(){return this.record.toDTO()}get changes(){return this.record.changes}get id(){return this.record.get("id")}get email(){return this.record.get("email")}set email(e){this.record.set("email",e)}get projectId(){return this.record.get("projectId")}get roles(){return this.record.get("roles")}set roles(e){this.record.set("roles",e)}update(e){this.record.update(e)}resetChanges(){this.record.resetChanges()}}class Ie{urlPath="users";async create(e,o){return U.post(`projects/${e}/${this.urlPath}`,o)}async delete(e,o){await U.delete(`projects/${e}/${this.urlPath}/${o}`)}async list(e,{limit:o,offset:t}){const l={};o&&(l.limit=o.toString()),t&&(l.offset=t.toString());const s=new URLSearchParams(l);return U.get(`projects/${e}/${this.urlPath}?${s.toString()}`)}async update(e,o,t){return U.patch(`projects/${e}/${this.urlPath}/${o}`,t)}}const I=new Ie;class je{constructor(e){this.projectId=e}async create(e){await I.create(this.projectId,e)}async update(e,o){await I.update(this.projectId,e,o)}async delete(e){await I.delete(this.projectId,e)}async list(e,o){return(await I.list(this.projectId,{limit:e,offset:o})).map(q.from)}}const Je=b({__name:"View",setup(i){const o=he().params.projectId,t=E({type:"initial"}),l=E("users");ve(()=>{const d=new URLSearchParams(location.search).get("selected-panel")||"users",v=["roles","users"].includes(d)?d:"users";l.value=v});const s=()=>{t.value.type="initial"},y=()=>{t.value.type="creatingUser"},p=u=>{t.value={type:"editingUser",payload:u}},f=()=>{t.value.type="creatingRole"},c=u=>{t.value={type:"editingRole",payload:u}},C=new Ae(o),{result:P,refetch:te}=V(()=>C.get()),ae=async()=>{if(P.value)try{await C.update(P.value),te()}catch(u){u instanceof Error&&k("Update Error",u.message)}},O=new je(o),{loading:oe,result:re,refetch:$}=V(()=>O.list(100,0)),D=new Ce(o),{loading:ne,result:F,refetch:B}=V(()=>D.list(100,0)),le=async u=>{try{if(t.value.type!=="creatingUser")return;await O.create(u),s(),$()}catch(d){d instanceof Error&&k("Create Error",d.message)}},se=async u=>{try{if(t.value.type!=="editingUser")return;await O.update(t.value.payload.id,u),s(),$()}catch(d){d instanceof Error&&k("Update Error",d.message)}},ie=async u=>{if(await M("Deleting users revoke their access to your application (in case they aren't allowed by a domain rule). Are you sure you want to continue?"))try{await O.delete(u.id),$()}catch(v){v instanceof Error&&k("Delete Error",v.message)}},ce=async u=>{try{if(t.value.type!=="creatingRole")return;await D.create(u),s(),B()}catch(d){d instanceof Error&&k("Create Error",d.message)}},ue=async u=>{try{if(t.value.type!=="editingRole")return;await D.update(t.value.payload.id,u),s(),B()}catch(d){d instanceof Error&&k("Update Error",d.message)}},de=async u=>{if(await M("Deleteing roles may revoke access to some features in your application. Are you sure you want to continue?"))try{await D.delete(u.id),B(),$()}catch(v){v instanceof Error&&k("Delete Error",v.message)}};return(u,d)=>(m(),Z(H,null,[r(a(_e),null,{default:n(()=>[h("Access Control")]),_:1}),r(a(we),null,{default:n(()=>[h(" Manage how your end users interect with your application. "),r(be,{path:"tools/access-control"})]),_:1}),r(a(ke),{"active-key":l.value,"onUpdate:activeKey":d[0]||(d[0]=v=>l.value=v)},{default:n(()=>[r(a(z),{key:"users",tab:"Users"}),r(a(z),{key:"roles",tab:"Roles"})]),_:1},8,["active-key"]),l.value==="users"&&a(P)?(m(),g(Pe,{key:0,"signup-policy":a(P),onSave:ae},null,8,["signup-policy"])):A("",!0),l.value==="users"?(m(),g(Ee,{key:1,loading:a(oe),users:a(re)||[],onCreate:y,onEdit:p,onDelete:ie},null,8,["loading","users"])):A("",!0),l.value==="roles"?(m(),g($e,{key:2,loading:a(ne),roles:a(F)||[],onCreate:f,onEdit:c,onDelete:de},null,8,["loading","roles"])):A("",!0),t.value.type==="creatingUser"?(m(),g(Ue,{key:3,"role-options":a(F)||[],onCancel:s,onCreated:le},null,8,["role-options"])):t.value.type==="editingUser"?(m(),g(Re,{key:4,email:t.value.payload.email,roles:t.value.payload.roles||[],"role-options":a(F)||[],onUpdated:se,onCancel:s},null,8,["email","roles","role-options"])):t.value.type==="creatingRole"?(m(),g(xe,{key:5,onCancel:s,onCreated:ce})):t.value.type==="editingRole"?(m(),g(Oe,{key:6,name:t.value.payload.name,description:t.value.payload.description,onUpdated:ue,onCancel:s},null,8,["name","description"])):A("",!0)],64))}});export{Je as default};
//# sourceMappingURL=View-B91KtDAY.js.map
