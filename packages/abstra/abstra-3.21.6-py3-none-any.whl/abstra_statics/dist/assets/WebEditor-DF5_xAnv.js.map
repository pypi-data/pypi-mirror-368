{"version":3,"file":"WebEditor-DF5_xAnv.js","sources":["../../src/apps/console/views/WebEditor/View.vue","../../src/apps/console/views/WebEditor/controller.ts","../../src/apps/console/views/WebEditor.vue"],"sourcesContent":["<template>\n  <BaseLayout>\n    <template #content>\n      <AntFlex align=\"center\" justify=\"center\" style=\"width: 100vw; height: 100dvh\">\n        <AntFlex\n          gap=\"large\"\n          align=\"center\"\n          justify=\"space-evenly\"\n          vertical\n          style=\"width: 45%; min-width: 600px; height: 100%\"\n        >\n          <AbstraLogo size=\"large\" />\n          <AntProgress\n            :size=\"[10, 10]\"\n            :show-info=\"false\"\n            :percent=\"percentage\"\n            stroke-color=\"#EA576A\"\n          />\n          <AntTitle :level=\"3\">Preparing your environment</AntTitle>\n          <AntText v-if=\"percentage < 100\"\n            >We are setting things up... This may take up to 1 minute.</AntText\n          >\n          <AntText v-else>You will be redirected soon</AntText>\n        </AntFlex>\n      </AntFlex>\n    </template>\n  </BaseLayout>\n</template>\n\n<script lang=\"tsx\" setup>\nimport AbstraLogo from '@/components/AbstraLogo.vue';\nimport BaseLayout from '@/components/BaseLayout.vue';\nimport {\n  Flex as AntFlex,\n  Progress as AntProgress,\n  TypographyText as AntText,\n  TypographyTitle as AntTitle,\n} from 'ant-design-vue';\nimport { onMounted, onUnmounted } from 'vue';\nimport { IWebEditorController } from './controller';\n\nconst props = defineProps<{\n  controller: IWebEditorController;\n}>();\n\nconst percentage = props.controller.loadingPercentage();\n\nonMounted(() => {\n  props.controller.start();\n});\n\nonUnmounted(() => {\n  props.controller.cleanUp();\n});\n</script>\n\n<style scoped>\n.video-container {\n  position: relative;\n  width: 100%;\n  overflow: hidden;\n  padding-top: 56.25%; /* 16:9 Aspect Ratio */\n}\n\n.responsive-iframe {\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n}\n</style>\n","import { CloudApiConsoleWebEditorStartResponse } from '@/contracts.generated';\nimport localFetch from '@/utils/fetch';\nimport { ref, Ref } from 'vue';\nimport { ProjectModel } from '../../apis/cloud';\n\nexport interface IWebEditorController {\n  start(): Promise<void>;\n  cleanUp(): void;\n  loadingPercentage(): Ref<number>;\n}\n\nexport class WebEditorController implements IWebEditorController {\n  private projectId: string;\n  private loading: Ref<number>;\n  private fetch = localFetch;\n  private interval: NodeJS.Timeout | null = null;\n  private urls: CloudApiConsoleWebEditorStartResponse | null = null;\n  private totalWaitTime: number;\n  private poolingInterval: number;\n  private pingResponded = false;\n  private redirectPath?: string;\n\n  constructor(projectId: string, redirectPath?: string, fetch = localFetch) {\n    this.projectId = projectId;\n    this.loading = ref(0);\n    this.fetch = fetch;\n    this.totalWaitTime = 60000; // 1min\n    this.poolingInterval = 2500;\n    this.redirectPath = redirectPath;\n  }\n\n  private increment() {\n    this.loading.value += 100 / (this.totalWaitTime / this.poolingInterval);\n  }\n\n  private speedUp(): void {\n    this.totalWaitTime = 5000;\n    this.poolingInterval = 500;\n\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = setInterval(async () => {\n      this.increment();\n\n      if (this.loading.value >= 100) {\n        this.navigate();\n      }\n    }, this.poolingInterval);\n  }\n\n  private navigate(): void {\n    if (this.urls) {\n      const query = new URLSearchParams();\n      if (this.redirectPath) query.set('redirect', this.redirectPath);\n      window.location.replace(this.urls.redirect + '?' + query.toString());\n    }\n    this.cleanUp();\n  }\n\n  private async ping(): Promise<boolean> {\n    if (!this.urls) return false;\n    if (this.pingResponded) return true;\n    const response = await this.fetch(this.urls.ping, { signal: AbortSignal.timeout(500) });\n    this.pingResponded = response.status === 200;\n    return this.pingResponded;\n  }\n\n  async start(): Promise<void> {\n    const urls = await ProjectModel.startWebEditor(this.projectId);\n    this.urls = urls;\n\n    this.interval = setInterval(async () => {\n      this.increment();\n\n      if (!this.pingResponded) {\n        const response = await this.ping();\n        if (response) this.speedUp();\n      }\n\n      if (this.loading.value >= 100) {\n        this.navigate();\n      }\n    }, this.poolingInterval);\n  }\n\n  cleanUp(): void {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n  }\n\n  loadingPercentage(): Ref<number> {\n    return this.loading;\n  }\n}\n","<template>\n  <WebEditorView :controller=\"ctrl\" />\n</template>\n\n<script lang=\"tsx\" setup>\nimport { useRoute } from 'vue-router';\nimport WebEditorView from './WebEditor/View.vue';\nimport { WebEditorController } from './WebEditor/controller';\n\nconst route = useRoute();\nconst projectId = route.params.projectId as string;\nconst redirectPath = route.query.redirect as string;\n\nconst ctrl = new WebEditorController(projectId, redirectPath);\n</script>\n"],"names":["percentage","props","onMounted","onUnmounted","WebEditorController","localFetch","projectId","redirectPath","fetch","ref","query","response","urls","ProjectModel","route","useRoute","ctrl"],"mappings":"i5BA6CMA,EAAaC,EAAM,WAAW,kBAAA,EAEpC,OAAAC,EAAU,IAAM,CACdD,EAAM,WAAW,MAAA,CACnB,CAAC,EAEDE,EAAY,IAAM,CAChBF,EAAM,WAAW,QAAA,CACnB,CAAC,utBC1CM,MAAMG,CAAoD,CACvD,UACA,QACA,MAAQC,EACR,SAAkC,KAClC,KAAqD,KACrD,cACA,gBACA,cAAgB,GAChB,aAER,YAAYC,EAAmBC,EAAuBC,EAAQH,EAAY,CACxE,KAAK,UAAYC,EACjB,KAAK,QAAUG,EAAI,CAAC,EACpB,KAAK,MAAQD,EACb,KAAK,cAAgB,IACrB,KAAK,gBAAkB,KACvB,KAAK,aAAeD,CACtB,CAEQ,WAAY,CAClB,KAAK,QAAQ,OAAS,KAAO,KAAK,cAAgB,KAAK,gBACzD,CAEQ,SAAgB,CACtB,KAAK,cAAgB,IACrB,KAAK,gBAAkB,IAEnB,KAAK,UACP,cAAc,KAAK,QAAQ,EAE7B,KAAK,SAAW,YAAY,SAAY,CACtC,KAAK,UAAA,EAED,KAAK,QAAQ,OAAS,KACxB,KAAK,SAAA,CAET,EAAG,KAAK,eAAe,CACzB,CAEQ,UAAiB,CACvB,GAAI,KAAK,KAAM,CACb,MAAMG,EAAQ,IAAI,gBACd,KAAK,cAAcA,EAAM,IAAI,WAAY,KAAK,YAAY,EAC9D,OAAO,SAAS,QAAQ,KAAK,KAAK,SAAW,IAAMA,EAAM,UAAU,CACrE,CACA,KAAK,QAAA,CACP,CAEA,MAAc,MAAyB,CACrC,GAAI,CAAC,KAAK,KAAM,MAAO,GACvB,GAAI,KAAK,cAAe,MAAO,GAC/B,MAAMC,EAAW,MAAM,KAAK,MAAM,KAAK,KAAK,KAAM,CAAE,OAAQ,YAAY,QAAQ,GAAG,EAAG,EACtF,YAAK,cAAgBA,EAAS,SAAW,IAClC,KAAK,aACd,CAEA,MAAM,OAAuB,CAC3B,MAAMC,EAAO,MAAMC,EAAa,eAAe,KAAK,SAAS,EAC7D,KAAK,KAAOD,EAEZ,KAAK,SAAW,YAAY,SAAY,CACtC,KAAK,UAAA,EAEA,KAAK,eACS,MAAM,KAAK,KAAA,QACT,QAAA,EAGjB,KAAK,QAAQ,OAAS,KACxB,KAAK,SAAA,CAET,EAAG,KAAK,eAAe,CACzB,CAEA,SAAgB,CACV,KAAK,UACP,cAAc,KAAK,QAAQ,CAE/B,CAEA,mBAAiC,CAC/B,OAAO,KAAK,OACd,CACF,wCCtFA,MAAME,EAAQC,EAAA,EACRT,EAAYQ,EAAM,OAAO,UACzBP,EAAeO,EAAM,MAAM,SAE3BE,EAAO,IAAIZ,EAAoBE,EAAWC,CAAY"}