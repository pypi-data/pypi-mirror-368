import{d as D,k,e as y,l as p,m as o,n as T,p as C,q as b,s as U,r as P,w as Q,N as B,S as R,T as G,g as r,B as c,G as l,$ as u,D as e,Y as q,bl as J,M as j,F as L,U as S,aI as W,V as M,b8 as H,aP as K,ba as Y,aj as A,ak as _,al as N,aQ as V,an as z,O as x,bm as X,bn as ee,ap as te}from"./jwt-decode.esm-Dca5fHH5.js";import{_ as v}from"./AbstraButton.vue_vue_type_script_setup_true_lang-D-iosY4j.js";import{H as E}from"./PhCube.vue-DhNYBIOo.js";import{G as O,a as ae,b as $}from"./PhPencilSimple.vue-CRFcCjMe.js";import{G as re}from"./PhFolder.vue-zXTy4Frb.js";import{F as le}from"./PhGear.vue-Dxfwwyln.js";import{F as oe}from"./PhUsersThree.vue-Cno3zUmZ.js";import{b as de,e as ie,f as se,L as ne,g as ue}from"./router-D5wfdag3.js";import{M as ce}from"./member-BNIMJ1hR.js";import{P as fe,a as he}from"./project-BZzoNeQM.js";import"./tables-BsqTY_wE.js";import{F as me}from"./folder-CMrXs2lc.js";import{a as Z}from"./ant-design-12Ybi1Rk.js";import{O as ve}from"./organization-DepCCxnV.js";import"./index-Cyx2lZTa.js";import"./record-BZIfMWML.js";import"./string-BYR4BIXr.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[a]="fbfc102d-0a95-447f-90a0-4b4246fecad2",f._sentryDebugIdIdentifier="sentry-dbid-fbfc102d-0a95-447f-90a0-4b4246fecad2")}catch{}})();const pe=["width","height","fill","transform"],ge={key:0},Fe=b("path",{d:"M248.23,112.31A20,20,0,0,0,232,104H220V88a20,20,0,0,0-20-20H132L105.34,48a20.12,20.12,0,0,0-12-4H40A20,20,0,0,0,20,64V208a12,12,0,0,0,12,12H211.1a12,12,0,0,0,11.33-8l28.49-81.47.06-.17A20,20,0,0,0,248.23,112.31ZM92,68l28.8,21.6A12,12,0,0,0,128,92h68v12H69.77a20,20,0,0,0-18.94,13.58L44,137.15V68ZM202.59,196H48.89l23.72-68H226.37Z"},null,-1),we=[Fe],je={key:1},be=b("path",{d:"M208,88v24H69.77a8,8,0,0,0-7.59,5.47L32,208V64a8,8,0,0,1,8-8H93.33a8,8,0,0,1,4.8,1.6L128,80h72A8,8,0,0,1,208,88Z",opacity:"0.2"},null,-1),ye=b("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"},null,-1),Ie=[be,ye],Pe={key:2},Ce=b("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},null,-1),ke=[Ce],Me={key:3},He=b("path",{d:"M243.36,111.81A14,14,0,0,0,232,106H214V88a14,14,0,0,0-14-14H130L101.74,52.8a14.06,14.06,0,0,0-8.4-2.8H40A14,14,0,0,0,26,64V208a6,6,0,0,0,6,6H211.1a6,6,0,0,0,5.69-4.1l28.49-85.47A14,14,0,0,0,243.36,111.81ZM40,62H93.34a2,2,0,0,1,1.2.4L124.4,84.8A6,6,0,0,0,128,86h72a2,2,0,0,1,2,2v18H69.77a14,14,0,0,0-13.28,9.57L38,171V64A2,2,0,0,1,40,62Zm193.9,58.63L206.78,202H40.33l27.54-82.63a2,2,0,0,1,1.9-1.37H232a2,2,0,0,1,1.9,2.63Z"},null,-1),_e=[He],Le={key:4},Se=b("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"},null,-1),Ae=[Se],Ne={key:5},Ve=b("path",{d:"M241.72,113a11.88,11.88,0,0,0-9.73-5H212V88a12,12,0,0,0-12-12H129.33l-28.8-21.6a12.05,12.05,0,0,0-7.2-2.4H40A12,12,0,0,0,28,64V208a4,4,0,0,0,4,4H211.09a4,4,0,0,0,3.79-2.74l28.49-85.47A11.86,11.86,0,0,0,241.72,113ZM40,60H93.33a4,4,0,0,1,2.4.8L125.6,83.2a4,4,0,0,0,2.4.8h72a4,4,0,0,1,4,4v20H69.76a12,12,0,0,0-11.38,8.21L36,183.35V64A4,4,0,0,1,40,60Zm195.78,61.26L208.2,204H37.55L66,118.74A4,4,0,0,1,69.76,116H232a4,4,0,0,1,3.79,5.26Z"},null,-1),ze=[Ve],xe={name:"PhFolderOpen"},Ee=D({...xe,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(f){const a=f,d=k("weight","regular"),n=k("size","1em"),F=k("color","currentColor"),g=k("mirrored",!1),h=y(()=>a.weight??d),m=y(()=>a.size??n),t=y(()=>a.color??F),I=y(()=>a.mirrored!==void 0?a.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(i,s)=>(o(),p("svg",U({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:m.value,height:m.value,fill:t.value,transform:I.value},i.$attrs),[T(i.$slots,"default"),h.value==="bold"?(o(),p("g",ge,we)):h.value==="duotone"?(o(),p("g",je,Ie)):h.value==="fill"?(o(),p("g",Pe,ke)):h.value==="light"?(o(),p("g",Me,_e)):h.value==="regular"?(o(),p("g",Le,Ae)):h.value==="thin"?(o(),p("g",Ne,ze)):C("",!0)],16,pe))}});class Oe{fetchedState=P(null);activeFolderIds;draftFolder=P(null);draftProject=P(null);searchQuery=P("");isDraftProjectValid=y(()=>this.validateDraftProject());isDraftFolderValid=y(()=>this.validateDraftFolder());memberOptions=y(()=>this.getMemberOptions());folderOptions=y(()=>this.getFolderOptions());organizationId;currentUserEmail;handlers;apis;constructor(a){this.organizationId=a.organizationId,this.currentUserEmail=a.currentUserEmail,this.handlers=a.handlers,this.apis=a.apis,a.routeHash.startsWith("#")?this.activeFolderIds=P([a.routeHash.slice(1)]):this.activeFolderIds=P([])}async refetchState(a=!0){a&&this.closeModals(),this.fetchedState.value=null;const[d,n,F,g]=await Promise.all([fe.list(this.organizationId),ve.get(this.organizationId),this.apis.member.list(this.organizationId),this.apis.folder.list(this.organizationId)]),h=F.find(m=>m.email===this.currentUserEmail)??null;g.length===1&&this.activeFolderIds.value?.includes(g[0].id),this.fetchedState.value={projects:d.sort((m,t)=>m.name.localeCompare(t.name)),organization:n,members:F,folders:g.sort((m,t)=>m.name.localeCompare(t.name)),currentMember:h},Q(this.searchQuery,m=>{m.trim()?this.activeFolderIds.value=this.listFolders().map(t=>t.id):this.activeFolderIds.value=[]})}deleteProject=async()=>{!this.draftProject.value||this.draftProject.value.mode!=="edit"||!await Z("Are you sure you want to delete this project? All data will be lost.")||(this.draftProject.value={...this.draftProject.value,buttonLoading:"delete"},await this.apis.project.delete(this.draftProject.value.id),await this.refetchState())};deleteFolder=async()=>{if(!this.draftFolder.value||this.draftFolder.value.mode!=="edit")throw new Error("[PROJECTS_CONTROLLER] Invalid state deleting folder");this.getFolderProjects(this.draftFolder.value.id).length>0||!await Z("Are you sure you want to delete this empty folder?",{okText:"Delete",cancelText:"Cancel"})||(this.draftFolder.value={...this.draftFolder.value,buttonLoading:"delete"},await this.apis.folder.delete(this.organizationId,this.draftFolder.value.id),await this.refetchState())};duplicateProject=async({key:a})=>{const d=this.fetchedState.value?.projects.find(n=>n.id===a);if(d){const n=await d.duplicate();this.handlers.navigateToProject(n.id)}};openEditFolderModal=a=>{this.fetchedState.value?.projects.filter(n=>n.folderId===a.id).map(n=>n.id)&&(this.draftFolder.value={currentName:a.name,modalTitle:`${a.name} - Settings`,id:a.id,mode:"edit",newName:a.name,newMemberIds:[...a.memberIds],currentMemberIds:a.memberIds,buttonLoading:null})};openCreateFolderModal=()=>{if(!this.fetchedState.value)throw new Error("[PROJECTS_CONTROLLER] Invalid state opening create folder modal");this.draftFolder.value={currentName:"",mode:"create",currentMemberIds:[],modalTitle:"Create Folder",newName:"",newMemberIds:[this.fetchedState.value.currentMember?.id].filter(Boolean),buttonLoading:null}};openCreateProjectModal=(a="")=>{this.draftProject.value={currentName:"",mode:"create",currentFolderId:"",modalTitle:"Create Project",newName:"",newFolderId:a,buttonLoading:null}};openEditProjectModal=a=>{this.draftProject.value={id:a.id,mode:"edit",currentName:a.name,currentFolderId:a.folderId,modalTitle:`Edit Project: ${a.name}`,newName:a.name,newFolderId:a.folderId,buttonLoading:null}};saveFolder=async()=>{this.draftFolder.value&&(this.draftFolder.value={...this.draftFolder.value,buttonLoading:"save"},this.draftFolder.value.mode==="edit"?await this.apis.folder.update(this.organizationId,{id:this.draftFolder.value.id,name:this.draftFolder.value.newName,memberIds:this.draftFolder.value.newMemberIds,organizationId:this.organizationId}):this.draftFolder.value.mode==="create"&&await this.apis.folder.create({organizationId:this.organizationId,name:this.draftFolder.value.newName,memberIds:this.draftFolder.value.newMemberIds}),await this.refetchState())};saveProject=async()=>{this.draftProject.value&&(this.draftProject.value={...this.draftProject.value,buttonLoading:"save"},this.draftProject.value.mode==="edit"?await this.apis.project.update(this.draftProject.value.id,{name:this.draftProject.value.newName,folderId:this.draftProject.value.newFolderId}):this.draftProject.value.mode==="create"&&await this.apis.project.create({name:this.draftProject.value.newName,folderId:this.draftProject.value.newFolderId,organizationId:this.organizationId}),await this.refetchState())};closeModals=()=>{this.draftFolder.value=null,this.draftProject.value=null,this.activeFolderIds.value=[]};validateDraftFolder=()=>{if(!this.draftFolder.value)return!1;const a=this.draftFolder.value.newName!==this.draftFolder.value.currentName,d=this.draftFolder.value.newName.trim().length>0,n=!this.fetchedState.value?.folders.some(h=>h.name===this.draftFolder.value?.newName),F=!B.isEqual(this.draftFolder.value.newMemberIds,this.draftFolder.value.currentMemberIds),g=this.draftFolder.value.newMemberIds.length>0;return this.draftFolder.value.mode==="edit"?a&&d&&n||F&&g:d&&n&&g};validateDraftProject=()=>{if(!this.draftProject.value)return!1;const a=!!this.draftProject.value.newFolderId,d=this.draftProject.value.newName.trim().length>0,n=this.draftProject.value.newName!==this.draftProject.value.currentName,F=this.draftProject.value.newFolderId!==this.draftProject.value.currentFolderId;return this.draftProject.value.mode==="edit"?n&&d||F:a&&d};getMemberOptions=()=>this.fetchedState.value?.members.map(a=>({label:a.email,value:a.id,disabled:a.id===this.fetchedState.value?.currentMember?.id})).sort((a,d)=>a.label.localeCompare(d.label));getFolderOptions=()=>this.fetchedState.value?.folders.map(a=>({label:a.name,value:a.id}));getFolderProjects=a=>this.fetchedState.value?.projects.filter(d=>d.folderId===a&&(!this.searchQuery.value.trim()||d.name.toLowerCase().includes(this.searchQuery.value.toLowerCase())));listFolders(){return this.searchQuery.value.trim()?this.fetchedState.value?.folders.filter(a=>this.getFolderProjects(a.id).length>0)??[]:this.fetchedState.value?.folders??[]}}const $e=f=>(X("data-v-9523e5c0"),f=f(),ee(),f),Ze={key:0},De={key:1},Te=$e(()=>b("p",null,"Click the button below to create a new folder",-1)),Ue=D({__name:"ProjectsView",setup(f){const d=R().params.organizationId,n=G(),F={navigateToProject:I=>n.push({name:"project",params:{organizationId:d,projectId:I}})},g=de.getAuthor()?.claims.email;if(!g)throw new Error("User not logged in");const h=(I,i)=>i.label.toLowerCase().includes(I.toLowerCase()),m={member:new ce,project:new he,folder:new me},t=new Oe({organizationId:d,currentUserEmail:g,handlers:F,apis:m,routeHash:location.hash});return t.refetchState(!1),(I,i)=>(o(),p(L,null,[r(e(q),null,{default:l(()=>[u("Projects")]),_:1}),r(e(j),{style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"5px",margin:"0px 0px 50px"}},{default:l(()=>[r(e(J),{value:e(t).searchQuery.value,"onUpdate:value":i[0]||(i[0]=s=>e(t).searchQuery.value=s),placeholder:"Search projects",style:{width:"300px"}},null,8,["value"]),r(v,{onClick:e(t).openCreateFolderModal},{default:l(()=>[r(e(O)),u(" Create folder ")]),_:1},8,["onClick"])]),_:1}),r(e(j),{vertical:"",gap:"middle",style:{"padding-bottom":"50px"}},{default:l(()=>[(o(!0),p(L,null,S(e(t).listFolders(),s=>(o(),c(e(ie),{key:s.id,"active-key":e(t).activeFolderIds.value,"onUpdate:activeKey":i[1]||(i[1]=w=>e(t).activeFolderIds.value=w)},{expandIcon:l(({isActive:w})=>[w?(o(),c(e(Ee),{key:0,size:"20"})):(o(),c(e(re),{key:1,size:"20"}))]),default:l(()=>[(o(),c(e(se),{key:s.id,header:s.name},{extra:l(()=>[r(e(j),{gap:"10"},{default:l(()=>[r(e(j),{gap:"5",align:"flex-start"},{default:l(()=>[r(e(E),{size:"20"}),u(" "+M(`${e(t).getFolderProjects(s.id)?.length} projects`),1)]),_:2},1024),r(e(j),{gap:"5"},{default:l(()=>[r(e(oe),{size:"20"}),u(" "+M(`${s.memberIds.length} editors`),1)]),_:2},1024),r(v,{size:"small",onClick:H(w=>e(t).openCreateProjectModal(s.id),["stop"])},{default:l(()=>[r(e($)),u(" New project ")]),_:2},1032,["onClick"]),r(v,{size:"small",onClick:H(w=>e(t).openEditFolderModal(s),["stop"])},{default:l(()=>[r(e(le))]),_:2},1032,["onClick"])]),_:2},1024)]),default:l(()=>[r(e(ne),{locale:{emptyText:"Empty folder"}},{default:l(()=>[(o(!0),p(L,null,S(e(t).getFolderProjects(s.id),w=>(o(),c(e(ue),{key:w.id,type:"link",class:"project-list-item"},{default:l(()=>[r(e(E)),r(e(W),{href:`/projects/${w.id}`},{default:l(()=>[u(M(w.name),1)]),_:2},1032,["href"]),r(v,{size:"small",style:{position:"absolute",right:"10px"},onClick:H(Qe=>e(t).openEditProjectModal(w),["stop"])},{default:l(()=>[r(e(ae))]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["header"]))]),_:2},1032,["active-key"]))),128))]),_:1}),e(t).fetchedState.value?e(t).listFolders().length===0?(o(),c(e(Y),{key:1},{description:l(()=>[b("div",null,[e(t).searchQuery.value.trim()?(o(),p("p",Ze,' No projects found for the search query "'+M(e(t).searchQuery.value)+'" ',1)):(o(),p("p",De,"No folders found")),Te])]),default:l(()=>[e(t).searchQuery.value.trim()?(o(),c(v,{key:0,type:"primary",onClick:i[2]||(i[2]=s=>e(t).openCreateProjectModal())},{default:l(()=>[r(e($)),u(" Create project ")]),_:1})):(o(),c(v,{key:1,type:"primary",onClick:e(t).openCreateFolderModal},{default:l(()=>[r(e(O)),u(" Create folder ")]),_:1},8,["onClick"]))]),_:1})):C("",!0):(o(),c(e(K),{key:0,style:{width:"100%"}})),r(e(x),{open:!!e(t).draftFolder.value,title:e(t).draftFolder.value?.modalTitle,onCancel:e(t).closeModals},{footer:l(()=>[r(e(j),{justify:e(t).draftFolder.value?.mode==="edit"?"space-between":"flex-end"},{default:l(()=>[e(t).draftFolder.value?.mode==="edit"?(o(),c(v,{key:0,danger:"","disabled-tooltip":"Cannot delete folder with projects",disabled:e(t).getFolderProjects(e(t).draftFolder.value?.id).length>0,loading:e(t).draftFolder.value?.buttonLoading==="delete",onClick:i[5]||(i[5]=H(s=>e(t).deleteFolder(),["stop"]))},{default:l(()=>[r(e(z)),u(" Delete folder ")]),_:1},8,["disabled","loading"])):C("",!0),r(e(j),{justify:"flex-end"},{default:l(()=>[r(v,{onClick:e(t).closeModals},{default:l(()=>[u(" Cancel ")]),_:1},8,["onClick"]),r(v,{type:"primary",disabled:!e(t).isDraftFolderValid.value,loading:e(t).draftFolder.value?.buttonLoading==="save",onClick:e(t).saveFolder},{default:l(()=>[u(" Save ")]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["justify"])]),default:l(()=>[e(t).draftFolder.value?(o(),c(e(A),{key:0,layout:"vertical"},{default:l(()=>[r(e(_),{label:"Name"},{default:l(()=>[r(e(N),{value:e(t).draftFolder.value.newName,"onUpdate:value":i[3]||(i[3]=s=>e(t).draftFolder.value.newName=s)},null,8,["value"])]),_:1}),r(e(_),{label:"Editors",tooltip:"Only selected people will be able to see this folder"},{default:l(()=>[r(e(V),{value:e(t).draftFolder.value.newMemberIds,"onUpdate:value":i[4]||(i[4]=s=>e(t).draftFolder.value.newMemberIds=s),mode:"multiple",options:e(t).memberOptions.value,"filter-option":h,placeholder:"Choose who can see this folder"},null,8,["value","options"])]),_:1})]),_:1})):C("",!0)]),_:1},8,["open","title","onCancel"]),r(e(x),{open:!!e(t).draftProject.value,title:e(t).draftProject.value?.modalTitle,onCancel:e(t).closeModals},{footer:l(()=>[r(e(j),{justify:e(t).draftProject.value?.mode==="edit"?"space-between":"flex-end"},{default:l(()=>[e(t).draftProject.value?.mode==="edit"?(o(),c(v,{key:0,danger:"",loading:e(t).draftProject.value?.buttonLoading==="delete",onClick:e(t).deleteProject},{default:l(()=>[r(e(z)),u(" Delete project ")]),_:1},8,["loading","onClick"])):C("",!0),r(e(j),{justify:"flex-end"},{default:l(()=>[r(v,{onClick:e(t).closeModals},{default:l(()=>[u(" Cancel ")]),_:1},8,["onClick"]),r(v,{disabled:!e(t).isDraftProjectValid.value,type:"primary",loading:e(t).draftProject.value?.buttonLoading==="save",onClick:e(t).saveProject},{default:l(()=>[u(" Save ")]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["justify"])]),default:l(()=>[e(t).draftProject.value?(o(),c(e(A),{key:0,layout:"vertical"},{default:l(()=>[r(e(_),{label:"Name"},{default:l(()=>[r(e(N),{value:e(t).draftProject.value.newName,"onUpdate:value":i[6]||(i[6]=s=>e(t).draftProject.value.newName=s)},null,8,["value"])]),_:1}),r(e(_),{label:"Folder"},{default:l(()=>[r(e(V),{value:e(t).draftProject.value.newFolderId,"onUpdate:value":i[7]||(i[7]=s=>e(t).draftProject.value.newFolderId=s),options:e(t).folderOptions.value,placeholder:"Choose a folder"},null,8,["value","options"])]),_:1})]),_:1})):C("",!0)]),_:1},8,["open","title","onCancel"])],64))}}),st=te(Ue,[["__scopeId","data-v-9523e5c0"]]);export{st as default};
//# sourceMappingURL=ProjectsView-BptyZHVn.js.map
