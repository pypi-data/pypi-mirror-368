{"version":3,"file":"SaveButton-O5UjZDE_.js","sources":["../../node_modules/@phosphor-icons/vue/dist/icons/PhFloppyDisk.vue.mjs","../../src/components/helpers/UnsavedChangesHandler.vue","../../src/components/SaveButton.vue"],"sourcesContent":["import { defineComponent as u, inject as n, computed as i, openBlock as t, createElementBlock as e, mergeProps as m, renderSlot as A, createCommentVNode as Z, createElementVNode as o } from \"vue\";\nconst g = [\"width\", \"height\", \"fill\", \"transform\"], v = { key: 0 }, M = /* @__PURE__ */ o(\"path\", { d: \"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z\" }, null, -1), y = [\n  M\n], f = { key: 1 }, w = /* @__PURE__ */ o(\"path\", {\n  d: \"M216,83.31V208a8,8,0,0,1-8,8H176V152a8,8,0,0,0-8-8H88a8,8,0,0,0-8,8v64H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H172.69a8,8,0,0,1,5.65,2.34l35.32,35.32A8,8,0,0,1,216,83.31Z\",\n  opacity: \"0.2\"\n}, null, -1), k = /* @__PURE__ */ o(\"path\", { d: \"M219.31,72,184,36.69A15.86,15.86,0,0,0,172.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V83.31A15.86,15.86,0,0,0,219.31,72ZM168,208H88V152h80Zm40,0H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H172.69L208,83.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z\" }, null, -1), x = [\n  w,\n  k\n], S = { key: 2 }, z = /* @__PURE__ */ o(\"path\", { d: \"M219.31,72,184,36.69A15.86,15.86,0,0,0,172.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V83.31A15.86,15.86,0,0,0,219.31,72ZM208,208H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H172.69L208,83.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z\" }, null, -1), C = [\n  z\n], B = { key: 3 }, L = /* @__PURE__ */ o(\"path\", { d: \"M217.9,73.42,182.58,38.1a13.9,13.9,0,0,0-9.89-4.1H48A14,14,0,0,0,34,48V208a14,14,0,0,0,14,14H208a14,14,0,0,0,14-14V83.31A13.9,13.9,0,0,0,217.9,73.42ZM170,210H86V152a2,2,0,0,1,2-2h80a2,2,0,0,1,2,2Zm40-2a2,2,0,0,1-2,2H182V152a14,14,0,0,0-14-14H88a14,14,0,0,0-14,14v58H48a2,2,0,0,1-2-2V48a2,2,0,0,1,2-2H172.69a2,2,0,0,1,1.41.58L209.42,81.9a2,2,0,0,1,.58,1.41ZM158,72a6,6,0,0,1-6,6H96a6,6,0,0,1,0-12h56A6,6,0,0,1,158,72Z\" }, null, -1), N = [\n  L\n], b = { key: 4 }, E = /* @__PURE__ */ o(\"path\", { d: \"M219.31,72,184,36.69A15.86,15.86,0,0,0,172.69,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V83.31A15.86,15.86,0,0,0,219.31,72ZM168,208H88V152h80Zm40,0H184V152a16,16,0,0,0-16-16H88a16,16,0,0,0-16,16v56H48V48H172.69L208,83.31ZM160,72a8,8,0,0,1-8,8H96a8,8,0,0,1,0-16h56A8,8,0,0,1,160,72Z\" }, null, -1), P = [\n  E\n], W = { key: 5 }, $ = /* @__PURE__ */ o(\"path\", { d: \"M216.49,74.83,181.17,39.51A11.93,11.93,0,0,0,172.69,36H48A12,12,0,0,0,36,48V208a12,12,0,0,0,12,12H208a12,12,0,0,0,12-12V83.31A11.93,11.93,0,0,0,216.49,74.83ZM172,212H84V152a4,4,0,0,1,4-4h80a4,4,0,0,1,4,4Zm40-4a4,4,0,0,1-4,4H180V152a12,12,0,0,0-12-12H88a12,12,0,0,0-12,12v60H48a4,4,0,0,1-4-4V48a4,4,0,0,1,4-4H172.69a4,4,0,0,1,2.82,1.17l35.32,35.32A4,4,0,0,1,212,83.31ZM156,72a4,4,0,0,1-4,4H96a4,4,0,0,1,0-8h56A4,4,0,0,1,156,72Z\" }, null, -1), j = [\n  $\n], D = {\n  name: \"PhFloppyDisk\"\n}, G = /* @__PURE__ */ u({\n  ...D,\n  props: {\n    weight: {\n      type: String\n    },\n    size: {\n      type: [String, Number]\n    },\n    color: {\n      type: String\n    },\n    mirrored: {\n      type: Boolean\n    }\n  },\n  setup(h) {\n    const s = h, d = n(\"weight\", \"regular\"), c = n(\"size\", \"1em\"), H = n(\"color\", \"currentColor\"), _ = n(\"mirrored\", !1), a = i(() => s.weight ?? d), l = i(() => s.size ?? c), V = i(() => s.color ?? H), p = i(() => s.mirrored !== void 0 ? s.mirrored ? \"scale(-1, 1)\" : void 0 : _ ? \"scale(-1, 1)\" : void 0);\n    return (r, F) => (t(), e(\"svg\", m({\n      xmlns: \"http://www.w3.org/2000/svg\",\n      viewBox: \"0 0 256 256\",\n      width: l.value,\n      height: l.value,\n      fill: V.value,\n      transform: p.value\n    }, r.$attrs), [\n      A(r.$slots, \"default\"),\n      a.value === \"bold\" ? (t(), e(\"g\", v, y)) : a.value === \"duotone\" ? (t(), e(\"g\", f, x)) : a.value === \"fill\" ? (t(), e(\"g\", S, C)) : a.value === \"light\" ? (t(), e(\"g\", B, N)) : a.value === \"regular\" ? (t(), e(\"g\", b, P)) : a.value === \"thin\" ? (t(), e(\"g\", W, j)) : Z(\"\", !0)\n    ], 16, g));\n  }\n});\nexport {\n  G as default\n};\n","<template>\n  <AntConfigProvider\n    :theme=\"{\n      token: {\n        colorPrimary: '#d14056',\n      },\n    }\"\n  >\n    <slot />\n  </AntConfigProvider>\n</template>\n\n<script setup lang=\"ts\">\nimport { ExclamationCircleOutlined } from '@ant-design/icons-vue';\nimport { ConfigProvider as AntConfigProvider, Modal as AntModal } from 'ant-design-vue';\nimport { createVNode, onMounted, onUnmounted, watch } from 'vue';\nimport { onBeforeRouteLeave } from 'vue-router';\n\nconst props = defineProps<{ hasChanges?: boolean }>();\n\nconst message = 'You have unsaved changes. Are you sure you want to leave?';\n\nconst handleEvent = (e: BeforeUnloadEvent) => {\n  e = e || window.event;\n\n  if (e) {\n    e.returnValue = message;\n  }\n\n  return message;\n};\n\nconst enableUnloadListener = () => {\n  window.addEventListener('beforeunload', handleEvent);\n};\n\nonBeforeRouteLeave(async (to, from, next) => {\n  if (!props.hasChanges) return next();\n  const confirmed: boolean = await new Promise((resolve) => {\n    AntModal.confirm({\n      title: 'You have unsaved changes.',\n      icon: createVNode(ExclamationCircleOutlined),\n      content: 'Are you sure you want to discard them?',\n      okText: 'Discard Changes',\n      okType: 'danger',\n      cancelText: 'Cancel',\n      onOk() {\n        resolve(true);\n      },\n      onCancel() {\n        resolve(false);\n      },\n    });\n  });\n  confirmed ? next() : next(false);\n});\n\nconst disableUnloadListener = () => window.removeEventListener('beforeunload', handleEvent);\n\nconst update = (hasChanges?: boolean) =>\n  hasChanges ? enableUnloadListener() : disableUnloadListener();\n\nwatch(() => props.hasChanges, update);\n\nonMounted(() => update(props.hasChanges));\n\nonUnmounted(disableUnloadListener);\n</script>\n\n<style lang=\"scss\" scoped>\n.unsaved-changes-handler {\n  display: none;\n}\n</style>\n","<template>\n  <div class=\"popup-container\">\n    <AntPopover\n      placement=\"left\"\n      :open=\"model.hasChanges() && !dontShowAgain && !neverShowPopover\"\n      :get-popup-container=\"popupContainer\"\n    >\n      <template #content>\n        <div style=\"padding: 0px 4px\">\n          <AntText>You have unsaved changes</AntText>\n          <AntLink @click=\"setDontShowAgain\">Don't show this again</AntLink>\n        </div>\n      </template>\n      <AntButton\n        class=\"save-button\"\n        :loading=\"saving\"\n        :disabled=\"!model?.hasChanges() || disabled\"\n        @click=\"save()\"\n      >\n        <template #icon>\n          <slot name=\"icon\">\n            <PhFloppyDisk size=\"18\" />\n          </slot>\n        </template>\n        <slot v-if=\"model?.hasChanges()\" name=\"with-changes\"> Save </slot>\n        <slot v-else name=\"without-changes\"> Saved </slot>\n      </AntButton>\n    </AntPopover>\n    <UnsavedChangesHandler :has-changes=\"model?.hasChanges()\" />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { LocalBucket } from '@/models/bucket/repository';\nimport { PhFloppyDisk } from '@phosphor-icons/vue';\nimport {\n  Button as AntButton,\n  TypographyLink as AntLink,\n  Popover as AntPopover,\n  Typography as AntText,\n  notification,\n} from 'ant-design-vue';\nimport { ref } from 'vue';\nimport { z } from 'zod';\nimport UnsavedChangesHandler from './helpers/UnsavedChangesHandler.vue';\n\nexport interface Savable {\n  save(key?: string): Promise<void>;\n  hasChanges(key?: string): boolean;\n}\n\nconst emit = defineEmits<{\n  (e: 'save'): void;\n}>();\n\nconst props = defineProps<{\n  model: Savable;\n  neverShowPopover?: boolean;\n  disabled?: boolean;\n}>();\n\nconst popupContainer = (trigger: HTMLElement) => {\n  return trigger.parentElement ?? document.body;\n};\n\nconst unsavedChangesStorage = new LocalBucket(z.boolean(), 'dontShowUnsavedChanges');\nconst dontShowAgain = ref(unsavedChangesStorage.get() ?? false);\nconst setDontShowAgain = () => {\n  unsavedChangesStorage.set(true);\n  dontShowAgain.value = true;\n};\n\nconst saving = ref(false);\nasync function save() {\n  saving.value = true;\n  try {\n    await props.model.save();\n    emit('save');\n  } catch (e) {\n    console.error(e);\n    notification.error({\n      message: 'Error saving',\n    });\n  } finally {\n    saving.value = false;\n  }\n}\n\naddEventListener('keydown', (e) => {\n  if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n    e.preventDefault();\n    save();\n  }\n});\n\naddEventListener('beforeunload', (e) => {\n  if (props.model.hasChanges()) {\n    e.preventDefault();\n    e.returnValue = '';\n  }\n});\n</script>\n\n<style scoped>\n.save-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 5px;\n}\n\n.popup-container {\n  position: relative;\n}\n</style>\n"],"names":["g","v","M","o","y","f","w","k","x","S","z","C","B","L","N","b","E","P","W","$","j","D","G","u","h","s","d","n","c","H","_","i","l","V","p","r","F","t","e","m","A","Z","message","handleEvent","enableUnloadListener","onBeforeRouteLeave","to","from","next","props","resolve","AntModal","createVNode","ExclamationCircleOutlined","disableUnloadListener","update","hasChanges","watch","onMounted","onUnmounted","popupContainer","trigger","unsavedChangesStorage","LocalBucket","dontShowAgain","ref","setDontShowAgain","saving","save","emit","notification"],"mappings":"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","x_google_ignoreList":[0]}