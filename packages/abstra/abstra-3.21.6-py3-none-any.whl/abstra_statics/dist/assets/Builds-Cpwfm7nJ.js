import{C as F}from"./CrudView-wZnp03a2.js";import{d as M,k as x,e as A,l as b,m as u,n as q,p as h,q as k,s as H,g as s,I as j,bS as R,T as U,B as m,D as t,G as o,Z as v,$ as f,V as g,b1 as W,b2 as Q,b3 as X,ba as Y,S as J,X as K,aM as ee,r as te,aW as re,b0 as ae,a$ as le,aq as ne,E as oe,aP as ie,O as se,F as ue,ar as ce,ap as de}from"./jwt-decode.esm-Dca5fHH5.js";import{a as V}from"./asyncComputed-IJY6wgme.js";import{g as pe}from"./datetime-CBtw9cuf.js";import{u as me}from"./polling-CKeyL76l.js";import{G as fe}from"./PhArrowCounterClockwise.vue-DkKH75fg.js";import{H as ge}from"./PhCube.vue-DhNYBIOo.js";import{G as ye}from"./PhDownloadSimple.vue-WTX49Oyt.js";import{L as be,g as he,r as ve}from"./router-D5wfdag3.js";import{a as ke,b as _e}from"./build-B7ZDvyug.js";import{P as Ce}from"./project-BZzoNeQM.js";import"./tables-BsqTY_wE.js";import{G as Ae}from"./PhClockCounterClockwise.vue-C444ydTr.js";import{F as we,a as Oe,G as xe,I as Se}from"./PhWebhooksLogo.vue-JOavTArk.js";import{S}from"./index-ZQBk4l6i.js";import{E as Pe}from"./ExclamationCircleOutlined-BoIpZd7Q.js";import{C as Ze}from"./CloseCircleOutlined-BbEiW-El.js";import{L as I}from"./LoadingOutlined-DDGxAZbf.js";import"./DocsButton.vue_vue_type_script_setup_true_lang-BnwqPwfA.js";import"./constants-B1LrRAnj.js";import"./url-CoyBb3Dp.js";import"./PhDotsThreeVertical.vue-B1x6I4wD.js";import"./index-Cyx2lZTa.js";import"./record-BZIfMWML.js";import"./string-BYR4BIXr.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[e]="72d5e910-5535-468a-831c-2010255adc64",l._sentryDebugIdIdentifier="sentry-dbid-72d5e910-5535-468a-831c-2010255adc64")}catch{}})();var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const je=["width","height","fill","transform"],$e={key:0},De=k("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-16-84a16,16,0,1,1-16-16A16,16,0,0,1,112,128Zm64,0a16,16,0,1,1-16-16A16,16,0,0,1,176,128Z"},null,-1),ze=[De],Be={key:1},Ve=k("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Le=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm56-88a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Ne=[Ve,Le],Ee={key:2},Ge=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24ZM84,140a12,12,0,1,1,12-12A12,12,0,0,1,84,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,172,140Z"},null,-1),Te=[Ge],Fe={key:3},qe=k("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm10-90a10,10,0,1,1-10-10A10,10,0,0,1,138,128Zm-44,0a10,10,0,1,1-10-10A10,10,0,0,1,94,128Zm88,0a10,10,0,1,1-10-10A10,10,0,0,1,182,128Z"},null,-1),He=[qe],Re={key:4},Ue=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm12-88a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-88,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),We=[Ue],Qe={key:5},Xe=k("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm8-92a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-44,0a8,8,0,1,1-8-8A8,8,0,0,1,92,128Zm88,0a8,8,0,1,1-8-8A8,8,0,0,1,180,128Z"},null,-1),Ye=[Xe],Je={name:"PhDotsThreeCircle"},Ke=M({...Je,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const e=l,a=x("weight","regular"),c=x("size","1em"),i=x("color","currentColor"),w=x("mirrored",!1),d=A(()=>e.weight??a),C=A(()=>e.size??c),y=A(()=>e.color??i),_=A(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:w?"scale(-1, 1)":void 0);return(O,P)=>(u(),b("svg",H({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:C.value,height:C.value,fill:y.value,transform:_.value},O.$attrs),[q(O.$slots,"default"),d.value==="bold"?(u(),b("g",$e,ze)):d.value==="duotone"?(u(),b("g",Be,Ne)):d.value==="fill"?(u(),b("g",Ee,Te)):d.value==="light"?(u(),b("g",Fe,He)):d.value==="regular"?(u(),b("g",Re,We)):d.value==="thin"?(u(),b("g",Qe,Ye)):h("",!0)],16,je))}});function L(l){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(a).filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable}))),c.forEach(function(i){et(l,i,a[i])})}return l}function et(l,e,a){return e in l?Object.defineProperty(l,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[e]=a,l}var $=function(e,a){var c=L({},e,a.attrs);return s(j,L({},c,{icon:R}),null)};$.displayName="CheckCircleOutlined";$.inheritAttrs=!1;function N(l){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(a).filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable}))),c.forEach(function(i){tt(l,i,a[i])})}return l}function tt(l,e,a){return e in l?Object.defineProperty(l,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[e]=a,l}var D=function(e,a){var c=N({},e,a.attrs);return s(j,N({},c,{icon:Ie}),null)};D.displayName="MinusCircleOutlined";D.inheritAttrs=!1;function E(l){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(a).filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable}))),c.forEach(function(i){rt(l,i,a[i])})}return l}function rt(l,e,a){return e in l?Object.defineProperty(l,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[e]=a,l}var z=function(e,a){var c=E({},e,a.attrs);return s(j,E({},c,{icon:Me}),null)};z.displayName="PauseCircleOutlined";z.inheritAttrs=!1;const at={style:{display:"flex","align-items":"center",gap:"5px"}},lt={key:1},nt=M({__name:"BuildInspector",props:{buildSpec:{}},setup(l){const e=l,a=U(),c=i=>{a.push({name:"logs",params:{projectId:e.buildSpec.projectId},query:i.logQuery})};return(i,w)=>i.buildSpec.runtimes.length>0?(u(),m(t(be),{key:0,"item-layout":"horizontal","data-source":i.buildSpec.runtimes},{renderItem:o(({item:d})=>[s(t(he),null,{actions:o(()=>[s(t(W),null,{overlay:o(()=>[s(t(Q),null,{default:o(()=>[s(t(X),{onClick:C=>c(d)},{default:o(()=>[k("div",at,[s(t(Ae)),s(t(v),null,{default:o(()=>[f(" View Logs")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[s(t(Ke),{style:{cursor:"pointer"}})]),_:2},1024)]),default:o(()=>[d.type=="form"?(u(),m(t(S),{key:0,size:"large"},{default:o(()=>[s(t(we)),s(t(v),{strong:""},{default:o(()=>[f(g(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:o(()=>[f("/"+g(d.path),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="job"?(u(),m(t(S),{key:1,size:"large"},{default:o(()=>[s(t(Oe)),s(t(v),{strong:""},{default:o(()=>[f(g(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:o(()=>[f(g(d.schedule),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="hook"?(u(),m(t(S),{key:2,size:"large"},{default:o(()=>[s(t(xe)),s(t(v),{strong:""},{default:o(()=>[f(g(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:o(()=>[f("/_hooks/"+g(d.path),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="script"?(u(),m(t(S),{key:3,size:"large"},{default:o(()=>[s(t(Se)),s(t(v),{strong:""},{default:o(()=>[f(g(d.title),1)]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(u(),b("div",lt,[s(t(Y),{description:"No runtimes found. Make sure your project has forms, hooks or jobs before deploying it"})]))}}),ot=M({__name:"Builds",setup(l){const a=J().params.projectId,{loading:c,result:i,refetch:w}=V(async()=>{const[r,n]=await Promise.all([ke.list(a),Ce.getStatus(a)]);return{b:r.map(B=>({build:B,status:n.filter(Z=>Z.buildId==B.id).map(Z=>Z.status)})),status:n}}),{startPolling:d,endPolling:C}=me({task:w,interval:1e4});K(()=>d()),ee(()=>C());const y=te(null),_=V(async()=>y.value?await _e.get(y.value):null),O=()=>{const r=i.value?.b.find(p=>p.build.id===y.value);return`Version ${r?.build.id.slice(0,8)} - ${r?.build.createdAt.toLocaleString()}`},P=[{text:"Deploying",tagColor:"blue",check:r=>(r.build.latest&&r.status.some(n=>n=="Running")&&i.value?.status.some(n=>n.buildId!==r.build.id))??!1,loading:!0},{text:"Deactivating",tagColor:"orange",check:r=>r.build.status==="success"&&!r.build.latest&&r.status.some(n=>n=="Running"),loading:!0},{text:"Live",tagColor:"green",check:r=>r.build.latest&&r.status.some(n=>n=="Running")},{text:"Sleeping",tagColor:"cyan",check:r=>r.build.latest&&r.status.length===0},{text:"Failed",tagColor:"red",check:r=>r.build.latest&&r.status.some(n=>n=="Failed")},{text:"Inactive",tagColor:"default",check:r=>r.build.status==="success"},{text:"Aborted",tagColor:"default",check:r=>r.build.status==="aborted"||r.build.status==="aborted-by-user"},{text:"Failed",tagColor:"orange",check:r=>r.build.status==="failure"},{text:"Deploying",tagColor:"blue",check:r=>r.build.status==="in-progress",loading:!0},{text:"Uploading",tagColor:"yellow",check:r=>r.build.status==="pending"}];function G(r){return{text:P.find(n=>n.check(r))?.text??"unknown",tagColor:P.find(n=>n.check(r))?.tagColor??"default",hover:r.build.log??void 0}}const T=A(()=>{const r=[{title:"Id"},{title:"Date"},{title:"Abstra Version"},{title:"Status"},{title:"",align:"right"}];return i.value?{columns:r,rows:i.value.b.map(n=>({key:n.build.id,cells:[{type:"text",text:n.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:pe(n.build.createdAt,{weekday:void 0}),distance:ce(n.build.createdAt)}},{type:"text",text:n.build.abstraVersion??"-"},{key:"status",type:"slot",payload:G(n)},{type:"actions",actions:[{icon:ge,label:"Inspect version",onClick:async()=>{y.value=n.build.id,_.refetch()}},{icon:fe,label:"View application logs",onClick:()=>{ve.push({name:"logs",params:{projectId:a},query:{buildId:n.build.id}})}},{icon:ye,label:"Download files",onClick:()=>n.build.download()}]}]}))}:{columns:r,rows:[]}});return(r,n)=>(u(),b(ue,null,[s(F,{"entity-name":"build",loading:t(c),title:"Version History",description:"You can create a new version by publishing your project from the local editor.","empty-title":"No versions here yet",table:T.value,live:""},{date:o(({payload:p})=>[s(t(oe),null,{title:o(()=>[f(g(p.distance),1)]),default:o(()=>[f(g(p.date)+" ",1)]),_:2},1024)]),status:o(({payload:p})=>[s(t(re),{open:p.hover?void 0:!1},{content:o(()=>[s(t(ne),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:p.hover,copyable:""},null,8,["content"])]),default:o(()=>[p.text!=="unknown"?(u(),m(t(ae),{key:0,color:p.tagColor,style:le({cursor:p.hover?"pointer":"default"})},{default:o(()=>[p.text==="Live"?(u(),m(t($),{key:0})):p.text==="Inactive"?(u(),m(t(D),{key:1})):p.text==="Failed"?(u(),m(t(Pe),{key:2})):p.text==="Aborted"?(u(),m(t(Ze),{key:3})):p.text==="Sleeping"?(u(),m(t(z),{key:4})):p.text==="Uploading"?(u(),m(t(I),{key:5})):p.text==="Deploying"?(u(),m(t(I),{key:6})):p.text==="Deactivating"?(u(),m(t(I),{key:7})):h("",!0),f(" "+g(p.text),1)]),_:2},1032,["color","style"])):h("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","table"]),y.value?(u(),m(t(se),{key:0,footer:null,open:!!y.value,size:"large",width:"80%",title:O(),onCancel:n[0]||(n[0]=p=>y.value=null)},{default:o(()=>[!t(_).result.value||t(_).loading.value?(u(),m(t(ie),{key:0})):t(_).result.value?(u(),m(nt,{key:1,"build-spec":t(_).result.value},null,8,["build-spec"])):h("",!0)]),_:1},8,["open","title"])):h("",!0)],64))}}),jt=de(ot,[["__scopeId","data-v-9615f578"]]);export{jt as default};
//# sourceMappingURL=Builds-Cpwfm7nJ.js.map
