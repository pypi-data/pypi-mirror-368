{"version":3,"mappings":"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","names":["getAbstraVersion","response","error","makeAssetUrl","asset","originalUrl","environment","isUrl","DEFAULT_MAIN_COLOR","DEFAULT_THEME_COLOR","DEFAULT_FONT_COLOR","DEFAULT_FORM_FONT_FAMILY","DEFAULT_APPLICATION_NAME","DEFAULT_LANGUAGE","runnerDTOtoData","dto","workspaceDTOtoData","theme","isColor","fetchRunnerData","path","userStore","useUserStore","result","form","getWorkspace","allow","routerRecords","__vitePreload","router","createRouter","createWebHistory","to","guardFactory","from","updateTitle","guard","redirect","query","useWorkspaceStore","defineStore","state","ref"],"ignoreList":[],"sources":["../../src/services/version.ts","../../src/utils/assets.ts","../../src/services/runnerData.ts","../../src/apps/player/services/api.ts","../../src/apps/player/router.ts","../../src/apps/player/store/workspaceStore.ts"],"sourcesContent":["export const getAbstraVersion = async (): Promise<string> => {\n  try {\n    const response = await fetch('/_editor/api/workspace/version');\n    if (!response.ok) {\n      return import.meta.env.VITE_SENTRY_RELEASE;\n    }\n    const data = await response.json();\n    return data.version || import.meta.env.VITE_SENTRY_RELEASE;\n  } catch (error) {\n    console.error('Failed to fetch Abstra version:', error);\n    return import.meta.env.VITE_SENTRY_RELEASE;\n  }\n};\n","import { isUrl } from './url';\n\ntype ENVIROMENT = 'player' | 'editor';\n\nexport function makeAssetUrl(\n  asset: 'logo' | 'background' | 'favicon',\n  originalUrl: string,\n  environment: ENVIROMENT,\n) {\n  if (isUrl(originalUrl)) return originalUrl;\n  return environment === 'player' ? `/_assets/${asset}` : `/_editor/api/assets/${originalUrl}`;\n}\n","import { AccessiblePageType } from '@/models/access-control';\nimport { makeAssetUrl } from '@/utils/assets';\nimport { isColor } from '@/widgets-lib/common/components/PlayerConfigProvider/colorHelpers';\nimport { SupportedLocales } from '@/widgets-lib/common/i18n';\n\nexport const DEFAULT_MAIN_COLOR = '#414a58';\nexport const DEFAULT_THEME_COLOR = '#FFFFFF';\nconst DEFAULT_FONT_COLOR = '#000000';\nexport const DEFAULT_FORM_FONT_FAMILY = 'DM Sans';\nconst DEFAULT_APPLICATION_NAME = 'Untitled Project';\nexport const DEFAULT_LANGUAGE = { value: 'en', label: 'English' } as const;\n\nexport type SidebarItem = {\n  id: string;\n  name: string;\n  path: string;\n  type: AccessiblePageType;\n};\n\ntype WorkspaceRunnerDTO = {\n  name: string;\n  main_color: string;\n  logo_url: string;\n  font_family: string;\n  font_color: string;\n  brand_name: string;\n  sidebar: SidebarItem[];\n  theme: string;\n  language: SupportedLocales;\n};\n\nexport type WorkspaceRunnerData = {\n  name: string;\n  mainColor: string;\n  logoUrl: string | null;\n  fontFamily: string;\n  fontColor: string;\n  brandName: string;\n  sidebar: SidebarItem[];\n  theme: string;\n  language: SupportedLocales;\n};\n\ntype FormRunnerDTO = {\n  id: string;\n  path: string;\n  title: string;\n  is_initial: boolean;\n  is_local?: boolean;\n  start_message?: string | null;\n  end_message?: string | null;\n  error_message?: string | null;\n  timeout_message?: string | null;\n  start_button_text?: string | null;\n  restart_button_text?: string | null;\n  welcome_title?: string | null;\n  auto_start?: boolean;\n  allow_restart: boolean;\n  workspace: WorkspaceRunnerDTO;\n};\n\nexport type FormRunnerData = {\n  id: string;\n  path: string;\n  title: string;\n  isInitial: boolean;\n  theme: string;\n  brandName: string | null;\n  isLocal: boolean;\n  startMessage: string | null;\n  endMessage: string | null;\n  errorMessage: string | null;\n  timeoutMessage: string | null;\n  startButtonText: string | null;\n  restartButtonText: string | null;\n  welcomeTitle: string | null;\n  logoUrl: string | null;\n  mainColor: string;\n  fontFamily: string;\n  autoStart: boolean;\n  allowRestart: boolean;\n  runtimeType: 'form';\n  language: SupportedLocales;\n  sidebar: SidebarItem[];\n};\n\nexport function runnerDTOtoData(dto: FormRunnerDTO): FormRunnerData {\n  return {\n    id: dto.id,\n    path: dto.path,\n    theme: dto.workspace.theme ?? DEFAULT_THEME_COLOR,\n    brandName: dto.workspace.brand_name ?? null,\n    title: dto.title,\n    isInitial: dto.is_initial,\n    isLocal: dto.is_local ?? false,\n    startMessage: dto.start_message ?? null,\n    endMessage: dto.end_message ?? null,\n    errorMessage: dto.error_message ?? null,\n    timeoutMessage: dto.timeout_message ?? null,\n    startButtonText: dto.start_button_text ?? null,\n    restartButtonText: dto.restart_button_text ?? null,\n    logoUrl: dto.workspace.logo_url,\n    mainColor: dto.workspace.main_color ?? DEFAULT_MAIN_COLOR,\n    fontFamily: dto.workspace.font_family ?? DEFAULT_FORM_FONT_FAMILY,\n    autoStart: dto.auto_start ?? false,\n    allowRestart: dto.allow_restart,\n    welcomeTitle: dto.welcome_title ?? null,\n    runtimeType: 'form',\n    language: dto.workspace.language ?? DEFAULT_LANGUAGE.value,\n    sidebar: dto.workspace?.sidebar ?? [],\n  };\n}\n\nexport function workspaceDTOtoData(dto: Partial<WorkspaceRunnerDTO>): WorkspaceRunnerData {\n  const theme = dto.theme ?? DEFAULT_THEME_COLOR;\n\n  return {\n    name: dto.name || DEFAULT_APPLICATION_NAME,\n    fontColor: dto.font_color || DEFAULT_FONT_COLOR,\n    sidebar: dto.sidebar || [],\n    brandName: dto.brand_name || '',\n    fontFamily: dto.font_family || DEFAULT_FORM_FONT_FAMILY,\n    logoUrl: dto.logo_url ? makeAssetUrl('logo', dto.logo_url, 'player') : null,\n    mainColor: dto.main_color || DEFAULT_MAIN_COLOR,\n    theme: isColor(theme) ? theme : makeAssetUrl('background', theme, 'player'),\n    language: dto.language || DEFAULT_LANGUAGE.value,\n  };\n}\n","import { useUserStore } from '@/apps/player/auth/userStore';\nimport { FormRunnerData, runnerDTOtoData, workspaceDTOtoData } from '@/services/runnerData';\n\nexport async function fetchRunnerData(path: string): Promise<FormRunnerData | null> {\n  const userStore = useUserStore();\n\n  const result = await fetch(`/_pages/${path}`, {\n    headers: userStore.authHeaders,\n  });\n\n  if (result.status === 404) return null;\n  if (!result.ok) throw new Error(await result.text());\n\n  const { form } = await result.json();\n\n  if (!form) return null;\n\n  return runnerDTOtoData(form);\n}\n\nexport async function getWorkspace() {\n  const userStore = useUserStore();\n\n  const result = await fetch('/_workspace', {\n    headers: userStore.authHeaders,\n  });\n\n  if (result.status != 200) return workspaceDTOtoData({});\n  const dto = await result.json();\n\n  return workspaceDTOtoData(dto);\n}\n\nexport async function allow(path: string) {\n  const userStore = useUserStore();\n\n  const response = await fetch(`/_access-control/allow${path}`, {\n    headers: userStore.authHeaders,\n  });\n\n  return response.json();\n}\n","import { updateTitle } from '@/utils';\nimport {\n  RouteLocationNormalized,\n  RouteRecordRaw,\n  Router,\n  createRouter,\n  createWebHistory,\n} from 'vue-router';\nimport { allow } from './services/api';\n\ntype RouterMetadata = {\n  title?: string;\n  allowUnauthenticated?: boolean;\n};\n\ntype RouterRecordWithMeta = RouteRecordRaw & { meta?: RouterMetadata };\ntype RouterRecordWithChildrenMeta = RouteRecordRaw & { children: RouterRecordWithMeta[] };\ntype RouterRecord = RouterRecordWithMeta | RouterRecordWithChildrenMeta;\n\nexport const routerRecords = [\n  {\n    path: '/oidc-login-callback',\n    name: 'oidcLoginCallback',\n    component: () => import('@/apps/player/auth/OidcLoginCallback.vue'),\n    meta: { allowUnauthenticated: true },\n  },\n  {\n    path: '/oidc-logout-callback',\n    name: 'oidcLogoutCallback',\n    component: () => import('@/apps/player/auth/OidcLogoutCallback.vue'),\n    meta: { allowUnauthenticated: true },\n  },\n  {\n    path: '/login',\n    name: 'playerLogin',\n    component: () => import('./views/Login.vue'),\n    meta: { allowUnauthenticated: true },\n  },\n  {\n    path: '/',\n    name: 'main',\n    component: () => import('./views/Main.vue'),\n    redirect: { name: 'main' },\n    children: [\n      {\n        path: '',\n        name: 'playerHome',\n        component: () => import('./views/Home.vue'),\n        meta: { title: 'Home' },\n      },\n      {\n        // Legacy route\n        path: '_player/threads',\n        redirect: { name: 'playerThreads' },\n      },\n      {\n        path: 'error/:status',\n        name: 'error',\n        component: () => import('./views/Error.vue'),\n        meta: { allowUnauthenticated: true },\n      },\n      {\n        path: ':path(.*)*',\n        name: 'form',\n        component: () => import('./views/Form.vue'),\n        meta: { hideLogin: true },\n      },\n    ],\n  },\n] satisfies RouterRecord[];\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes: routerRecords,\n  scrollBehavior(to) {\n    if (to.hash) return { el: to.hash };\n  },\n});\n\nexport const guardFactory =\n  (router: Router) => async (to: RouteLocationNormalized, from: RouteLocationNormalized) => {\n    updateTitle(to, from);\n    const meta = to.meta as RouterMetadata;\n    if (meta.allowUnauthenticated) return;\n\n    const guard = await allow(to.path);\n    const { redirect, ...query } = to.query;\n\n    switch (guard.status) {\n      case 'ALLOWED':\n        break;\n\n      case 'UNAUTHORIZED':\n        await router.push({\n          name: 'playerLogin',\n          query: { ...query, redirect: redirect || to.path },\n          params: to.params,\n        });\n        break;\n\n      case 'NOT_FOUND':\n        await router.push({\n          name: 'error',\n          params: { status: '404' },\n        });\n        break;\n\n      default: // \"FORBIDDEN\"\n        await router.push({\n          name: 'error',\n          params: { status: '403' },\n        });\n    }\n  };\n\nrouter.beforeEach(guardFactory(router));\n\nexport default router;\n","import { WorkspaceRunnerData } from '@/services/runnerData';\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport { getWorkspace } from '../services/api';\n\ntype WorkspaceStoreState = {\n  workspace: WorkspaceRunnerData | null;\n  loading: boolean;\n};\n\nexport const useWorkspaceStore = defineStore('workspace', () => {\n  const state = ref<WorkspaceStoreState>({\n    workspace: null,\n    loading: false,\n  });\n\n  const actions = {\n    async fetch() {\n      state.value.loading = true;\n      state.value.workspace = await getWorkspace();\n      state.value.loading = false;\n    },\n  };\n\n  return { state, actions };\n});\n"],"file":"assets/workspaceStore-XJ3gN0Xg.js"}