<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250808T024848+0000" type="feat">
<gsl-header>

# Automate Post-Release Version Bump and Branch Cleanup (GitHub Actions)
</gsl-header>
<gsl-block>

<gsl-purpose>
<gsl-label>

## 1. Purpose    
</gsl-label>    
<gsl-description>

Automate the process of bumping the `pyproject.toml` version after a successful release and deployment to PyPI, while maintaining branch protection rules. Also automate the deletion of the `next` branch after merge, keeping the repository clean and workflow auditable.

</gsl-description>
</gsl-purpose>

<gsl-inputs>
<gsl-label>

## 2. Inputs
</gsl-label>
<gsl-description>

| Input | Notes |
| --- | --- |
| GitHub Actions | CI/CD pipeline runner |
| `pyproject.toml` | Contains project version field |
| GitHub CLI (`gh`) | Used for opening pull requests and deleting branches |
| Article: How to Automate Updating pyproject.toml Version After Release | Implementation steps |
| `.github/workflows/ci-cd.yml` | Main CI/CD workflow |
| `.github/workflows/bump-version.yml` | Post-release version bump workflow |
| `.github/workflows/delete-next.yml` | Branch cleanup workflow |

</gsl-description>
</gsl-inputs>

<gsl-outputs>
<gsl-label>

## 3. Outputs
</gsl-label>
<gsl-description>

- A workflow that automatically tags the code after successful deployment.
- A workflow that bumps the version in `pyproject.toml` via PR after a tag is pushed.
- A workflow that deletes the `next` branch after its PR is merged to `main`.
- Updated documentation describing this automated process.

</gsl-description>
</gsl-outputs>

<gsl-workflows>
<gsl-label>

## 4. Workflows
</gsl-label>
<gsl-description>

- Add permissions (`contents: write`) to the top of `.github/workflows/ci-cd.yml`.
- In the `deploy` job, after successful deploy to PyPI, create and push a tag matching the version in `pyproject.toml`.
- Add `.github/workflows/bump-version.yml` to listen for tag pushes, updating `pyproject.toml` and opening a PR to `main`.
- Add `.github/workflows/delete-next.yml` to automatically delete the `next` branch after merging a PR from `next` to `main`.
- Update README and documentation to clarify workflow and documentation timing (README before release, changelog after if auto-generated).

</gsl-description>
</gsl-workflows>
<gsl-acceptance-tests>
<gsl-label>

## 5. Acceptance Tests
</gsl-label>
<gsl-acceptance-test id="1">
<gsl-performed-action>

1. When I merge a PR to `main` with `[minor]` or `[patch]` in the commit message and the deploy is successful,
</gsl-performed-action>
<gsl-expected-result>

    Then the workflow deploys to PyPI, creates and pushes a tag matching the version in `pyproject.toml`, and triggers the bump-version workflow.
</gsl-expected-result>
</gsl-acceptance-test>

<gsl-acceptance-test id="2">
<gsl-performed-action>

2. When the tag is pushed, and the bump-version workflow runs,
</gsl-performed-action>
<gsl-expected-result>

    Then a PR is opened to `main` that bumps the version in `pyproject.toml` to match the tag.
</gsl-expected-result>
</gsl-acceptance-test>
<gsl-acceptance-test id="3">
<gsl-performed-action>

3. When a PR from the `next` branch is merged to `main`,
</gsl-performed-action>
<gsl-expected-result>
    
    Then the `next` branch is deleted automatically from the remote repository.
</gsl-expected-result>
</gsl-acceptance-test>

<gsl-acceptance-test id="4">
<gsl-performed-action>

4. When a user prepares a release, updates the README before release, and updates the changelog after release (if using GitHub-generated notes),
</gsl-performed-action>
<gsl-expected-result>
    
    Then the PyPI README is always accurate at release time, and changelog consistency is maintained for GitHub users.
</gsl-expected-result>
</gsl-acceptance-test>
</gsl-acceptance-tests>

</gsl-block>
</gsl-prompt>
