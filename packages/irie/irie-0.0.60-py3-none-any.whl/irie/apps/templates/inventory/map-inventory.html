<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>MapLibre – California Outline Only</title>
  <!-- MapLibre GL CSS -->
  <link
    href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"
    rel="stylesheet"
  />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    /* ------------------- Marker Styles ------------------- */
    /* 1) Small gray circle for Partial */
    .marker-partial {
      width: 6px;
      height: 6px;
      background-color: #929292;
      border-radius: 50%;
      border: 1px solid #555;
    }

    /* 2) Beige teardrop pin for Complete */
    .marker-complete {
      width: 30px;
      height: 44px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      /* A “teardrop pin” shape in beige (#F5F5DC) */
      background-image: url("data:image/svg+xml,%3Csvg width='30' height='44' viewBox='0 0 30 44' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 0C8.383 0 3 5.383 3 12c0 8.25 12 24.75 12 24.75S27 20.25 27 12c0-6.617-5.383-12-12-12zM15 16.4c-2.427 0-4.4-1.973-4.4-4.4 0-2.427 1.973-4.4 4.4-4.4 2.427 0 4.4 1.973 4.4 4.4 0 2.427-1.973 4.4-4.4 4.4z' fill='%23febf80' stroke='%23000' stroke-width='1'/%3E%3C/svg%3E");
    }

    /* 3) Blue teardrop pin for Instrumented */
    .marker-instrumented {
      width: 20px;
      height: 34px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      /* Same shape, but blue fill */
      background-image: url("data:image/svg+xml,%3Csvg width='30' height='44' viewBox='0 0 30 44' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 0C8.383 0 3 5.383 3 12c0 8.25 12 24.75 12 24.75S27 20.25 27 12c0-6.617-5.383-12-12-12zM15 16.4c-2.427 0-4.4-1.973-4.4-4.4 0-2.427 1.973-4.4 4.4-4.4 2.427 0 4.4 1.973 4.4 4.4 0 2.427-1.973 4.4-4.4 4.4z' fill='%232f9ad4' stroke='%23000' stroke-width='1'/%3E%3C/svg%3E");
    }
  </style>
</head>
<body>
  <div id="map" data-bridges='{{ data|safe }}'></div>

  <!-- MapLibre GL JS -->
  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>

  <script>
    // Example data structure (fake sample locations)
    const data = JSON.parse(document.getElementById('map').dataset.bridges);

    // Create the map
    const map = new maplibregl.Map({
      container: 'map',
      style: {
        "version": 8,
        "name": "California Outline Only",
        "sources": {
          "california-outline": {
            "type": "geojson",
            // Local GeoJSON file with California's outline
            "data": "/california.json"
          }
        },
        "layers": [
          {
            "id": "background",
            "type": "background",
            "paint": {
              "background-color": "#fff"
            }
          },
          {
            "id": "california-outline",
            "type": "line",
            "source": "california-outline",
            "paint": {
              "line-color": "#000",
              "line-width": 3
            }
          }
        ]
      },
      center: [-119.4179, 36.7783], // approx center of CA
      zoom: 5,
      maxPitch: 85,
    });

    // Once map loads, add markers
    map.on('load', () => {
      // Add Partial markers (small gray circles)
      data.Partial.forEach(point => {
        const el = document.createElement('div');
        el.className = 'marker-partial';
        new maplibregl.Marker({ element: el })
          .setLngLat([point.lon, point.lat])
          .addTo(map);
      });


      // Add Instrumented markers (blue pins)
      data.Instrumented.forEach(point => {
        const el = document.createElement('div');
        el.className = 'marker-instrumented';
        new maplibregl.Marker({ element: el })
          .setLngLat([point.lon, point.lat])
          .addTo(map);
      });


      // Add Complete markers (beige pins)
      data.Complete.forEach(point => {
        const el = document.createElement('div');
        el.className = 'marker-complete';
        new maplibregl.Marker({ element: el })
          .setLngLat([point.lon, point.lat+0.2])
          .addTo(map);
      });
    });
  </script>
</body>
</html>
