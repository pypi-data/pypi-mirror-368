{% extends "layouts/base.html" %}

{% block title %} {{ asset.calid }} | Upload {% endblock %} 

{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}
<div class="print">
  <div class="col-10 mb-4 d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center py-4">
    <div class="d-block mb-4 mb-md-0">
        <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
          <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
            <li class="breadcrumb-item">
              <a href="{% url 'dashboard' %}">
                <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
              </a>
            </li>
            <li class="breadcrumb-item text-dark" aria-current="page"><a href="{% url 'asset_table' %}">Inventory</a></li>
            <li class="breadcrumb-item"><a href="{% url 'asset_profile' calid=asset.calid %}"><code>{{ asset.calid }}</code></a></li>
            <li class="breadcrumb-item"><a href="/inventory/{{ asset.calid }}/predictors/">Predictors</a></li>
            <li class="breadcrumb-item active">Upload</li>
          </ol>
        </nav>
        <h1 class="h4"><samp>{{ asset.id }}</samp> / {{ asset.calid }} Predictor Upload</h1>
    </div>
    <div class="btn-toolbar mb-2 mb-md-0">
      <a role="button" 
         href="/inventory/{{ asset.calid }}/predictors/"
         class="btn btn-sm btn-outline-primary d-inline-flex align-items-center mx-1">
            Predictors
      </a>
      <a role="button" 
         href="{% url 'asset_sensors' calid=asset.calid %}"
         class="btn btn-sm btn-outline-primary d-inline-flex align-items-center mx-1">
            Sensors
      </a>
    </div>
  </div>

  <div class="row align-right">
    <div class="col-md-4">
      <div class="card bg-white-100 border-1 rounded-0 shadow">
        <div class="card-header">
          <h3 class="mb-0">Sensors</h3>
        </div>
        <div class="card-body">
          <ul class="list-group">
            <li class="list-group-item active" aria-current="true">Datum</li>
            <li class="list-group-item">Structure</li>
            <li class="list-group-item">Sensors</li>
            <li class="list-group-item">Submit</li>
          </ul>
        </div> 
      </div>
    </div>

    <div class="col-md-8">
      <div class="card bg-white-100 border-1 rounded-0 shadow">
        <div class="card-body">
          <div class="col">
            <form method="POST" enctype="multipart/form-data">
              {% csrf_token %}
              {{ form.as_p}}
              <button id="render" type="button"  class="btn btn-outline-primary" >Render</button>
              <button type="submit" class="btn btn-primary" name="action" value="commit">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>



  {% if navigator %}
  {% include "prediction/veux/navigator.html" with members=navigator.members sections=navigator.sections %}
  {% endif %}

  <div class="row">
    <iframe
      id="map"
      width="100%"
      height="400"
    >
    </iframe>
  </div>
</div>
{% endblock content %}

{% block javascripts %}

<script>
  const button = document.getElementById('render');
  const form = document.querySelector('form');
  const map = document.getElementById('map');
  button.addEventListener('click', function(event) {
    event.preventDefault();
    fetch('/inventory/{{ asset.calid }}/predictors/create/map/', {
      method: 'POST',
      body: new FormData(form)
    }).then(response => response.text())
      .then(data => {
        const blob = new Blob([data], { type: 'text/html' });
        const url = window.URL.createObjectURL(blob);
        map.src = url;
      })
      .catch(error => {
        console.error('Error fetching map:', error);
      });
  });
</script>
{% endblock javascripts %}
