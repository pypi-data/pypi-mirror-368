$(document).ready(()=>{const n=$("select#id_announcement_target"),s=$("select#id_announcement_channel"),o=$('input[name="csrfmiddlewaretoken"]'),t=$('textarea[name="announcement_text"]'),r=$("#aa-discord-announcements-form"),u=e=>e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date),a=async({url:e,method:n="get",csrfToken:s=null,payload:o=null,responseIsJson:t=!0})=>{const r=n.toLowerCase(),a=["get","post"];if(!a.includes(r))throw new Error(`Invalid method: ${n}. Valid methods are: get, post`);const c={};t&&(c.Accept="application/json",c["Content-Type"]="application/json");let l=e,i=null;if("post"===r){if(!s)throw new Error("CSRF token is required for POST requests");if(c["X-CSRFToken"]=s,null!==o&&!u(o))throw new Error("Payload must be an object when using POST method");i=o?JSON.stringify(o):null}else if("get"===r&&o){const d=new URLSearchParams(o).toString();l+=(e.includes("?")?"&":"?")+d}try{const m=await fetch(l,{method:n.toUpperCase(),headers:c,body:i});if(m.ok)return t?await m.json():await m.text();throw new Error(`HTTP error! Status: ${m.status}`)}catch(e){throw console.log(`Error: ${e.message}`),e}},e=({url:e,payload:n=null,responseIsJson:s=!0})=>a({url:e,method:"get",payload:n,responseIsJson:s}),c=({url:e,csrfToken:n,payload:s=null,responseIsJson:o=!0})=>a({url:e,method:"post",csrfToken:n,payload:s,responseIsJson:o}),l=()=>{e({url:discordAnnouncementsSettings.url.getAnnouncementTargets,responseIsJson:!1}).then(e=>{""!==e&&$(n).html(e)}).catch(e=>{console.error("Error fetching announcement targets:",e)})},i=()=>{e({url:discordAnnouncementsSettings.url.getAnnouncementWebhooks,responseIsJson:!1}).then(e=>{""!==e&&$(s).html(e)}).catch(e=>{console.error("Error fetching announcement webhooks:",e)})},d=(e,n=10)=>{$(e).fadeTo(1e3*n,500).slideUp(500,()=>{$(e).remove()})},m=(e,n)=>{$(n).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),d(".alert-message-success")},g=(e,n)=>{$(n).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),d(".alert-message-error",9999)},p=()=>{const n=new ClipboardJS("button#copyDiscordAnnouncement");n.on("success",e=>{m(discordAnnouncementsSettings.translation.copyToClipboard.success,".aa-discord-announcements-announcement-copyresult"),e.clearSelection(),n.destroy()}),n.on("error",()=>{g(discordAnnouncementsSettings.translation.copyToClipboard.error,".aa-discord-announcements-announcement-copyresult"),n.destroy()})};r.submit(e=>{e.preventDefault(),$(".aa-discord-announcements-form-message div").remove();const n=[t.val()];if(n.includes(""))return g(discordAnnouncementsSettings.translation.error.missingFields,".aa-discord-announcements-form-message"),!1;const s=r.serializeArray().reduce((e,n)=>(e[n.name]=n.value,e),{});c({url:discordAnnouncementsSettings.url.createAnnouncement,csrfToken:o.val(),payload:s,responseIsJson:!0}).then(e=>{!0===e.success?($(".aa-discord-announcements-no-announcement").hide("fast"),$(".aa-discord-announcements-announcement").show("fast"),$(".aa-discord-announcements-announcement-text").html(e.announcement_context),e.message&&m(e.message,".aa-discord-announcements-form-message")):g(e.message||"Something went wrong, no details given.",".aa-discord-announcements-form-message")}).catch(e=>{console.error(`Error: ${e.message}`),g(e.message||"Something went wrong, no details given.",".aa-discord-announcements-form-message")})}),$("button#copyDiscordAnnouncement").on("click",()=>{p()}),l(),i()});
//# sourceMappingURL=aa-discord-announcements.min.js.map