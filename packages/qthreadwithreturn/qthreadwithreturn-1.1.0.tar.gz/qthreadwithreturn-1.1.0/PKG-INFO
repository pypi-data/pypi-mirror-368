Metadata-Version: 2.4
Name: qthreadwithreturn
Version: 1.1.0
Summary: PySide6 é«˜çº§çº¿ç¨‹å·¥å…·åº“ - å¸¦è¿”å›å€¼çš„çº¿ç¨‹ç±»å’Œçº¿ç¨‹æ± æ‰§è¡Œå™¨
Author-email: PythonImporter <271374667@qq.com>
Maintainer-email: PythonImporter <271374667@qq.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/271374667/QThreadWithReturn
Project-URL: Repository, https://github.com/271374667/QThreadWithReturn.git
Project-URL: Issues, https://github.com/271374667/QThreadWithReturn/issues
Keywords: qt,pyside6,threading,concurrent,futures,gui,pyqt,async,thread-pool,worker-thread
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyside6>=6.4.0
Dynamic: license-file

<center>

# QThreadWithReturn

![QThreadWithReturn](https://socialify.git.ci/271374667/QThreadWithReturn/image?description=1&language=1&name=1&pattern=Plus&theme=Auto)


[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://python.org)
[![PySide6](https://img.shields.io/badge/PySide6-6.4+-green.svg)](https://www.qt.io/qt-for-python)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Tests](https://img.shields.io/badge/Tests-73%20passed-brightgreen.svg)](tests/)


</center>

**PySide6 é«˜çº§çº¿ç¨‹å·¥å…·åº“** - ä¸“ä¸º GUI åº”ç”¨è®¾è®¡çš„çº¿ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè®©ç•Œé¢æ°¸ä¸å¡é¡¿ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹å˜å¾—ç®€å•ç›´è§‚ã€‚

> ğŸ¯ **æ ¸å¿ƒä½¿å‘½**: ä»£æ›¿ QThread åŸæœ¬ç¹æ‚çš„ä¿¡å·ä¸æ§½æœºåˆ¶ï¼Œä¸ºç®€å•çš„è€—æ—¶ä»»åŠ¡æä¾›æ›´ç®€å•ã€æ›´ç›´è§‚çš„çº¿ç¨‹ç¼–ç¨‹ä½“éªŒã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ QThreadWithReturn - å¸¦è¿”å›å€¼çš„çº¿ç¨‹ç±»
- **ğŸ”„ æ”¯æŒè·å–çº¿ç¨‹æ‰§è¡Œç»“æœ** - ç±»ä¼¼ `concurrent.futures.Future` çš„ API
- **ğŸ¨ çµæ´»çš„å›è°ƒæœºåˆ¶** - æ”¯æŒæ— å‚æ•°ã€å•å‚æ•°ã€å¤šå‚æ•°å›è°ƒï¼Œè‡ªåŠ¨è§£åŒ…è¿”å›å€¼
- **â° è¶…æ—¶æ§åˆ¶** - æ”¯æŒçº¿ç¨‹è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ
- **ğŸ›‘ ä¼˜é›…å–æ¶ˆä¸å¼ºåˆ¶ç»ˆæ­¢** - æ”¯æŒä¼˜é›…å–æ¶ˆå’Œå¼ºåˆ¶ç»ˆæ­¢
- **ğŸ”„ è‡ªåŠ¨å¤„ç† Qt äº‹ä»¶å¾ªç¯** - é¿å…ç•Œé¢å†»ç»“
- **ğŸ”’ çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†** - å®‰å…¨çš„çŠ¶æ€åŒæ­¥æœºåˆ¶

### ğŸŠâ€â™‚ï¸ QThreadPoolExecutor - çº¿ç¨‹æ± æ‰§è¡Œå™¨  
- **ğŸ”— API å…¼å®¹** - å®Œå…¨å…¼å®¹ `concurrent.futures.ThreadPoolExecutor`
- **âš¡ è‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ** - æ™ºèƒ½ä»»åŠ¡è°ƒåº¦å’Œçº¿ç¨‹å¤ç”¨
- **ğŸ›ï¸ æ”¯æŒçº¿ç¨‹åˆå§‹åŒ–å™¨å’Œå‘½å** - ä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **ğŸ”„ æ”¯æŒ `as_completed` ç­‰æ ‡å‡†æ¥å£** - ç†Ÿæ‚‰çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼
- **ğŸ“¦ æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†å™¨** - è‡ªåŠ¨èµ„æºæ¸…ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä½¿ç”¨ uv (æ¨è)
uv add qthreadwithreturn

# ä½¿ç”¨ pip  
pip install qthreadwithreturn
```

### ğŸ–¥ï¸ GUI åº”ç”¨ä¸­çš„ä¼˜åŠ¿ - ç•Œé¢æ°¸ä¸å¡é¡¿

QThreadWithReturn çš„æœ€å¤§ä¼˜åŠ¿æ˜¯åœ¨ GUI åº”ç”¨ä¸­æ‰§è¡Œè€—æ—¶ä»»åŠ¡æ—¶ï¼Œ**ç•Œé¢ä¿æŒå“åº”ï¼Œç”¨æˆ·ä½“éªŒæµç•…**ã€‚

#### âŒ ä¼ ç»Ÿåšæ³•ï¼šç•Œé¢å¡æ­»

```python
from PySide6.QtWidgets import QApplication, QMainWindow, QPushButton, QLabel
import time

class BadExample(QMainWindow):
    def __init__(self):
        super().__init__()
        self.button = QPushButton("å¼€å§‹è€—æ—¶ä»»åŠ¡ (ç•Œé¢ä¼šå¡æ­»)")
        self.label = QLabel("å‡†å¤‡å°±ç»ª")
        self.button.clicked.connect(self.bad_long_task)
    
    def bad_long_task(self):
        """âŒ é”™è¯¯ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè€—æ—¶ä»»åŠ¡"""
        self.label.setText("å¤„ç†ä¸­...")
        time.sleep(5)  # ç•Œé¢å¡æ­»5ç§’ï¼
        self.label.setText("å®Œæˆ")
```

#### âœ… QThreadWithReturnï¼šç•Œé¢å§‹ç»ˆå“åº”

```python
from PySide6.QtWidgets import QApplication, QMainWindow, QPushButton, QLabel, QProgressBar
from qthreadwithreturn import QThreadWithReturn
import time

class GoodExample(QMainWindow):
    def __init__(self):
        super().__init__()
        self.button = QPushButton("å¼€å§‹è€—æ—¶ä»»åŠ¡ (ç•Œé¢ä¿æŒå“åº”)")
        self.label = QLabel("å‡†å¤‡å°±ç»ª")
        self.progress = QProgressBar()
        self.button.clicked.connect(self.good_long_task)
    
    def good_long_task(self):
        """âœ… æ­£ç¡®ï¼šä½¿ç”¨ QThreadWithReturn"""
        def heavy_computation():
            # æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—ï¼šæ•°æ®åˆ†æã€æ–‡ä»¶å¤„ç†ã€ç½‘ç»œè¯·æ±‚ç­‰
            for i in range(100):
                time.sleep(0.05)  # æ€»å…±5ç§’
                # å¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥å–æ¶ˆè¯·æ±‚
            return "è®¡ç®—å®Œæˆï¼"
        
        # åˆ›å»ºçº¿ç¨‹
        self.thread = QThreadWithReturn(heavy_computation)
        
        # è®¾ç½®å¼€å§‹çŠ¶æ€
        self.button.setEnabled(False)
        self.label.setText("åå°å¤„ç†ä¸­...")
        self.progress.setRange(0, 0)  # ä¸ç¡®å®šè¿›åº¦
        
        # æ·»åŠ å®Œæˆå›è°ƒï¼ˆè‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå®‰å…¨æ›´æ–°UIï¼‰
        self.thread.add_done_callback(self.on_task_completed)
        
        # æ·»åŠ é”™è¯¯å¤„ç†
        self.thread.add_failure_callback(self.on_task_failed)
        
        # å¯åŠ¨çº¿ç¨‹
        self.thread.start()
        # ç•Œé¢ç«‹å³å“åº”ï¼Œç”¨æˆ·å¯ä»¥ç»§ç»­æ“ä½œå…¶ä»–æ§ä»¶ï¼
    
    def on_task_completed(self, result):
        """ä»»åŠ¡å®Œæˆå›è°ƒ - åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå®‰å…¨æ›´æ–°UI"""
        self.button.setEnabled(True)
        self.label.setText(f"âœ… {result}")
        self.progress.setRange(0, 1)
        self.progress.setValue(1)
    
    def on_task_failed(self, exception):
        """ä»»åŠ¡å¤±è´¥å›è°ƒ"""
        self.button.setEnabled(True)
        self.label.setText(f"âŒ å‡ºé”™äº†: {exception}")
        self.progress.setRange(0, 1)
```

#### ğŸŠâ€â™‚ï¸ çº¿ç¨‹æ± ï¼šå¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡

```python
class BatchProcessingExample(QMainWindow):
    def __init__(self):
        super().__init__()
        self.start_btn = QPushButton("æ‰¹é‡å¤„ç†æ–‡ä»¶")
        self.progress = QProgressBar()
        self.status = QLabel("å°±ç»ª")
        self.start_btn.clicked.connect(self.process_files)
    
    def process_files(self):
        file_list = ["file1.txt", "file2.txt", "file3.txt", "file4.txt"]
        
        def process_single_file(filename):
            # æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†ï¼šè§£æã€è½¬æ¢ã€ä¸Šä¼ ç­‰
            time.sleep(2)
            return f"{filename} å¤„ç†å®Œæˆ"
        
        # åˆ›å»ºçº¿ç¨‹æ± 
        self.pool = QThreadPoolExecutor(max_workers=2)
        self.completed_count = 0
        self.total_files = len(file_list)
        
        # UIçŠ¶æ€
        self.progress.setMaximum(self.total_files)
        self.progress.setValue(0)
        self.status.setText("æ‰¹é‡å¤„ç†ä¸­...")
        
        # æäº¤æ‰€æœ‰ä»»åŠ¡
        for filename in file_list:
            future = self.pool.submit(process_single_file, filename)
            future.add_done_callback(self.on_file_completed)
    
    def on_file_completed(self, result):
        """å•ä¸ªæ–‡ä»¶å®Œæˆå›è°ƒ"""
        self.completed_count += 1
        self.progress.setValue(self.completed_count)
        self.status.setText(f"å·²å®Œæˆ {self.completed_count}/{self.total_files}: {result}")
        
        if self.completed_count == self.total_files:
            self.status.setText("âœ… æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆï¼")
            self.pool.shutdown()
```

## ğŸ†š ä¸ä¼ ç»Ÿ QThread å¯¹æ¯”

### âŒ ä¼ ç»Ÿ QThread çš„å¤æ‚æ€§

```python
from PySide6.QtCore import QThread, QObject, pyqtSignal

# ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦å¤§é‡æ ·æ¿ä»£ç 
class Worker(QObject):
    finished = pyqtSignal(object)  # éœ€è¦æ‰‹åŠ¨å®šä¹‰ä¿¡å·
    error = pyqtSignal(Exception)
    
    def __init__(self, func, *args, **kwargs):
        super().__init__()
        self.func = func
        self.args = args
        self.kwargs = kwargs
    
    def run(self):
        try:
            result = self.func(*self.args, **self.kwargs)
            self.finished.emit(result)  # æ‰‹åŠ¨å‘å°„ä¿¡å·
        except Exception as e:
            self.error.emit(e)

# ä½¿ç”¨æ—¶éœ€è¦æ›´å¤šä»£ç 
def traditional_approach():
    thread = QThread()
    worker = Worker(my_function, arg1, arg2)
    worker.moveToThread(thread)
    
    # æ‰‹åŠ¨è¿æ¥ä¿¡å·
    thread.started.connect(worker.run)
    worker.finished.connect(lambda result: print(f"ç»“æœ: {result}"))
    worker.finished.connect(thread.quit)
    worker.finished.connect(worker.deleteLater)
    thread.finished.connect(thread.deleteLater)
    
    thread.start()
    # æ— æ³•ç›´æ¥è·å–è¿”å›å€¼ï¼éœ€è¦é¢å¤–å¤„ç†
```

### âœ… QThreadWithReturn çš„ç®€æ´æ€§

```python
# ä¸€è¡Œåˆ›å»ºï¼Œè‡ªåŠ¨å¤„ç†æ‰€æœ‰ç»†èŠ‚ï¼
thread = QThreadWithReturn(my_function, arg1, arg2)
thread.add_done_callback(lambda result: print(f"ç»“æœ: {result}"))
thread.start()

# ç›´æ¥è·å–è¿”å›å€¼
result = thread.result()  # å°±è¿™ä¹ˆç®€å•ï¼
```

### ğŸ”¥ æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿ QThread | QThreadWithReturn |
|------|-------------|------------------|
| **ä»£ç é‡** | 20+ è¡Œæ ·æ¿ä»£ç  | 3 è¡Œæ ¸å¿ƒä»£ç  |
| **è¿”å›å€¼** | âŒ éœ€è¦ä¿¡å·ä¼ é€’ | âœ… ç›´æ¥ `result()` è·å– |
| **é”™è¯¯å¤„ç†** | âŒ æ‰‹åŠ¨ä¿¡å·è¿æ¥ | âœ… è‡ªåŠ¨å¼‚å¸¸ä¼ æ’­ + å›è°ƒ |
| **èµ„æºæ¸…ç†** | âŒ æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ | âœ… è‡ªåŠ¨æ¸…ç†èµ„æº |
| **è¶…æ—¶æ§åˆ¶** | âŒ éœ€è¦é¢å¤–å®ç° | âœ… å†…ç½®è¶…æ—¶æœºåˆ¶ |
| **å–æ¶ˆä»»åŠ¡** | âŒ å¤æ‚çš„ä¸­æ–­å¤„ç† | âœ… ä¸€é”®å–æ¶ˆ `cancel()` |
| **çº¿ç¨‹æ± ** | âŒ éœ€è¦è‡ªå·±å®ç° | âœ… å®Œæ•´çš„çº¿ç¨‹æ± æ”¯æŒ |
| **å­¦ä¹ æˆæœ¬** | âŒ éœ€è¦æ·±å…¥ç†è§£Qtä¿¡å· | âœ… ç¬¦åˆç›´è§‰çš„API |

## ğŸ“š é«˜çº§åŠŸèƒ½

### ğŸ¨ çµæ´»çš„å›è°ƒæœºåˆ¶

```python
# æ— å‚æ•°å›è°ƒ
thread.add_done_callback(lambda: print("ä»»åŠ¡å®Œæˆ!"))

# å•å‚æ•°å›è°ƒ
thread.add_done_callback(lambda result: print(f"ç»“æœ: {result}"))

# å¤šå‚æ•°å›è°ƒ - æ”¯æŒè‡ªåŠ¨è§£åŒ…
def multi_return_task():
    return 1, 2, 3

thread = QThreadWithReturn(multi_return_task)
thread.add_done_callback(lambda a, b, c: print(f"{a}, {b}, {c}"))  # è‡ªåŠ¨è§£åŒ…

# ç±»æ–¹æ³•å›è°ƒ
class ResultHandler:
    def handle_result(self, result):
        self.result = result

handler = ResultHandler()
thread.add_done_callback(handler.handle_result)
```

### â° è¶…æ—¶æ§åˆ¶

```python
# è®¾ç½®5ç§’è¶…æ—¶
thread.start(timeout_ms=5000)

try:
    result = thread.result(timeout=5.0)
except TimeoutError:
    print("ä»»åŠ¡è¶…æ—¶")
except Exception as e:
    print(f"ä»»åŠ¡å¤±è´¥: {e}")
```

### ğŸ›‘ ä»»åŠ¡å–æ¶ˆ

```python
# ä¼˜é›…å–æ¶ˆï¼ˆæ¨èï¼‰
success = thread.cancel()

# å¼ºåˆ¶ç»ˆæ­¢ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
success = thread.cancel(force_stop=True)

# æ£€æŸ¥çŠ¶æ€
if thread.cancelled():
    print("ä»»åŠ¡å·²å–æ¶ˆ")
```

### ğŸ”„ é”™è¯¯å¤„ç†

```python
def failing_task():
    raise ValueError("æ¨¡æ‹Ÿé”™è¯¯")

thread = QThreadWithReturn(failing_task)

# æ·»åŠ å¤±è´¥å›è°ƒ
thread.add_failure_callback(lambda exc: print(f"ä»»åŠ¡å¤±è´¥: {exc}"))

thread.start()

try:
    result = thread.result()
except ValueError as e:
    print(f"æ•è·å¼‚å¸¸: {e}")
```

### ğŸŠâ€â™‚ï¸ çº¿ç¨‹æ± é«˜çº§ç”¨æ³•

```python
def init_worker(worker_name):
    """å·¥ä½œçº¿ç¨‹åˆå§‹åŒ–"""
    print(f"åˆå§‹åŒ–å·¥ä½œçº¿ç¨‹: {worker_name}")

def compute_task(x):
    return x ** 2

with QThreadPoolExecutor(
    max_workers=4,
    thread_name_prefix="è®¡ç®—çº¿ç¨‹",
    initializer=init_worker,
    initargs=("æ•°æ®å¤„ç†å™¨",)
) as pool:
    # æäº¤ä»»åŠ¡å¹¶æ·»åŠ å›è°ƒ
    future = pool.submit(compute_task, 10)
    future.add_done_callback(lambda result: print(f"è®¡ç®—å®Œæˆ: {result}"))
    
    # ç­‰å¾…ç»“æœ
    print(future.result())  # è¾“å‡º: 100
```

## ğŸ® åœ¨çº¿æ¼”ç¤ºç¨‹åº

### ğŸ†š GUI å¯¹æ¯”æ¼”ç¤º - ç›´è§‚æ„Ÿå—å·®å¼‚
è¿è¡Œäº¤äº’å¼å¯¹æ¯”ç¨‹åºï¼Œç›´è§‚ä½“éªŒç•Œé¢å“åº”æ€§çš„å·¨å¤§å·®å¼‚ï¼š

```bash
# å¯¹æ¯”æ¼”ç¤ºï¼šä¼ ç»Ÿæ–¹æ³• vs QThreadWithReturn
python examples/gui_demo_comparison.py
```

**æ¼”ç¤ºå†…å®¹**:
- **âŒ ä¼ ç»Ÿåšæ³•æ ‡ç­¾é¡µ**: ç‚¹å‡»æŒ‰é’®åç•Œé¢å¡æ­»5ç§’ï¼Œæ»‘å—æ— æ³•æ‹–åŠ¨
- **âœ… QThreadWithReturnæ ‡ç­¾é¡µ**: ç•Œé¢å§‹ç»ˆå“åº”ï¼Œæ‰€æœ‰æ§ä»¶æ­£å¸¸å·¥ä½œ
- **ğŸŠâ€â™‚ï¸ çº¿ç¨‹æ± æ ‡ç­¾é¡µ**: å¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå®æ—¶æ˜¾ç¤ºè¿›åº¦

### ğŸ“± å®Œæ•´åŠŸèƒ½æ¼”ç¤º
é¡¹ç›®è¿˜åŒ…å«åŠŸèƒ½å®Œæ•´çš„ GUI æ¼”ç¤ºç¨‹åºï¼š

```bash
# å®Œæ•´åŠŸèƒ½æ¼”ç¤º
python -m demo.thread_demo_gui
```

### ğŸ’» å‘½ä»¤è¡Œç¤ºä¾‹
åŸºç¡€åŠŸèƒ½å¿«é€Ÿä½“éªŒï¼š

```bash
# åŸºæœ¬ç”¨æ³•ç¤ºä¾‹
python examples/basic_usage.py
```

![QThreadWithReturn Demo](https://via.placeholder.com/700x450?text=QThreadWithReturn+GUI+Demo+%E2%80%93+%E7%95%8C%E9%9D%A2%E6%B0%B8%E4%B8%8D%E5%8D%A1%E9%A1%BF)

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

QThreadWithReturn ç‰¹åˆ«é€‚åˆä»¥ä¸‹ GUI åº”ç”¨åœºæ™¯ï¼š

### ğŸ“Š **æ•°æ®å¤„ç†åº”ç”¨**
```python
# å¤§æ•°æ®åˆ†æã€Excelå¤„ç†ã€CSVå¯¼å…¥å¯¼å‡º
thread = QThreadWithReturn(pandas.read_csv, "large_file.csv")
thread.add_done_callback(lambda df: self.update_table_view(df))
```

### ğŸŒ **ç½‘ç»œåº”ç”¨**
```python  
# HTTPè¯·æ±‚ã€æ–‡ä»¶ä¸‹è½½ã€APIè°ƒç”¨
thread = QThreadWithReturn(requests.get, "https://api.example.com/data")
thread.add_done_callback(lambda resp: self.display_data(resp.json()))
```

### ğŸ¨ **å›¾åƒå¤„ç†å·¥å…·**
```python
# å›¾åƒæ»¤é•œã€æ ¼å¼è½¬æ¢ã€æ‰¹é‡å¤„ç†
with QThreadPoolExecutor(max_workers=4) as pool:
    futures = [pool.submit(process_image, img) for img in images]
    for future in pool.as_completed(futures):
        self.update_progress()
```

### ğŸ“ **æ–‡ä»¶ç®¡ç†å™¨**
```python
# æ–‡ä»¶æœç´¢ã€æ‰¹é‡é‡å‘½åã€å¤§æ–‡ä»¶å¤åˆ¶
thread = QThreadWithReturn(shutil.copy2, source, destination)  
thread.add_done_callback(lambda: self.refresh_file_list())
```

### ğŸ¤– **AI/æœºå™¨å­¦ä¹ å·¥å…·**
```python
# æ¨¡å‹è®­ç»ƒã€å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†
thread = QThreadWithReturn(model.predict, input_data)
thread.add_done_callback(lambda result: self.show_predictions(result))
```

## ğŸ”§ å…¼å®¹æ€§

- **Python**: 3.10+ (å®Œæ•´æ”¯æŒ 3.11+)
- **Qt ç‰ˆæœ¬**: PySide6 6.4+  
- **æ“ä½œç³»ç»Ÿ**: Windows, macOS, Linux
- **ç‰¹æ®Šæ”¯æŒ**: 
  - âœ… æœ‰ Qt åº”ç”¨ç¯å¢ƒï¼šä½¿ç”¨ Qt ä¿¡å·æœºåˆ¶ï¼Œå®Œæ•´åŠŸèƒ½
  - âœ… æ—  Qt åº”ç”¨ç¯å¢ƒï¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ ‡å‡†çº¿ç¨‹æ¨¡å¼
  - âœ… å¤šPythonç‰ˆæœ¬ï¼šåœ¨ 3.10ã€3.11ã€3.13 ä¸­æµ‹è¯•é€šè¿‡

## ğŸ§ª æµ‹è¯•

é¡¹ç›®å…·æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–ç‡ï¼ŒåŒ…å« 73 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_thread_utils.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=qthreadwithreturn
```

## ğŸ“– API æ–‡æ¡£

### QThreadWithReturn

| æ–¹æ³• | æè¿° |
|------|------|
| `start(timeout_ms=-1)` | å¯åŠ¨çº¿ç¨‹ï¼Œå¯é€‰è¶…æ—¶è®¾ç½® |
| `result(timeout=None)` | è·å–æ‰§è¡Œç»“æœï¼Œé˜»å¡ç­‰å¾… |
| `exception(timeout=None)` | è·å–å¼‚å¸¸ä¿¡æ¯ |
| `cancel(force_stop=False)` | å–æ¶ˆçº¿ç¨‹æ‰§è¡Œ |
| `running()` | æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œ |
| `done()` | æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ |
| `cancelled()` | æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ |
| `add_done_callback(callback)` | æ·»åŠ æˆåŠŸå®Œæˆå›è°ƒ |
| `add_failure_callback(callback)` | æ·»åŠ å¤±è´¥å›è°ƒ |

### QThreadPoolExecutor  

| æ–¹æ³• | æè¿° |
|------|------|
| `submit(fn, *args, **kwargs)` | æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ±  |
| `shutdown(wait=True, cancel_futures=False, force_stop=False)` | å…³é—­çº¿ç¨‹æ±  |
| `as_completed(futures, timeout=None)` | æŒ‰å®Œæˆé¡ºåºè¿­ä»£ Future å¯¹è±¡ |

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

```python
# 1. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨è‡ªåŠ¨èµ„æºæ¸…ç†
with QThreadPoolExecutor(max_workers=4) as pool:
    futures = [pool.submit(task, i) for i in range(10)]
    results = [f.result() for f in futures]

# 2. åœ¨å›è°ƒä¸­æ›´æ–° UIï¼ˆå›è°ƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼‰
def update_progress(result):
    progress_bar.setValue(result)
    
thread.add_done_callback(update_progress)

# 3. åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
thread.start(timeout_ms=30000)  # 30ç§’è¶…æ—¶

# 4. å¼‚å¸¸å¤„ç†
try:
    result = thread.result()
except Exception as e:
    logger.error(f"ä»»åŠ¡å¤±è´¥: {e}")
```

### âŒ é¿å…çš„åšæ³•

```python
# âŒ ä¸è¦åœ¨å·¥ä½œçº¿ç¨‹ä¸­ç›´æ¥æ›´æ–° UI
def bad_worker():
    label.setText("æ›´æ–°")  # é”™è¯¯ï¼è·¨çº¿ç¨‹UIæ›´æ–°

# âŒ ä¸è¦å¿˜è®°èµ„æºæ¸…ç†  
pool = QThreadPoolExecutor()
# ... ä½¿ç”¨poolä½†å¿˜è®°è°ƒç”¨shutdown()

# âŒ ä¸è¦è¿‡åº¦ä½¿ç”¨å¼ºåˆ¶ç»ˆæ­¢
thread.cancel(force_stop=True)  # å¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/qthreadwithreturn.git
cd qthreadwithreturn

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–
uv sync

# è¿è¡Œæµ‹è¯•
uv run pytest

# è¿è¡Œæ¼”ç¤º
uv run python -m demo.thread_demo_gui
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ Qt å›¢é˜Ÿæä¾›å¼ºå¤§çš„è·¨å¹³å°æ¡†æ¶
- æ„Ÿè°¢ Python ç¤¾åŒºçš„ `concurrent.futures` è®¾è®¡çµæ„Ÿ
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒ

## ğŸ“ æ”¯æŒ

- ğŸ› **é—®é¢˜æŠ¥å‘Š**: [GitHub Issues](https://github.com/your-username/qthreadwithreturn/issues)
- ğŸ’¬ **è®¨è®º**: [GitHub Discussions](https://github.com/your-username/qthreadwithreturn/discussions)
- ğŸ“§ **é‚®ä»¶**: your-email@example.com

---

<div align="center">

**è®©å¤šçº¿ç¨‹ç¼–ç¨‹å˜å¾—ç®€å•ç›´è§‚** âœ¨

[â­ ç»™ä¸ªæ˜Ÿæ ‡](https://github.com/your-username/qthreadwithreturn) | [ğŸ“– æŸ¥çœ‹æ–‡æ¡£](https://qthreadwithreturn.readthedocs.io) | [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)

</div>
