import{r as c,E as U,_ as x,s as p,aq as j,aF as g,j as o,bN as f,bO as y,bq as q,br as S,bH as _,F as K,c4 as G,aB as J,bJ as Y,D as m,b as F,bL as Q,bK as Z,bR as ee,c5 as te,bS as ie,bv as le,bT as se}from"./index.Dc_WcSRe.js";import{F as ne}from"./FormClearHelper.DgvKxH31.js";import{g as I,F as w,b as oe,D as ae,I as re,C as de,a as ce,s as pe}from"./FileHelper.B9JGpwLR.js";import{S as ge,P as ue}from"./ProgressBar.DN8pY8Fb.js";import{u as he}from"./Hooks.DVrID-yk.js";import{U as v}from"./UploadFileInfo.C-jY39rj.js";var C=c.forwardRef(function(e,l){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(U,x({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:l}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});C.displayName="ChevronLeft";var b=c.forwardRef(function(e,l){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(U,x({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:l}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});b.displayName="ChevronRight";var D=c.forwardRef(function(e,l){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(U,x({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:l}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});D.displayName="CloudUpload";var M=c.forwardRef(function(e,l){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(U,x({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:l}),c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});M.displayName="Error";const B=p("section",{target:"eamlidg0"})(({isDisabled:e,theme:l})=>({display:"flex",alignItems:"center",padding:l.spacing.lg,backgroundColor:l.colors.secondaryBg,borderRadius:l.radii.default,border:l.colors.widgetBorderColor?`${l.sizes.borderWidth} solid ${l.colors.widgetBorderColor}`:void 0,height:l.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${l.colors.primary}`},cursor:e?"not-allowed":"pointer"})),V=p("div",{target:"eamlidg1"})({marginRight:"auto",alignItems:"center",display:"flex"}),L=p("span",{target:"eamlidg2"})(({theme:e})=>({color:e.colors.darkenedBgMix100,marginRight:e.spacing.lg})),E=p("span",{target:"eamlidg3"})(({theme:e,disabled:l})=>({color:l?e.colors.fadedText40:e.colors.bodyText})),me=p("span",{target:"eamlidg4"})(({theme:e,disabled:l})=>({fontSize:e.fontSizes.sm,color:l?e.colors.fadedText40:e.colors.fadedText60})),fe=p("div",{target:"eamlidg5"})({display:"flex",flexDirection:"column"}),P=p("div",{target:"eamlidg6"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),Fe=p("ul",{target:"eamlidg7"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none})),A=p("li",{target:"eamlidg8"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),N=p("div",{target:"eamlidg9"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),T=p("div",{target:"eamlidg10"})(({theme:e})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"})),H=p("div",{target:"eamlidg11"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),ye=p("span",{target:"eamlidg12"})(({theme:e})=>({marginRight:e.spacing.twoXS})),Se=p("div",{target:"eamlidg13"})(({theme:e})=>({display:"flex",padding:e.spacing.twoXS,color:e.colors.darkenedBgMix100})),R=p("small",{target:"eamlidg14"})(({theme:e})=>({color:e.colors.red,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),W=p("span",{target:"eamlidg15"})({}),we=e=>({[B]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto"},[V]:{marginBottom:e.spacing.sm},[L]:{display:"none"},[E]:{marginBottom:e.spacing.twoXS},[P]:{paddingRight:e.spacing.lg},[H]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[T]:{width:e.sizes.full},[N]:{flexDirection:"column"},[R]:{height:"auto",whiteSpace:"initial"},[W]:{display:"none"},[A]:{margin:e.spacing.none,padding:e.spacing.none}}),Ue=p("div",{target:"eamlidg16"})(({theme:e,width:l})=>{if(l<j("23rem"))return we(e)}),xe=({multiple:e,acceptedExtensions:l,maxSizeBytes:t,acceptDirectory:i=!1,disabled:s})=>{const n=()=>i?"directories":e?"files":"file",a=()=>l.length?` â€¢ ${l.map(d=>d.replace(/^\./,"").toUpperCase()).join(", ")}`:null,r=()=>`Limit ${I(t,w.Byte,0)} per file`;return g(V,{"data-testid":"stFileUploaderDropzoneInstructions",children:[o(L,{children:o(f,{content:D,size:"threeXL"})}),g(fe,{children:[g(E,{disabled:s,children:["Drag and drop ",n()," here"]}),g(me,{disabled:s,children:[r(),a()]})]})]})},ve=c.memo(xe),ze=({onDrop:e,multiple:l,acceptedExtensions:t,maxSizeBytes:i,disabled:s,label:n,acceptDirectory:a=!1})=>o(ae,{onDrop:e,multiple:l,accept:oe(t),maxSize:i,disabled:s,useFsAccessApi:!1,children:({getRootProps:r,getInputProps:d})=>{const u=d({multiple:l||!!a});return g(B,{...r(),"data-testid":"stFileUploaderDropzone",isDisabled:s,"aria-label":n,children:[o("input",{"data-testid":"stFileUploaderDropzoneInput",...u,...a&&{webkitdirectory:""}}),o(ve,{multiple:l,acceptedExtensions:t,maxSizeBytes:i,acceptDirectory:a,disabled:s}),o(y,{kind:S.SECONDARY,disabled:s,size:q.SMALL,children:a?"Browse directories":"Browse files"})]})}}),Ie=c.memo(ze),k=p("small",{target:"ejh2rmr0"})(({kind:e,theme:l})=>{const{danger:t,fadedText60:i}=l.colors;return{color:e==="danger"?t:i,fontSize:l.fontSizes.sm,lineHeight:l.lineHeights.tight}}),Ce=({fileInfo:e})=>e.status.type==="uploading"?o(ue,{value:e.status.progress,size:ge.SMALL}):e.status.type==="error"?g(R,{children:[o(ye,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),o(W,{children:o(f,{content:M,size:"lg"})})]}):e.status.type==="uploaded"?o(k,{children:I(e.size,w.Byte)}):null,be=({fileInfo:e,onDelete:l})=>g(H,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[o(Se,{children:o(f,{content:re,size:"twoXL"})}),g(N,{className:"stFileUploaderFileData",children:[o(T,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,children:e.name}),o(Ce,{fileInfo:e})]}),o("div",{"data-testid":"stFileUploaderDeleteBtn",children:o(y,{onClick:()=>l(e.id),kind:S.MINIMAL,children:o(f,{content:de,size:"lg"})})})]}),De=c.memo(be),Me=p("div",{target:"egc9vxm0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),Be=p("div",{target:"egc9vxm1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),Ve=({currentPage:e,totalPages:l,onNext:t,onPrevious:i})=>g(Me,{"data-testid":"stFileUploaderPagination",children:[o(k,{children:`Showing page ${e} of ${l}`}),g(Be,{children:[o(y,{onClick:i,kind:S.MINIMAL,children:o(f,{content:C,size:"xl"})}),o(y,{onClick:t,kind:S.MINIMAL,children:o(f,{content:b,size:"xl"})})]})]}),Le=c.memo(Ve),z=(e,l)=>Math.ceil(e.length/l),Ee=e=>_(({pageSize:t,items:i,resetOnAdd:s,...n})=>{const[a,r]=c.useState(0),[d,u]=c.useState(()=>z(i,t)),h=he(i);c.useEffect(()=>{h&&h.length!==i.length&&u(z(i,t)),h&&h.length<i.length?s&&r(0):a+1>=d&&r(d-1)},[i,a,t,h,s,d]);const $=()=>{r(Math.min(a+1,d-1))},X=()=>{r(Math.max(0,a-1))},O=i.slice(a*t,a*t+t);return g(K,{children:[o(e,{items:O,...n}),i.length>t?o(Le,{pageSize:t,totalPages:d,currentPage:a+1,onNext:$,onPrevious:X}):null]})},e),Pe=({items:e,onDelete:l})=>o(Fe,{children:e.map(t=>o(A,{children:o(De,{fileInfo:t,onDelete:l})},t.id))}),Ae=Ee(Pe),Ne=e=>o(P,{children:o(Ae,{...e})}),Te=c.memo(Ne);class He extends c.PureComponent{constructor(l){super(l),this.formClearHelper=new ne,this.localFileIdCounter=1,this.forceUpdatingStatus=!1,this.componentDidUpdate=()=>{if(this.status!=="ready")return;const t=this.createWidgetValue(),{element:i,widgetMgr:s,fragmentId:n}=this.props,a=s.getFileUploaderStateValue(i);J(t,a)||s.setFileUploaderStateValue(i,t,{fromUi:!0},n)},this.isFileTypeAllowed=t=>{const{element:i}=this.props,{type:s}=i;if(!s||s.length===0)return!0;const n=t.name.toLowerCase();return s.some(a=>n.endsWith(a.toLowerCase()))},this.filterDirectoryFiles=t=>{const i=[],s=[];return t.forEach(n=>{this.isFileTypeAllowed(n)?i.push(n):s.push({file:n,errors:[{code:"file-invalid-type",message:`${n.type} files are not allowed.`}]})}),{accepted:i,rejected:s}},this.dropHandler=(t,i)=>{const{element:s}=this.props,{multipleFiles:n}=s;if(!!s.acceptDirectory&&t.length>0){const{accepted:r,rejected:d}=this.filterDirectoryFiles(t);t=r,i=[...i,...d]}if(!n&&t.length===0&&i.length>1){const r=i.findIndex(d=>d.errors.length===1&&d.errors[0].code==="too-many-files");r>=0&&(t.push(i[r].file),i.splice(r,1))}if(this.props.uploadClient.fetchFileURLs(t).then(r=>{if(!n&&t.length>0){const d=this.state.files.find(u=>u.status.type!=="error");d&&(this.forceUpdatingStatus=!0,this.deleteFile(d.id),this.forceUpdatingStatus=!1)}Y(r,t).forEach(([d,u])=>{this.uploadFile(d,u)})}).catch(r=>{this.addFiles(t.map(d=>new v(d.name,d.size,this.nextLocalFileId(),{type:"error",errorMessage:r})))}),i.length>0){const r=i.map(d=>ce(d,this.nextLocalFileId(),this.maxUploadSizeInBytes));this.addFiles(r)}},this.uploadFile=(t,i)=>{const s=new AbortController,n=i.webkitRelativePath||i.name,a=new v(n,i.size,this.nextLocalFileId(),{type:"uploading",abortController:s,progress:1});this.addFile(a),this.props.uploadClient.uploadFile(this.props.element,t.uploadUrl,i,r=>this.onUploadProgress(r,a.id),s.signal).then(()=>this.onUploadComplete(a.id,t)).catch(r=>{r instanceof DOMException&&r.name==="AbortError"||this.updateFile(a.id,a.setStatus({type:"error",errorMessage:r?r.toString():"Unknown error"}))})},this.onUploadComplete=(t,i)=>{const s=this.getFile(t);m(s)||s.status.type!=="uploading"||this.updateFile(s.id,s.setStatus({type:"uploaded",fileId:i.fileId,fileUrls:i}))},this.deleteFile=t=>{const i=this.getFile(t);m(i)||(i.status.type==="uploading"&&i.status.abortController.abort(),i.status.type==="uploaded"&&i.status.fileUrls.deleteUrl&&this.props.uploadClient.deleteFile(i.status.fileUrls.deleteUrl),this.removeFile(t))},this.addFile=t=>{F.flushSync(()=>{this.setState(i=>({files:[...i.files,t]}))})},this.addFiles=t=>{F.flushSync(()=>{this.setState(i=>({files:[...i.files,...t]}))})},this.removeFile=t=>{F.flushSync(()=>{this.setState(i=>({files:i.files.filter(s=>s.id!==t)}))})},this.getFile=t=>this.state.files.find(i=>i.id===t),this.updateFile=(t,i)=>{F.flushSync(()=>{this.setState(s=>({files:s.files.map(n=>n.id===t?i:n)}))})},this.onUploadProgress=(t,i)=>{const s=this.getFile(i);if(m(s)||s.status.type!=="uploading")return;const n=Math.round(t.loaded*100/t.total);s.status.progress!==n&&this.updateFile(i,s.setStatus({type:"uploading",abortController:s.status.abortController,progress:n}))},this.onFormCleared=()=>{F.flushSync(()=>{this.setState({files:[]},()=>{const t=this.createWidgetValue();if(m(t))return;const{widgetMgr:i,element:s,fragmentId:n}=this.props;i.setFileUploaderStateValue(s,t,{fromUi:!0},n)})})},this.state=this.initialValue}get initialValue(){const l={files:[]},{widgetMgr:t,element:i}=this.props,s=t.getFileUploaderStateValue(i);if(m(s))return l;const{uploadedFileInfo:n}=s;return m(n)||n.length===0?l:{files:n.map(a=>{const r=a.name,d=a.size,u=a.fileId,h=a.fileUrls;return new v(r,d,this.nextLocalFileId(),{type:"uploaded",fileId:u,fileUrls:h})})}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){const l=this.props.element.maxUploadSizeMb;return pe(l,w.Megabyte,w.Byte)}get status(){const l=t=>t.status.type==="uploading";return this.state.files.some(l)||this.forceUpdatingStatus?"updating":"ready"}componentDidMount(){const l=this.createWidgetValue(),{element:t,widgetMgr:i,fragmentId:s}=this.props;i.getFileUploaderStateValue(t)===void 0&&i.setFileUploaderStateValue(t,l,{fromUi:!1},s)}createWidgetValue(){const l=this.state.files.filter(t=>t.status.type==="uploaded").map(t=>{const{name:i,size:s,status:n}=t,{fileId:a,fileUrls:r}=n;return new Q({fileId:a,fileUrls:r,name:i,size:s})});return new Z({uploadedFileInfo:l})}render(){const{files:l}=this.state,{element:t,disabled:i,widgetMgr:s,width:n}=this.props,a=t.type;this.formClearHelper.manageFormClearListener(s,t.formId,this.onFormCleared);const r=l.slice().reverse();return g(Ue,{className:"stFileUploader","data-testid":"stFileUploader",width:n,children:[o(se,{label:t.label,disabled:i,labelVisibility:ee(t.labelVisibility?.value),children:t.help&&o(te,{children:o(ie,{content:t.help,placement:le.TOP_RIGHT})})}),o(Ie,{onDrop:this.dropHandler,multiple:t.multipleFiles,acceptedExtensions:a,maxSizeBytes:this.maxUploadSizeInBytes,label:t.label,disabled:i,acceptDirectory:!!t.acceptDirectory}),r.length>0&&o(Te,{items:r,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0})]})}nextLocalFileId(){return this.localFileIdCounter++}}const je=G(c.memo(He));export{je as default};
