import{r as l,E as j,_ as G,s as p,aF as S,j as o,bv as Y,bO as _,br as J,bN as z,c6 as I,bS as lt,F as q,ap as $,bU as dt,b7 as ct,bM as pt,bJ as ut,aE as gt,aW as ht,bG as ft,c7 as mt,D as H,bL as yt,bK as Ct}from"./index.Dc_WcSRe.js";import{g as bt,C as vt,I as It,F as W,E as xt,a as wt,s as St,u as Ft,b as Ut}from"./FileHelper.B9JGpwLR.js";import{I as Et}from"./InputInstructions.CCKHyB20.js";import{u as zt,T as Tt}from"./useTextInputAutoExpand.0RtGhNJj.js";import{i as Dt}from"./inputUtils.CptNuJwn.js";import{E as Bt}from"./ErrorOutline.esm.DCmigXH0.js";import{U as Q}from"./UploadFileInfo.C-jY39rj.js";import"./base-input.CS49-0A1.js";var Z=l.forwardRef(function(t,e){var r={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(j,G({iconAttrs:r,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),l.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),l.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});Z.displayName="AttachFile";var tt=l.forwardRef(function(t,e){var r={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(j,G({iconAttrs:r,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),l.createElement("rect",{width:24,height:24,fill:"none"}),l.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});tt.displayName="Send";const Rt=p("div",{target:"e15560op0"})(({theme:t,height:e})=>({backgroundColor:t.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${t.sizes.emptyDropdownHeight}, ${e})`,width:"100%",zIndex:t.zIndices.priority})),Ht=p("div",{target:"e15560op1"})(({theme:t,height:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:e,width:"100%",fontWeight:t.fontWeights.bold})),Lt=p("div",{target:"e15560op2"})(({theme:t,disabled:e})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${t.sizes.borderWidth}`,cursor:e?"not-allowed":"auto"})),Mt=p("div",{target:"e15560op3"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),Wt=p("div",{target:"e15560op4"})(({theme:t})=>({marginTop:"0.625em",marginLeft:t.spacing.sm,height:t.spacing.xl,width:t.sizes.borderWidth,backgroundColor:t.colors.fadedText20})),$t=p("div",{target:"e15560op5"})(({theme:t})=>({left:0,right:0,lineHeight:t.lineHeights.tight,paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,overflowX:"auto"})),Vt=p("div",{target:"e15560op6"})({display:"flex"}),kt=p("div",{target:"e15560op7"})({flex:"0 0 auto"}),Nt=p("div",{target:"e15560op8"})(({theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.sm,gap:t.spacing.twoXS})),At=p("div",{target:"e15560op9"})(({theme:t})=>({color:t.colors.fadedText60})),Pt=p("div",{target:"e15560op10"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploaded"?t.colors.bodyText:t.colors.fadedText60})),Kt=p("div",{target:"e15560op11"})(({theme:t})=>({marginRight:t.spacing.md,color:t.colors.fadedText60})),Ot=p("small",{target:"e15560op12"})(({theme:t})=>({display:"flex",alignItems:"center",maxHeight:t.sizes.smallElementHeight,color:t.colors.fadedText60,"& :hover":{color:t.colors.bodyText}})),Xt=({getRootProps:t,getInputProps:e,acceptFile:r,disabled:d,theme:f})=>S(Lt,{disabled:d,children:[S(Mt,{"data-testid":"stChatInputFileUploadButton",disabled:d,...t(),children:[o("input",{...e()}),o(lt,{content:`Upload or drag and drop ${r===I.Multiple?"files":"a file"}`,placement:Y.TOP,onMouseEnterDelay:500,children:o(_,{kind:J.MINIMAL,disabled:d,children:o(z,{content:Z,size:"lg",color:d?f.colors.fadedText40:f.colors.fadedText60})})})]}),o(Wt,{})]}),jt=l.memo(Xt),Gt=({getRootProps:t,getInputProps:e,acceptFile:r,inputHeight:d})=>S(q,{children:[o(Rt,{height:d,...t(),children:o("input",{...e()})}),o(Ht,{height:d,children:`Drag and drop ${r===I.Multiple?"files":"a file"} here`})]}),Yt=l.memo(Gt);function _t({children:t,content:e}){const r=$();return o(dt,{content:e,placement:Y.TOP,overrides:{Body:{style:{top:`-${r.sizes.minElementHeight}`}}},children:t})}const Jt=({fileInfo:t})=>{const e=$(),{type:r}=t.status;switch(r){case"uploading":return o(pt,{"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return o(_t,{content:t.status.errorMessage,children:o(z,{color:e.colors.red,content:Bt,size:"lg"})});case"uploaded":return o(z,{content:It,size:"lg"});default:return ct(r),null}},qt=({fileInfo:t,onDelete:e})=>S(Nt,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[o(At,{children:o(Jt,{fileInfo:t})}),o(Pt,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:t.name}),o(Kt,{children:bt(t.size,W.Byte)}),o(Ot,{"data-testid":"stChatInputDeleteBtn",children:o(_,{onClick:()=>e(t.id),kind:J.MINIMAL,children:o(z,{content:vt,size:"lg"})})})]}),Qt=l.memo(qt),Zt=({items:t,onDelete:e})=>o($t,{"data-testid":"stChatUploadedFiles",children:o(Vt,{children:t.map(r=>o(kt,{children:o(Qt,{fileInfo:r,onDelete:e})},r.id))})}),te=l.memo(Zt),ee=({acceptMultipleFiles:t,maxFileSize:e,uploadClient:r,uploadFile:d,addFiles:f,getNextLocalFileId:c,deleteExistingFiles:C,onUploadComplete:y})=>(m,h)=>{if(!t&&m.length===0&&h.length>1){const u=h.findIndex(g=>g.errors?.[0].code===xt.TooManyFiles);u>=0&&(m.push(h[u].file),h.splice(u,1))}if(!t&&m.length>0&&C(),r.fetchFileURLs(m).then(u=>{ut(u,m).forEach(([g,T])=>{d(g,T)})}).catch(u=>{f(m.map(g=>new Q(g.name,g.size,c(),{type:"error",errorMessage:u})))}),h.length>0){const u=h.map(g=>wt(g,c(),e));f(u)}y()},oe=({getNextLocalFileId:t,addFiles:e,updateFile:r,uploadClient:d,element:f,onUploadProgress:c,onUploadComplete:C})=>(y,m)=>{const h=new AbortController,u=new Q(m.name,m.size,t(),{type:"uploading",abortController:h,progress:1});e([u]),d.uploadFile({formId:"",...f},y.uploadUrl,m,g=>c(g,u.id),h.signal).then(()=>C(u.id,y)).catch(g=>{g instanceof DOMException&&g.name==="AbortError"||r(u.id,u.setStatus({type:"error",errorMessage:g?g.toString():"Unknown error"}))})},ne=p("div",{target:"e1togvvn0"})("border:none;position:relative;display:flex;"),ae=p("div",{target:"e1togvvn1"})(({theme:t,extended:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:t.spacing.lg,maxHeight:e?"none":t.sizes.minElementHeight,gap:t.spacing.sm,overflow:"hidden",":focus-within":{borderColor:t.colors.primary}})),re=p("button",{target:"e1togvvn2"})(({theme:t,disabled:e,extended:r})=>{const d=gt(t),[f,c]=d?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40];return{border:"none",backgroundColor:t.colors.transparent,borderTopRightRadius:r?"0":t.radii.chatInput,borderTopLeftRadius:r?t.radii.default:"0",borderBottomRightRadius:t.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.sm,color:e?f:c,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:d?t.colors.gray10:t.colors.gray90},"&:hover":{color:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray,cursor:"not-allowed"}}}),ie=p("div",{target:"e1togvvn3"})(({theme:t})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${t.sizes.borderWidth}`,pointerEvents:"none"})),se=p("div",{target:"e1togvvn4"})(({theme:t})=>({position:"absolute",bottom:"0px",right:`calc(${t.iconSizes.xl} + 2 * ${t.spacing.sm} + ${t.spacing.sm})`})),L=(t,e,r)=>r.map(d=>d.id===t?e:d),M=(t,e)=>e.find(r=>r.id===t);function le({disabled:t,element:e,widgetMgr:r,fragmentId:d,uploadClient:f}){const c=$(),{placeholder:C,maxChars:y}=e,m=l.useRef(0),h=l.useRef(null),[u,g]=ht(),{innerWidth:T,innerHeight:V}=ft(),[F,D]=l.useState(e.default),[x,w]=l.useState([]),[U,B]=l.useState(!1),b=zt({textareaRef:h,dependencies:[C]}),R=l.useMemo(()=>x.some(n=>n.status.type==="uploading")?!1:F!==""||x.length>0,[x,F]),v=mt(e.acceptFile),k=St(e.maxUploadSizeMb,W.Megabyte,W.Byte),N=l.useCallback(n=>w(i=>[...i,...n]),[]),A=l.useCallback(n=>{w(i=>{const s=M(n,i);return H(s)?i:(s.status.type==="uploading"&&s.status.abortController.abort(),s.status.type==="uploaded"&&s.status.fileUrls.deleteUrl&&f.deleteFile(s.status.fileUrls.deleteUrl),i.filter(a=>a.id!==n))})},[f]),et=()=>{const n=x.filter(i=>i.status.type==="uploaded").map(i=>{const{name:s,size:a,status:E}=i,{fileId:it,fileUrls:st}=E;return new yt({fileId:it,fileUrls:st,name:s,size:a})});return new Ct({uploadedFileInfo:n})},P=()=>m.current++,ot=ee({acceptMultipleFiles:v===I.Multiple,maxFileSize:k,uploadClient:f,uploadFile:oe({getNextLocalFileId:P,addFiles:N,updateFile:(n,i)=>{w(s=>L(n,i,s))},uploadClient:f,element:e,onUploadProgress:(n,i)=>{w(s=>{const a=M(i,s);if(H(a)||a.status.type!=="uploading")return s;const E=Math.round(n.loaded*100/n.total);return a.status.progress===E?s:L(i,a.setStatus({type:"uploading",abortController:a.status.abortController,progress:E}),s)})},onUploadComplete:(n,i)=>{w(s=>{const a=M(n,s);return H(a)||a.status.type!=="uploading"?s:L(a.id,a.setStatus({type:"uploaded",fileId:i.fileId,fileUrls:i}),s)})}}),addFiles:N,getNextLocalFileId:P,deleteExistingFiles:()=>x.forEach(n=>A(n.id)),onUploadComplete:()=>{h.current&&h.current.focus()}}),{getRootProps:K,getInputProps:O}=Ft({onDrop:ot,multiple:v===I.Multiple,accept:Ut(e.fileType),maxSize:k}),X=()=>{if(h.current&&h.current.focus(),!R||t)return;const n={data:F,fileUploaderState:et()};r.setChatInputValue(e,n,{fromUi:!0},d),w([]),D(""),b.clearScrollHeight()},nt=n=>{const{metaKey:i,ctrlKey:s,shiftKey:a}=n;Dt(n)&&!a&&!s&&!i&&(n.preventDefault(),X())},at=n=>{const{value:i}=n.target;y!==0&&i.length>y||(D(i),b.updateScrollHeight())};l.useEffect(()=>{if(e.setValue){e.setValue=!1;const n=e.value||"";D(n)}},[e]),l.useEffect(()=>{const n=a=>{a.preventDefault(),a.stopPropagation(),!U&&a.dataTransfer?.types.includes("Files")&&B(!0)},i=a=>{a.preventDefault(),a.stopPropagation(),U&&(a.clientX<=0&&a.clientY<=0||a.clientX>=T&&a.clientY>=V)&&B(!1)},s=a=>{a.preventDefault(),a.stopPropagation(),U&&B(!1)};return window.addEventListener("dragover",n),window.addEventListener("drop",s),window.addEventListener("dragleave",i),()=>{window.removeEventListener("dragover",n),window.removeEventListener("drop",s),window.removeEventListener("dragleave",i)}},[U,T,V]);const rt=v!==I.None&&U;return S(q,{children:[v===I.None?null:o(te,{items:[...x],onDelete:A}),o(ne,{className:"stChatInput","data-testid":"stChatInput",ref:g,children:rt?o(Yt,{getRootProps:K,getInputProps:O,acceptFile:v,inputHeight:b.height}):S(ae,{extended:b.isExtended,children:[v===I.None?null:o(jt,{getRootProps:K,getInputProps:O,acceptFile:v,disabled:t,theme:c}),o(Tt,{inputRef:h,value:F,placeholder:C,onChange:at,onKeyDown:nt,"aria-label":C,disabled:t,rows:1,overrides:{Root:{style:{minHeight:c.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:c.fontWeights.normal,lineHeight:c.lineHeights.inputWidget,"::placeholder":{color:c.colors.fadedText60},height:b.height,maxHeight:b.maxHeight,paddingLeft:c.spacing.none,paddingBottom:c.spacing.sm,paddingTop:c.spacing.sm,paddingRight:`calc(${c.iconSizes.xl} + 2 * ${c.spacing.sm} + ${c.spacing.sm})`}}}}),u>c.breakpoints.hideWidgetDetails&&o(se,{children:o(Et,{dirty:R,value:F,maxLength:y,type:"chat",inForm:!1})}),o(ie,{children:o(re,{onClick:X,disabled:!R||t,extended:b.isExtended,"data-testid":"stChatInputSubmitButton",children:o(z,{content:tt,size:"xl",color:"inherit"})})})]})})]})}const ye=l.memo(le);export{ye as default};
