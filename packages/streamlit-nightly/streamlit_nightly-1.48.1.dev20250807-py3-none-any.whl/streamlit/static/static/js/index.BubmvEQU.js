import{r,E as X,_ as q,s as x,d2 as y,D as m,H as K,l as dt,ap as pt,aW as ft,cU as bt,aq as O,aF as N,j as l,bR as mt,c5 as ht,bS as gt,bv as It,bT as yt,aG as Tt,bN as j}from"./index.Dc_WcSRe.js";import{u as wt}from"./uniqueId.BSNvz4do.js";import{I as Ct}from"./InputInstructions.CCKHyB20.js";import{u as St}from"./FormClearHelper.DgvKxH31.js";import{s as Vt}from"./sprintf.D7DtBTRn.js";import{I as vt}from"./input.NT4Vz3vJ.js";import"./base-input.CS49-0A1.js";var M=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(X,q({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});M.displayName="Minus";var J=r.forwardRef(function(t,e){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(X,q({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});J.displayName="Plus";const xt=x("div",{target:"eaba2yi0"})(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:t.sizes.minElementHeight,borderWidth:t.sizes.borderWidth,borderStyle:"solid",borderColor:t.colors.widgetBorderColor??t.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:t.radii.default,overflow:"hidden","&.focused":{borderColor:t.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:t.spacing.none}}})),kt=x("div",{target:"eaba2yi1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),_=x("button",{target:"eaba2yi2"})(({theme:t})=>({margin:t.spacing.none,border:"none",height:t.sizes.full,display:"flex",alignItems:"center",width:t.sizes.numberInputControlsWidth,justifyContent:"center",color:t.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:t.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:t.colors.white,backgroundColor:t.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:disabled":{cursor:"not-allowed",color:t.colors.fadedText40}})),Dt=x("div",{target:"eaba2yi3"})(({theme:t,clearable:e})=>({position:"absolute",marginRight:t.spacing.twoXS,left:0,right:`calc(${t.sizes.numberInputControlsWidth} * 2 + ${e?"1em":"0em"})`})),Et=dt.getLogger("NumberInput");function Rt(t){return m(t)||t===""?void 0:t}const Nt=({value:t,format:e,step:n,dataType:b})=>{if(m(t))return null;let o=Rt(e);if(m(o)&&K(n)){const u=n.toString();b===y.DataType.FLOAT&&n!==0&&u.includes(".")&&(o=`%0.${u.split(".")[1].length}f`)}if(m(o))return t.toString();try{return Vt.sprintf(o,t)}catch(u){return Et.warn(`Error in sprintf(${o}, ${t}): ${u}`),String(t)}},Ft=(t,e,n)=>m(t)?!1:t-e>=n,Wt=(t,e,n)=>m(t)?!1:t+e<=n,zt=t=>(t.element.dataType===y.DataType.INT?t.widgetMgr.getIntValue(t.element):t.widgetMgr.getDoubleValue(t.element))??t.element.default??null,G=({step:t,dataType:e})=>t||(e===y.DataType.INT?1:.01),Lt=({disabled:t,element:e,widgetMgr:n,fragmentId:b})=>{const o=pt(),{dataType:u,id:C,formId:f,default:F,format:W,icon:k,min:h,max:g}=e,[z,Q]=ft(),[d,Y]=r.useState(()=>G(e)),Z=zt({element:e,widgetMgr:n}),[I,T]=r.useState(!1),[s,w]=r.useState(Z),[L,B]=r.useState(!1),S=r.useRef(null),U=r.useRef(wt("number_input_")),H=r.useMemo(()=>Nt({value:s,dataType:u,format:W,step:d}),[s,u,W,d]),V=Ft(s,d,h),v=Wt(s,d,g),P=bt({formId:f}),tt=P?n.allowFormEnterToSubmit(f):I,et=L&&z>o.breakpoints.hideWidgetDetails;r.useEffect(()=>{Y(G({step:e.step,dataType:e.dataType}))},[e.dataType,e.step]);const c=r.useCallback(({value:a,source:i})=>{if(K(a)&&(h>a||a>g))S.current?.reportValidity();else{const p=a??F??null;switch(u){case y.DataType.INT:n.setIntValue({id:C,formId:f},p,i,b);break;case y.DataType.FLOAT:n.setDoubleValue({id:C,formId:f},p,i,b);break;default:throw new Error("Invalid data type")}T(!1),w(p)}},[h,g,S,n,b,u,C,f,F]),ot=r.useCallback(()=>{I&&c({value:s,source:{fromUi:!0}}),B(!1)},[I,s,c]),rt=r.useCallback(()=>{B(!0)},[]),A=r.useCallback(()=>{const{value:a}=e;e.setValue=!1,w(a??null),c({value:a??null,source:{fromUi:!1}})},[e,c]);r.useEffect(()=>{e.setValue?A():c({value:s,source:{fromUi:!1}});const a=S.current;if(a){const i=p=>{p.preventDefault()};return a.addEventListener("wheel",i),()=>{a.removeEventListener("wheel",i)}}},[]),e.setValue&&A();const D=m(e.default)&&!t,nt=r.useCallback(()=>{const a=e.default??null;w(a),c({value:a,source:{fromUi:!0}})},[e]);St({element:e,widgetMgr:n,onFormCleared:nt});const at=a=>{const{value:i}=a.target;if(i==="")T(!0),w(null);else{let p;e.dataType===y.DataType.INT?p=parseInt(i,10):p=parseFloat(i),T(!0),w(p)}},E=r.useCallback(()=>{v&&(T(!0),c({value:(s??h)+d,source:{fromUi:!0}}))},[s,h,d,v]),R=r.useCallback(()=>{V&&(T(!0),c({value:(s??g)-d,source:{fromUi:!0}}))},[s,g,d,V]),st=r.useCallback(a=>{const{key:i}=a;switch(i){case"ArrowUp":a.preventDefault(),E();break;case"ArrowDown":a.preventDefault(),R();break}},[E,R]),it=r.useCallback(a=>{a.key==="Enter"&&(I&&c({value:s,source:{fromUi:!0}}),n.allowFormEnterToSubmit(f)&&n.submitForm(f,b))},[I,s,c,n,f,b]),$=k?.startsWith(":material"),lt=$?"lg":"base",ct=O(o.iconSizes.lg)+2*O(o.spacing.twoXS),ut=k?o.breakpoints.hideNumberInputControls+ct:o.breakpoints.hideNumberInputControls;return N("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:Q,children:[l(yt,{label:e.label,disabled:t,labelVisibility:mt(e.labelVisibility?.value),htmlFor:U.current,children:e.help&&l(ht,{children:l(gt,{content:e.help,placement:It.TOP_RIGHT})})}),N(xt,{className:L?"focused":"","data-testid":"stNumberInputContainer",children:[l(vt,{type:"number",inputRef:S,value:H??"",placeholder:e.placeholder,onBlur:ot,onFocus:rt,onChange:at,onKeyPress:it,onKeyDown:st,clearable:D,clearOnEscape:D,disabled:t,"aria-label":e.label,startEnhancer:e.icon&&l(Tt,{"data-testid":"stNumberInputIcon",iconValue:e.icon,size:lt}),id:U.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:o.colors.darkGray,padding:o.spacing.threeXS,height:o.sizes.clearIconSize,width:o.sizes.clearIconSize,":hover":{fill:o.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:d,min:h,max:g,type:"number",inputMode:""},style:{fontWeight:o.fontWeights.normal,lineHeight:o.lineHeights.inputWidget,paddingRight:o.spacing.sm,paddingLeft:o.spacing.md,paddingBottom:o.spacing.sm,paddingTop:o.spacing.sm,"::placeholder":{color:o.colors.fadedText60}}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0,paddingLeft:k?o.spacing.sm:0}},StartEnhancer:{style:{paddingLeft:0,paddingRight:0,minWidth:o.iconSizes.lg,color:$?o.colors.fadedText60:"inherit"}}}}),z>ut&&N(kt,{children:[l(_,{"data-testid":"stNumberInputStepDown",onClick:R,disabled:!V||t,tabIndex:-1,children:l(j,{content:M,size:"xs",color:V?"inherit":o.colors.disabled})}),l(_,{"data-testid":"stNumberInputStepUp",onClick:E,disabled:!v||t,tabIndex:-1,children:l(j,{content:J,size:"xs",color:v?"inherit":o.colors.disabled})})]})]}),et&&l(Dt,{clearable:D,children:l(Ct,{dirty:I,value:H??"",inForm:P,allowEnterToSubmit:tt})})]})},jt=r.memo(Lt);export{jt as default};
