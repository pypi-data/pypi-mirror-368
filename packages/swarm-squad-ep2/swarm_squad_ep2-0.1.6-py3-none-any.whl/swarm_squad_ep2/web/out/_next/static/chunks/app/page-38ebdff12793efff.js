(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2800:(e,t,s)=>{Promise.resolve().then(s.bind(s,3827))},3827:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>K});var r=s(2311),o=s(2847),n=s(7448),a=s(2560),l=s(7246),c=s(8327);let i={V1:{bg:"#3b82f6",text:"#eff6ff"},V2:{bg:"#22c55e",text:"#f0fdf4"},V3:{bg:"#f97316",text:"#fff7ed"},V4:{bg:"#8b5cf6",text:"#f5f3ff"},V5:{bg:"#ec4899",text:"#fdf2f8"}};function d(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.QP)((0,l.$)(t))}let m=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),f=o.forwardRef((e,t)=>{let{className:s,variant:o,size:a,asChild:l=!1,...c}=e,i=l?n.DX:"button";return(0,r.jsx)(i,{className:d(m({variant:o,size:a,className:s})),ref:t,...c})});f.displayName="Button";var h=s(3258);let u=o.forwardRef((e,t)=>{let{className:s,children:o,...n}=e;return(0,r.jsxs)(h.bL,{ref:t,className:d("relative overflow-hidden",s),...n,children:[(0,r.jsx)(h.LM,{className:"h-full w-full rounded-[inherit]",children:o}),(0,r.jsx)(g,{}),(0,r.jsx)(h.OK,{})]})});u.displayName=h.bL.displayName;let g=o.forwardRef((e,t)=>{let{className:s,orientation:o="vertical",...n}=e;return(0,r.jsx)(h.VM,{ref:t,orientation:o,className:d("flex touch-none select-none transition-colors","vertical"===o&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===o&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,r.jsx)(h.lr,{className:"relative flex-1 rounded-full bg-border"})})});g.displayName=h.VM.displayName;var p=s(880),x=s(8295),v=s(1565);function y(e){let{name:t,isExpanded:s,onToggle:o}=e;return(0,r.jsxs)("button",{onClick:o,className:"flex items-center gap-1 w-full px-2 py-1 text-xs font-semibold text-muted-foreground hover:text-foreground",children:[(0,r.jsx)(v.A,{className:d("h-3 w-3 transition-transform",!s&&"-rotate-90")}),t]})}function b(e){let{currentRoomId:t,onRoomChange:s,categories:n}=e,[a,l]=(0,o.useState)({});(0,o.useEffect)(()=>{n.length>0&&l(Object.fromEntries(n.map(e=>[e.id,!0])))},[n]);let c=e=>{l(t=>({...t,[e]:!t[e]}))};return(0,r.jsxs)("div",{className:"hidden md:flex w-72 border-r border-border flex-col bg-background h-[calc(100vh-5.5rem)]",children:[(0,r.jsx)("div",{className:"h-14 flex items-center justify-center px-4 border-b border-border",children:(0,r.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,r.jsx)(p.A,{className:"h-5 w-5"}),"Rooms"]})}),(0,r.jsx)(u,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4 space-y-4",children:n.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)(y,{name:e.name,isExpanded:a[e.id],onToggle:()=>c(e.id)}),a[e.id]&&(0,r.jsx)("div",{className:"space-y-1 mt-1",children:e.rooms.map(e=>(0,r.jsxs)(f,{variant:t===e.id?"secondary":"ghost",className:"w-full justify-start text-sm pl-8",onClick:()=>s(e.id),children:[(0,r.jsx)(x.A,{className:"mr-3 h-4 w-4"}),e.name]},e.id))})]},e.id))})})]})}let N="http://localhost:8000";function w(){let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)(null),[n,a]=(0,o.useState)(!0),[l,c]=(0,o.useState)(!1),[i,d]=(0,o.useState)(null),[m,f]=(0,o.useState)([]),h=(0,o.useRef)(0),u=(0,o.useRef)(0),g=(0,o.useRef)(!1),p=(0,o.useRef)(!1),x=(0,o.useRef)(!1),v=(0,o.useCallback)(async()=>{if(x.current)return console.log("Room fetching already in progress, skipping..."),m;x.current=!0,console.log("Fetching rooms for WebSocket connection...");try{let e,t=await fetch("".concat(N,"/rooms"));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.text();if(!s.trim()){console.warn("Received empty response from /rooms");let e=["v1","v2","v3"];return f(e),p.current=!0,e}if(s.trim().startsWith("<")){console.error("\uD83D\uDEA8 RECEIVED HTML INSTEAD OF JSON in useWebSocket:",s.substring(0,500));let e=["v1","v2","v3"];return f(e),p.current=!0,e}try{e=JSON.parse(s)}catch(t){console.error("\uD83D\uDEA8 JSON PARSE ERROR in useWebSocket fetchRooms:",t),console.error("Raw response that failed to parse:",s),console.error("Response length:",s.length);let e=["v1","v2","v3"];return f(e),p.current=!0,e}let r=e.map(e=>e.id);return console.log("Fetched available rooms:",r),f(r),r}catch(t){console.error("Error fetching rooms:",t);let e=["v1","v2","v3"];return console.log("Using fallback rooms:",e),f(e),e}finally{x.current=!1}},[m]),y=(0,o.useCallback)(async()=>{if(g.current)return void console.log("Historical messages already loaded, skipping");try{let e;d(null);let s=await fetch("".concat(N,"/messages?limit=50"));if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let r=await s.text();if(r.trim().startsWith("<")){console.error("\uD83D\uDEA8 RECEIVED HTML INSTEAD OF JSON in fetchHistoricalMessages:",r.substring(0,500)),g.current=!0;return}if(!r.trim()){console.warn("Received empty response from /messages"),g.current=!0;return}try{e=JSON.parse(r)}catch(e){console.error("\uD83D\uDEA8 JSON PARSE ERROR in fetchHistoricalMessages:",e),console.error("Raw response that failed to parse:",r);return}let o=e.filter(e=>e&&("number"==typeof e.id||"string"==typeof e.id)&&"string"==typeof e.content&&"string"==typeof e.entity_id&&"string"==typeof e.timestamp);t(e=>0===e.length?o:e),console.log("Loaded ".concat(o.length," historical messages")),g.current=!0}catch(e){console.error("Error fetching historical messages:",e),d(e instanceof Error?e.message:"Failed to fetch messages"),g.current=!0}finally{a(!1)}},[]),b=(0,o.useCallback)(e=>{if(0===e.length)return console.warn("No rooms available for WebSocket connection"),console.log("WebSocket connection cancelled - no rooms"),null;let s="ws://localhost:8000/ws?rooms=".concat(e.join(","));console.log("Connecting to WebSocket:",s),console.log("Subscribing to rooms:",e),console.log("Total rooms count:",e.length);let o=new WebSocket(s);return o.onopen=()=>{console.log("WebSocket connected to rooms:",e),c(!0),d(null),u.current=0;let t=setInterval(()=>{if(o.readyState===WebSocket.OPEN)try{o.send(JSON.stringify("ping"))}catch(e){console.error("Failed to send heartbeat:",e),clearInterval(t)}else clearInterval(t)},25e3);o.heartbeatInterval=t},o.onmessage=e=>{try{let s;if(!e.data||""===e.data.trim())return void console.warn("Received empty WebSocket message, skipping");if("string"!=typeof e.data)return void console.warn("Received non-string WebSocket message:",typeof e.data,e.data);try{s=JSON.parse(e.data)}catch(t){console.error("\uD83D\uDEA8 JSON PARSE ERROR in WebSocket message:",t),console.error("Raw WebSocket data that failed to parse:",e.data),console.error("Data type:",typeof e.data),console.error("Data length:",e.data.length);return}if("pong"===s)return void console.debug("Received heartbeat pong");if(console.log("Received WebSocket message:",s),s&&("string"==typeof s.content||"string"==typeof s.message)&&"string"==typeof s.entity_id&&"string"==typeof s.timestamp){h.current+=1;let e={...s,content:s.content||s.message,message_type:s.message_type||"vehicle_update",room_id:s.room_id||s.entity_id,state:s.state||{},id:s.id||"".concat(s.entity_id,"-").concat(Date.now(),"-").concat(h.current)};t(t=>{let s=[...t,e];return console.log("Total messages: ".concat(s.length," (latest from ").concat(e.entity_id,")")),s.slice(-50)})}else console.warn("Received invalid message format:",s)}catch(e){console.error("Error processing WebSocket message:",e)}},o.onerror=e=>{console.error("WebSocket error:",e),c(!1),d("WebSocket connection error")},o.onclose=t=>{if(console.log("WebSocket disconnected:",t.code,t.reason),c(!1),o.heartbeatInterval&&clearInterval(o.heartbeatInterval),1e3!==t.code){u.current++;let t=Math.min(2e3*Math.pow(2,u.current-1),3e4)+1e3*Math.random();console.log("Attempting to reconnect in ".concat(Math.round(t/1e3),"s (attempt ").concat(u.current,")")),setTimeout(()=>{console.log("Attempting to reconnect..."),b(e)},t)}},r(o),o},[]);return(0,o.useEffect)(()=>{let e=null,t=!0;return(async()=>{try{let s=await v();t&&s.length>0&&(e=b(s),g.current||y())}catch(e){console.error("Error initializing connection:",e),t&&d("Failed to initialize connection")}})(),()=>{t=!1,e&&(e.heartbeatInterval&&clearInterval(e.heartbeatInterval),e.readyState===WebSocket.OPEN&&e.close(1e3,"Component unmounting"))}},[]),{messages:e,socket:s,isLoading:n,isConnected:l,error:i,availableRooms:m,sendMessage:(0,o.useCallback)(async(e,t)=>{try{let s,r=await fetch("".concat(N,"/messages/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:e,entity_id:"user",content:t,message_type:"user_message",timestamp:new Date().toISOString(),state:{}})});if(!r.ok)throw Error("Failed to send message: ".concat(r.status));let o=await r.text();if(o.trim().startsWith("<"))return console.error("\uD83D\uDEA8 RECEIVED HTML INSTEAD OF JSON in sendMessage:",o.substring(0,500)),{success:!0};try{s=o.trim()?JSON.parse(o):{}}catch(e){console.error("\uD83D\uDEA8 JSON PARSE ERROR in sendMessage response:",e),console.error("Raw response that failed to parse:",o),s={success:!0}}return console.log("Message sent successfully:",s),!0}catch(e){return console.error("Error sending message:",e),d("Failed to send message"),!1}},[])}}var j=s(3119),S=s(9200);let E="http://localhost:8000",R=null,k=new Map,_=new Map,L=0,I=0,O=Date.now();async function A(){if(R)return console.log("Reusing existing fetchRooms request"),R;let e=Date.now();e-O>=1e3&&(I=0,O=e),I>=10&&(console.log("Rate limit exceeded, delaying request..."),await new Promise(t=>setTimeout(t,1e3-(e-O))),I=0,O=Date.now());let t=e-L;t<100&&await new Promise(e=>setTimeout(e,100-t)),I++,L=Date.now(),R=(async()=>{try{console.log("Making request to:","".concat(E,"/rooms"));let e=await fetch("".concat(E,"/rooms"),{signal:AbortSignal.timeout(5e3)});if(console.log("Response status:",e.status),console.log("Response headers:",Object.fromEntries(e.headers.entries())),!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.text();if(console.log("Response text length:",t.length),console.log("Response text preview:",t.substring(0,200)),t.trim().startsWith("<"))throw console.error("\uD83D\uDEA8 RECEIVED HTML INSTEAD OF JSON:",t.substring(0,500)),Error("Server returned HTML instead of JSON");if(!t.trim())return console.warn("Received empty response from /rooms"),[];try{let e=JSON.parse(t);return console.log("Successfully parsed JSON:",e),e}catch(e){return console.error("JSON parse error in fetchRooms:",e),console.error("Raw response that failed to parse:",t),[]}}catch(e){return console.error("Error fetching rooms:",e),[]}})();try{return await R}finally{R=null}}async function C(e){let t=k.get(e);if(t)return console.log("Reusing existing fetchMessages request for room: ".concat(e)),t;let s=(async()=>{try{let t=await fetch("".concat(E,"/messages?room_id=").concat(e),{signal:AbortSignal.timeout(5e3)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.text();if(s.trim().startsWith("<"))throw console.error("\uD83D\uDEA8 RECEIVED HTML INSTEAD OF JSON in fetchMessages:",s.substring(0,500)),Error("Server returned HTML instead of JSON");if(!s.trim())return console.warn("Received empty response from /messages"),[];try{return JSON.parse(s)}catch(e){return console.error("\uD83D\uDEA8 JSON PARSE ERROR in fetchMessages:",e),console.error("Raw response that failed to parse:",s),[]}}catch(e){return console.error("Error fetching messages:",e),[]}})();k.set(e,s);try{return await s}finally{k.delete(e)}}window.addEventListener("beforeunload",()=>{R=null,k.clear(),_.clear()});let M=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#F97316","#84CC16","#EC4899","#6366F1"];function W(e){let{roomId:t}=e,[s,n]=(0,o.useState)([]),{messages:a,isConnected:l}=w();return(0,o.useEffect)(()=>{t&&e();async function e(){try{let e=(await C(t)).map(e=>({id:e.id,content:e.content,timestamp:e.timestamp,entity_id:e.entity_id,room_id:e.room_id,message_type:e.message_type,state:e.state}));n(e)}catch(e){console.error("Error loading messages:",e)}}},[t]),(0,o.useEffect)(()=>{if(console.log("Chat component for roomId: ".concat(t,", wsMessages count: ").concat(a.length)),!t||!a.length)return;let e=a.filter(e=>{if(console.log("Filtering message for roomId: ".concat(t),e),"master-vehicles"===t)return e.entity_id&&e.entity_id.startsWith("v");if("master-llms"===t)return e.entity_id&&e.entity_id.startsWith("l");if(t===e.entity_id||t===e.room_id)return!0;if(t.startsWith("vl")){let s=t.slice(2);return e.entity_id==="v".concat(s)||e.entity_id==="l".concat(s)}return!1}).map(e=>({id:e.id||"".concat(e.entity_id,"-").concat(Date.now()),content:e.content,timestamp:e.timestamp,entity_id:e.entity_id,room_id:e.room_id||t,message_type:e.message_type,state:e.state}));e.length>0?(console.log("Found ".concat(e.length," new messages for roomId: ").concat(t),e),n(s=>{let r=new Set(s.map(e=>e.id)),o=e.filter(e=>!r.has(e.id));return o.length>0?(console.log("Adding ".concat(o.length," unique messages to roomId: ").concat(t)),[...s,...o].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())):s})):console.log("No messages found for roomId: ".concat(t," after filtering"))},[a,t]),(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"px-4 py-2 text-xs flex items-center justify-center text-gray-500 border-b",children:["WebSocket:"," ",l?(0,r.jsx)("span",{className:"text-green-600",children:"Connected"}):(0,r.jsx)("span",{className:"text-red-600",children:"Disconnected"}),(0,r.jsx)("span",{className:"mx-2",children:"-"}),"Messages: ",s.length,(0,r.jsx)("span",{className:"mx-2",children:"-"}),"Room: ",t]}),(0,r.jsx)(u,{className:"flex-1",children:(0,r.jsx)("div",{className:"flex justify-center w-full mt-4",children:(0,r.jsx)("div",{className:"w-full max-w-[1500px] px-4",children:(0,r.jsx)("div",{className:"space-y-4 py-4",children:0===s.length?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:["No messages yet."," ",l?"Waiting for vehicle updates...":"Connecting to WebSocket..."]}):s.map(e=>{var t,s,o;let n="vehicle_update"===e.message_type,a=(t=e.entity_id).startsWith("v")||t.startsWith("l")?M[((parseInt(t.slice(1))||1)-1)%M.length]:"#6B7280";return n&&i[e.entity_id],(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-8 h-8 sm:w-12 sm:h-12 rounded-full flex items-center justify-center",style:{backgroundColor:a},children:n?(0,r.jsx)(j.A,{className:"h-4 w-4 sm:h-6 sm:w-6 text-white"}):(0,r.jsx)(S.A,{className:"h-4 w-4 sm:h-6 sm:w-6 text-white"})}),(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-2 flex-wrap",children:[(0,r.jsx)("span",{className:"font-semibold text-sm sm:text-base",style:{color:a},children:e.entity_id}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,r.jsx)("p",{className:"mt-1 text-sm sm:text-base break-words",dangerouslySetInnerHTML:{__html:n?(s=e.content,o=e.entity_id,(s=s.replace(/\d+%,\s*\d+%">/,"")).replace(new RegExp("Vehicle ".concat(o)),'<span style="color: '.concat(a,'">Vehicle ').concat(o,"</span>")).replace(/\(([-\d.]+,\s*[-\d.]+)\)/g,e=>'<span style="color: '.concat(a,'">').concat(e,"</span>")).replace(/([\d.]+)(\s*km\/h)/g,(e,t,s)=>'<span style="color: '.concat(a,'">').concat(t,"</span>").concat(s)).replace(/([\d.]+)(%)/g,(e,t,s)=>'<span style="color: '.concat(a,'">').concat(t,"</span>").concat(s))):e.content}}),n&&e.state&&(0,r.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[e.state.latitude&&e.state.longitude&&(0,r.jsxs)("span",{className:"mr-2",children:["Location: (",e.state.latitude.toFixed(4),", ",e.state.longitude.toFixed(4),")"]}),e.state.speed&&(0,r.jsxs)("span",{className:"mr-2",children:["Speed: ",e.state.speed.toFixed(1)," km/h"]}),e.state.battery&&(0,r.jsxs)("span",{children:["Battery: ",e.state.battery.toFixed(1),"%"]})]})]})]},e.id)})})})})})]})}let D=o.forwardRef((e,t)=>{let{className:s,type:o,...n}=e;return(0,r.jsx)("input",{type:o,className:d("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});D.displayName="Input";var T=s(4761),F=s(3848);function H(e){let{currentRoomId:t,onSendMessage:s,isConnected:n=!1}=e,[a,l]=(0,o.useState)(""),[c,i]=(0,o.useState)(!1),d=async e=>{if(e.preventDefault(),a.trim()&&t&&s&&!c){i(!0);try{await s(t,a.trim())&&l("")}catch(e){console.error("Error sending message:",e)}finally{i(!1)}}};return(0,r.jsxs)("form",{onSubmit:d,className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-1 sm:gap-2",children:(0,r.jsx)(f,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 sm:h-10 sm:w-10",disabled:!0,children:(0,r.jsx)(T.A,{className:"h-[18px] w-[18px] sm:h-5 sm:w-5"})})}),(0,r.jsx)("div",{className:"flex-grow",children:(0,r.jsx)(D,{placeholder:n&&t?"Send a message to ".concat(t,"..."):"Connecting...",value:a,onChange:e=>l(e.target.value),className:"h-9 sm:h-10 text-sm sm:text-base",disabled:!n||!t||c})}),(0,r.jsxs)(f,{type:"submit",size:"sm",disabled:!n||!t||!a.trim()||c,className:"gap-1 sm:gap-2 h-9 sm:h-10 px-3 sm:px-4 text-sm sm:text-base",children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:c?"Sending...":"Send"}),(0,r.jsx)(F.A,{className:"h-[18px] w-[18px] sm:h-5 sm:w-5"})]})]})}var V=s(9645);function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=[],s=[],r=[];t.push({id:"master-vehicles",name:"\uD83D\uDE97 All Vehicles",type:"master-vehicle"}),s.push({id:"master-llms",name:"\uD83E\uDD16 All LLMs",type:"master-llm"});for(let o=1;o<=e;o++)t.push({id:"v".concat(o),name:"Vehicle ".concat(o," Room"),type:"vehicle"}),s.push({id:"l".concat(o),name:"LLM ".concat(o," Room"),type:"llm"}),r.push({id:"vl".concat(o),name:"Veh".concat(o," - LLM").concat(o),type:"vl"});return[{id:"1",name:"VEHICLE CHANNELS",rooms:t},{id:"2",name:"LLM CHANNELS",rooms:s},{id:"3",name:"VEH2LLM CHANNELS",rooms:r}]}J(3);let P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=[];t.push({id:"master-vehicles",name:"\uD83D\uDE97 All Vehicles",roomId:"master-vehicles",status:"online",type:"master-vehicle"}),t.push({id:"master-llms",name:"\uD83E\uDD16 All LLMs",roomId:"master-llms",status:"online",type:"master-llm"});for(let s=1;s<=e;s++)t.push({id:"v".concat(s),name:"Vehicle ".concat(s),roomId:"v".concat(s),status:"online",type:"vehicle"}),t.push({id:"l".concat(s),name:"LLM ".concat(s),roomId:"l".concat(s),status:"online",type:"llm"});return t};P(3),new Date().toISOString(),new Date().toISOString(),new Date().toISOString();var z=s(6650),B=s(975),q=s(3899);function U(){let{theme:e,setTheme:t}=(0,q.D)(),[s,n]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{n(!0)},[]),s)?(0,r.jsx)(f,{variant:"ghost",size:"sm",className:"flex items-center justify-center gap-2 w-full",onClick:()=>t("light"===e?"dark":"light"),children:"light"===e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Dark mode"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Light mode"})]})}):(0,r.jsxs)(f,{variant:"ghost",size:"sm",className:"flex items-center justify-center gap-2 w-full",children:[(0,r.jsx)("div",{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"invisible",children:"Placeholder"})]})}function K(){let[e,t]=(0,o.useState)(""),[s,n]=(0,o.useState)([]),[a,l]=(0,o.useState)([]),[c,i]=(0,o.useState)([]),[d,m]=(0,o.useState)(!0),[f,h]=(0,o.useState)(!1),{isConnected:g,messages:p,sendMessage:v}=w(),y=a.find(t=>t.id===e);return(0,o.useEffect)(()=>{(async()=>{try{m(!0),console.log("Fetching rooms from API...");let s=await A();if(console.log("Received rooms from API:",s),l(s),!s||0===s.length){console.warn("No rooms received from API, using fallback");let s=J(3);n(s),l(s.flatMap(e=>e.rooms)),i(P(3)),e||t("master-vehicles");return}let r=[{id:"1",name:"VEHICLE CHANNELS",rooms:s.filter(e=>"master-vehicle"===e.type||"vehicle"===e.type)},{id:"2",name:"LLM CHANNELS",rooms:s.filter(e=>"master-llm"===e.type||"llm"===e.type)},{id:"3",name:"VEH2LLM CHANNELS",rooms:s.filter(e=>"vl"===e.type)}];console.log("Organized categories:",r),n(r);let o=s.filter(e=>"vehicle"===e.type).length;console.log("Detected vehicle count:",o);let a=P(o);if(i(a),!e&&s.length>0){let e=s.find(e=>"master-vehicles"===e.id)||s[0];t(e.id)}}catch(r){console.error("Failed to load rooms:",r);let s=J(3);n(s),l(s.flatMap(e=>e.rooms)),i(P(3)),e||t("master-vehicles")}finally{m(!1)}})()},[e]),(0,o.useEffect)(()=>{if(g&&!f){let e=async()=>{if(!f)try{h(!0),console.log("Refreshing rooms due to WebSocket connection change");let e=await A();if(e.length>a.length){console.log("Room count increased from ".concat(a.length," to ").concat(e.length,", updating")),l(e);let t=[{id:"1",name:"VEHICLE CHANNELS",rooms:e.filter(e=>"master-vehicle"===e.type||"vehicle"===e.type)},{id:"2",name:"LLM CHANNELS",rooms:e.filter(e=>"master-llm"===e.type||"llm"===e.type)},{id:"3",name:"VEH2LLM CHANNELS",rooms:e.filter(e=>"vl"===e.type)}];n(t);let s=e.filter(e=>"vehicle"===e.type).length;i(P(s))}}catch(e){console.error("Failed to reload rooms:",e)}finally{h(!1)}};e();let t=setInterval(e,1e4);return()=>clearInterval(t)}},[g,a.length,f]),(0,o.useEffect)(()=>{console.log("WebSocket status:",g),console.log("Total WebSocket messages:",p.length),console.log("Current room:",e),p.length>0&&console.log("Latest message:",p[p.length-1])},[g,p,e]),(0,r.jsxs)("div",{className:"flex h-[calc(100vh-5.5rem)] overflow-hidden",children:[(0,r.jsx)(b,{categories:s,currentRoomId:e,onRoomChange:t}),(0,r.jsxs)("div",{className:"flex flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,r.jsx)("div",{className:"h-14 flex-shrink-0 flex items-center justify-center px-4 border-b border-border bg-background relative",children:(0,r.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"h-5 w-5"}),(null==y?void 0:y.name)||e]})}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:e&&(0,r.jsx)(W,{roomId:e})})]}),(0,r.jsxs)("div",{className:"w-72 border-l border-border flex flex-col",children:[(0,r.jsx)("div",{className:"h-14 flex items-center justify-center px-4 border-b border-border",children:(0,r.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,r.jsx)(V.A,{className:"h-5 w-5"}),"Users"]})}),(0,r.jsx)(u,{className:"flex-1",children:(0,r.jsx)("div",{className:"p-4",children:c.filter(t=>t.roomId===e).map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-2 pl-8",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(S.A,{className:"h-4 w-4 text-foreground"}),(0,r.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full ".concat("online"===e.status?"bg-green-500":"bg-gray-400")})]}),(0,r.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]})]}),(0,r.jsx)("div",{className:"fixed bottom-0 left-0 right-0 border-t border-border bg-background",children:(0,r.jsxs)("div",{className:"flex h-[5.5rem] items-center",children:[(0,r.jsxs)("div",{className:"w-72 border-r border-border h-full flex flex-col items-center justify-center px-4",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-center",children:"Swarm Squad"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"The Digital Dialogue"})]}),(0,r.jsx)("div",{className:"flex-1 relative px-8",children:(0,r.jsx)(H,{currentRoomId:e,onSendMessage:v,isConnected:g})}),(0,r.jsxs)("div",{className:"w-72 border-l border-border h-full flex flex-col items-center justify-center px-4 gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 ".concat(g?"text-green-500":"text-red-500"),children:[(0,r.jsx)("div",{className:"h-1 w-1 rounded-full bg-current"}),(0,r.jsx)("span",{className:"text-sm",children:g?"WS Connected":"WS Disconnected"})]}),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(U,{})})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[455,789,20,358],()=>t(2800)),_N_E=e.O()}]);