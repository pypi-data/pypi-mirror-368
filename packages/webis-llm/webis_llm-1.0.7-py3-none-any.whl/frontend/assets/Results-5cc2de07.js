import{h as w,d as te,E as h,x as U,H as se,r as O,o as u,c as m,a as d,b as s,g as p,u as _,w as v,t as f,F as j,A as le,I as Y,n as E,y as oe,J as ae,B as ne,K as ie,k as x,L as ce,p as I,M as N,N as X}from"./index-e598b547.js";import{S as de}from"./Sidebar-42b64afc.js";import{a as F}from"./axios-b5ee139b.js";import{_ as re}from"./logo2-5154ae89.js";const ue=""+new URL("set-1e4ecbe3.png",import.meta.url).href;const ve={class:"results-page"},me={class:"main-content"},_e={class:"results-header"},pe={class:"header-content"},fe={class:"batch-actions"},he=["disabled"],be=["disabled"],ge={class:"search-and-format"},ke={class:"search-box"},we={class:"date-picker"},Ce={class:"type"},ye={class:"results-list"},xe={key:0,class:"no-results"},Le={key:1,class:"result-items"},Re=["onClick"],Be={class:"result-info"},Ve={class:"result-details"},Se={class:"result-title-row"},$e={class:"url"},De={class:"result-meta"},Me={class:"time"},Ue={key:0,class:"file-count"},Ee={class:"batch-controls"},Oe={class:"batch-search"},Ne={class:"batch-navigation"},Te={class:"navigation-controls"},je={key:0,class:"no-batch-results"},Ie={key:1,class:"batch-content"},Je={class:"batch-file-info"},ze={class:"dialog-tabs"},Ye={class:"tab-buttons"},Xe={class:"preview-section"},Fe={class:"preview-title"},He={class:"result-content"},Ae={key:0,class:"code-block"},Qe={key:1,class:"code-block"},qe={class:"dialog-tabs"},Pe={class:"tab-buttons"},Ke={class:"preview-section"},Ze={class:"preview-title"},Ge={class:"result-content"},We={key:0,class:"code-block"},et={key:1,class:"code-block"},tt={class:"dialog-footer"},st={class:"dialog-footer"},lt={__name:"Results",setup(ot){const r=w(3),L=w([]),T=w(!1),$=w(!1),c=w(null),D=w(""),R=w(""),b=w(0),B=w([]);te(()=>{H()});const H=()=>{try{const t=JSON.parse(localStorage.getItem("denoisedResults")||"[]");if(t&&t.length){const e={},a=[];t.forEach(o=>{o.isBatch===!1?a.push({...o,isBatch:!1}):o.task_id&&!o.hasOwnProperty("isBatch")?(e[o.task_id]||(e[o.task_id]={id:o.task_id,task_id:o.task_id,url:`批量结果 (${new Date(o.time).toLocaleDateString()})`,time:o.time,isBatch:!0,selected:!1,items:[],fileCount:0}),e[o.task_id].items.push(o),e[o.task_id].fileCount++):a.push({...o,isBatch:!1})});const n=[...Object.values(e),...a];n.sort((o,i)=>{const l=new Date(o.time).getTime();return new Date(i.time).getTime()-l}),L.value=n}}catch(t){console.error("加载存储的结果失败:",t),h.error("加载存储的结果失败")}},J=U(()=>{if(!D.value&&!B.value.length)return L.value;const t=D.value.toLowerCase();return L.value.filter(e=>{const a=e.url.toLowerCase().includes(t)||e.content&&e.content.toLowerCase().includes(t),n=B.value.length?new Date(e.time)>=new Date(B.value[0])&&new Date(e.time)<=new Date(B.value[1]):!0;return e.isBatch?n&&(a||e.items.some(o=>o.url.toLowerCase().includes(t)||o.content&&o.content.toLowerCase().includes(t))):n&&a})}),y=U(()=>{if(!c.value?.items)return[];if(!R.value)return c.value.items;const t=R.value.toLowerCase();return c.value.items.filter(e=>e.url.toLowerCase().includes(t)||e.content&&e.content.toLowerCase().includes(t)||e.filename&&e.filename.toLowerCase().includes(t))}),C=U(()=>y.value.length?(b.value>=y.value.length&&(b.value=y.value.length-1),y.value[b.value]):null);se(R,()=>{b.value=0});const A=U(()=>c.value?c.value.isBatch?`批量结果 (${c.value.fileCount}个文件)`:c.value.url:""),g=U(()=>L.value.filter(t=>t.selected)),Q=t=>{c.value=t,b.value=0,R.value="",T.value=!0},q=()=>{g.value.length>0&&($.value=!0)},P=async()=>{try{for(const n of g.value)if(n.task_id)try{await F.delete(`http://localhost:8001/api/tasks/${n.task_id}`)}catch(o){console.warn(`删除服务器任务 ${n.task_id} 失败:`,o)}const t=g.value.map(n=>n.id);L.value=L.value.filter(n=>!t.includes(n.id));const a=JSON.parse(localStorage.getItem("denoisedResults")||"[]").filter(n=>g.value.some(o=>o.task_id===n.task_id)?!1:!t.includes(n.id));localStorage.setItem("denoisedResults",JSON.stringify(a)),$.value=!1,h.success("删除成功")}catch(t){console.error("删除任务失败:",t),h.error("删除部分任务失败")}},K=()=>{if(g.value.length===0)return;const t=r.value===3?"xml":"json";g.value.forEach(e=>{e.isBatch?G(e,t):Z(e,t)}),h.success(`已导出 ${g.value.length} 个结果为 ${t.toUpperCase()} 格式`)},Z=(t,e)=>{let a,n,o;e==="xml"?(a=V(t),n=`article_${t.id}.xml`,o="application/xml"):(a=S(t),n=`article_${t.id}.json`,o="application/json");const i=new Blob([a],{type:o}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l)},G=(t,e)=>{if(!t.items||t.items.length===0){h.warning("批量结果中没有可导出的内容");return}t.items.forEach((a,n)=>{let o,i,l;e==="xml"?(o=V(a),i=`${t.task_id}_${n}.xml`,l="application/xml"):(o=S(a),i=`${t.task_id}_${n}.json`,l="application/json");const k=new Blob([o],{type:l}),M=document.createElement("a");M.href=URL.createObjectURL(k),M.download=i,document.body.appendChild(M),M.click(),document.body.removeChild(M)})},W=async()=>{if(!c.value?.task_id){h.warning("无法下载，缺少任务ID");return}try{const t=await F.get(`http://115.190.111.69:11012/tasks/${c.value.task_id}/download`,{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=e,a.setAttribute("download",`batch-results-${c.value.task_id}.zip`),document.body.appendChild(a),a.click(),document.body.removeChild(a),h.success("下载成功")}catch(t){console.error("下载失败:",t),h.error("下载失败，可能任务已过期或被删除")}},ee=()=>{let t="";if(c.value&&(c.value.isBatch&&C.value?t=r.value===3?V(C.value):S(C.value):c.value.isBatch||(t=r.value===3?V(c.value):S(c.value))),!t){h.warning("没有可复制的内容");return}navigator.clipboard.writeText(t).then(()=>{h.success("内容已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),h.error("复制失败")})},z=t=>{if(!t)return"";const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},V=t=>{if(!t||!t.content)return"<!-- 无内容 -->";const e=t.content,a=e.match(/<h1>(.*?)<\/h1>/)?.[1]||e.match(/<title>(.*?)<\/title>/)?.[1]||"无标题",o=z(e).split(`

`).filter(l=>l.trim()!=="");let i=`<?xml version="1.0" encoding="UTF-8"?>
`;return i+=`<article>
`,i+=`  <source>${t.url||t.filename||"未知来源"}</source>
`,i+=`  <date>${t.time||new Date().toLocaleString()}</date>
`,i+=`  <title>${a}</title>
`,i+=`  <content>
`,o.forEach((l,k)=>{k===0&&l.includes(a)||(i+=`    <paragraph>${l}</paragraph>
`)}),i+=`  </content>
`,i+="</article>",i},S=t=>{if(!t||!t.content)return"{}";const e=t.content,a=e.match(/<h1>(.*?)<\/h1>/)?.[1]||e.match(/<title>(.*?)<\/title>/)?.[1]||"无标题",o=z(e).split(`

`).filter(l=>l.trim()!==""),i={source:t.url||t.filename||"未知来源",date:t.time||new Date().toLocaleString(),title:a,content:o.filter((l,k)=>!(k===0&&l.includes(a)))};return JSON.stringify(i,null,2)};return(t,e)=>{const a=O("el-date-picker"),n=O("el-radio"),o=O("el-radio-group"),i=O("el-icon");return u(),m("div",ve,[d(de),s("div",me,[s("div",_e,[e[20]||(e[20]=s("h1",null,"RESULTS",-1)),s("div",pe,[e[15]||(e[15]=s("h2",null,"查看网页清洗结果并导出供LLM使用的数据",-1)),s("div",fe,[s("button",{class:"cssbuttons-io",onClick:K,disabled:!g.value.length},e[14]||(e[14]=[s("span",null,[s("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M0 0h24v24H0z",fill:"none"}),s("path",{d:"M24 12l-5.657 5.657-1.414-1.414L21.172 12l-4.243-4.243 1.414-1.414L24 12zM2.828 12l4.243 4.243-1.414 1.414L0 12l5.657-5.657L7.07 7.757 2.828 12zm6.96 9H7.66l6.552-18h2.128L9.788 21z",fill:"currentColor"})]),p(" 批量导出")],-1)]),8,he),s("button",{disabled:!g.value.length,onClick:q,class:"deletebutton"}," 删除 ",8,be)])]),s("div",ge,[s("div",ke,[d(_(Y),{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value=l),placeholder:"搜索结果...","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),s("div",we,[e[16]||(e[16]=s("span",{class:"date-label"},"按日期筛选：",-1)),d(a,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=l=>B.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",clearable:!0,onChange:t.onDateRangeChange},null,8,["modelValue","onChange"])]),s("div",Ce,[e[19]||(e[19]=s("div",{class:"tag"},[s("img",{src:ue,class:"deepseek"}),p("导出格式 ")],-1)),d(o,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l),style:{display:"inline-block"}},{default:v(()=>[d(n,{label:3},{default:v(()=>e[17]||(e[17]=[p("XML",-1)])),_:1,__:[17]}),d(n,{label:6},{default:v(()=>e[18]||(e[18]=[p("JSON",-1)])),_:1,__:[18]})]),_:1},8,["modelValue"])])])]),s("div",ye,[J.value.length===0?(u(),m("div",xe,f(D.value?"没有匹配的搜索结果":"暂无处理结果"),1)):(u(),m("div",Le,[(u(!0),m(j,null,le(J.value,l=>(u(),m("div",{key:l.id,class:E(["result-item",{"batch-item":l.isBatch}]),onClick:k=>Q(l)},[s("div",Be,[d(_(ae),{modelValue:l.selected,"onUpdate:modelValue":k=>l.selected=k,onClick:e[3]||(e[3]=oe(()=>{},["stop"])),class:"result-checkbox"},null,8,["modelValue","onUpdate:modelValue"]),s("div",Ve,[s("div",Se,[s("h3",$e,f(l.url),1),l.isBatch?(u(),ne(_(ie),{key:0,size:"small",type:"success"},{default:v(()=>e[21]||(e[21]=[p("批量",-1)])),_:1,__:[21]})):x("",!0)]),s("div",De,[s("span",Me,[d(i,null,{default:v(()=>[d(_(ce))]),_:1}),p(" "+f(l.time),1)]),l.isBatch?(u(),m("span",Ue,[d(i,null,{default:v(()=>[d(_(I))]),_:1}),p(" "+f(l.fileCount)+"个文件 ",1)])):x("",!0)])])])],10,Re))),128))]))])]),d(_(X),{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=l=>T.value=l),title:A.value,width:"70%",class:"result-dialog"},{footer:v(()=>[s("span",tt,[s("button",{class:"copybutton",onClick:ee},"复制"),c.value?.isBatch?(u(),m("button",{key:0,class:"downloadbutton",onClick:W}," 下载ZIP ")):x("",!0)])]),default:v(()=>[c.value?.isBatch?(u(),m(j,{key:0},[s("div",Ee,[s("div",Oe,[d(_(Y),{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=l=>R.value=l),placeholder:"在批量结果中搜索...","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),s("div",Ne,[s("span",null,"当前查看: "+f(b.value+1)+"/"+f(y.value.length),1),s("div",Te,[d(_(N),{size:"small",disabled:b.value===0,onClick:e[5]||(e[5]=l=>b.value--)},{default:v(()=>e[22]||(e[22]=[p(" 上一个 ",-1)])),_:1,__:[22]},8,["disabled"]),d(_(N),{size:"small",disabled:b.value>=y.value.length-1,onClick:e[6]||(e[6]=l=>b.value++)},{default:v(()=>e[23]||(e[23]=[p(" 下一个 ",-1)])),_:1,__:[23]},8,["disabled"])])])]),y.value.length===0?(u(),m("div",je," 没有匹配的搜索结果 ")):(u(),m("div",Ie,[s("div",Je,[s("h4",null,f(C.value?.filename||"未命名文件"),1)]),s("div",ze,[s("div",Ye,[s("button",{class:E(["tab-button",{active:r.value===3}]),onClick:e[7]||(e[7]=l=>r.value=3)}," XML ",2),s("button",{class:E(["tab-button",{active:r.value===6}]),onClick:e[8]||(e[8]=l=>r.value=6)}," JSON ",2)])]),s("div",Xe,[s("h2",Fe,[d(i,null,{default:v(()=>[d(_(I))]),_:1}),p(" "+f(r.value===3?"XML格式":"JSON格式"),1)]),s("div",He,[C.value&&r.value===3?(u(),m("pre",Ae,f(V(C.value)),1)):x("",!0),C.value&&r.value===6?(u(),m("pre",Qe,f(S(C.value)),1)):x("",!0)])])]))],64)):(u(),m(j,{key:1},[s("div",qe,[s("div",Pe,[s("button",{class:E(["tab-button",{active:r.value===3}]),onClick:e[9]||(e[9]=l=>r.value=3)}," XML ",2),s("button",{class:E(["tab-button",{active:r.value===6}]),onClick:e[10]||(e[10]=l=>r.value=6)}," JSON ",2)])]),s("div",Ke,[s("h2",Ze,[d(i,null,{default:v(()=>[d(_(I))]),_:1}),p(" "+f(r.value===3?"XML格式":"JSON格式"),1)]),s("div",Ge,[c.value&&r.value===3?(u(),m("pre",We,f(V(c.value)),1)):x("",!0),c.value&&r.value===6?(u(),m("pre",et,f(S(c.value)),1)):x("",!0)])])],64))]),_:1},8,["modelValue","title"]),d(_(X),{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=l=>$.value=l),title:"确认删除",width:"30%",class:"delete-dialog"},{footer:v(()=>[s("span",st,[d(_(N),{onClick:e[12]||(e[12]=l=>$.value=!1),type:"primary"},{default:v(()=>e[24]||(e[24]=[p("取消",-1)])),_:1,__:[24]}),d(_(N),{type:"danger",onClick:P},{default:v(()=>e[25]||(e[25]=[p("确定",-1)])),_:1,__:[25]})])]),default:v(()=>[e[26]||(e[26]=s("div",{class:"delete-content"},"确定要删除选中的记录吗？此操作不可恢复。",-1))]),_:1,__:[26]},8,["modelValue"])])}}},dt=re(lt,[["__scopeId","data-v-c516a9fb"]]);export{dt as default};
