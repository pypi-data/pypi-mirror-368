let s,g,h,_,b;const r=document.getElementById("letter"),m=document.getElementById("capital"),u=document.getElementById("number"),v=document.getElementById("symbol"),p=document.getElementById("length"),e=document.getElementById("password"),i=document.getElementById("password-repeat"),w=document.getElementById("loader"),L=document.getElementById("submit-btn"),f=document.getElementById("submit-btn-inactive"),S=document.querySelectorAll(".show-password");window.onload=async function(){const t=(await(await fetch("/api/v1/system/version")).json()).result,n=document.getElementById("versionHolder_2");n.innerHTML=t,navigator.userAgent.indexOf("Chrome")!=-1||navigator.userAgent.indexOf("Edg")!=-1||navigator.userAgent.indexOf("Edge")!=-1||navigator.userAgent.indexOf("Firefox")!=-1||(document.getElementById("browserWarning").style.display="block");const d=await fetch("/api/v1/settings");var o=(await d.json()).result;if(s={},d.status===200){let c=0;for(let l of o)l.setting==="service.password_policy.minimum_lowercase_letters"?(isNaN(l.effective_value)||(s.minimumLowercaseLetters=l.effective_value),c++):l.setting==="service.password_policy.minimum_uppercase_letters"?(isNaN(l.effective_value)||(s.minimumUppercaseLetters=l.effective_value),c++):l.setting==="service.password_policy.minimum_digits"?(isNaN(l.effective_value)||(s.minimumDigits=l.effective_value),c++):l.setting==="service.password_policy.minimum_symbols"?(isNaN(l.effective_value)||(s.minimumSymbols=l.effective_value),c++):l.setting==="service.password_policy.minimum_length"&&(isNaN(l.effective_value)||(s.minimumLength=l.effective_value),c++);c!==5&&console.error("Expected 5 password_policy settings; received "+c)}s.minimumDigits===0&&u.classList.add("hide"),s.minimumLowercaseLetters===0&&r.classList.add("hide"),s.minimumLength===0&&p.classList.add("hide"),s.minimumUppercaseLetters===0&&m.classList.add("hide"),s.minimumSymbols===0&&v.classList.add("hide"),r.querySelector("b").innerText=parseInt(s.minimumLowercaseLetters),m.querySelector("b").innerText=parseInt(s.minimumUppercaseLetters),u.querySelector("b").innerText=parseInt(s.minimumDigits),v.querySelector("b").innerText=parseInt(s.minimumSymbols),p.querySelector("b").innerText=parseInt(s.minimumLength),r.querySelector("span").innerText=s.minimumLowercaseLetters>1?"s":"",m.querySelector("span").innerText=s.minimumUppercaseLetters>1?"s":"",u.querySelector("span").innerText=s.minimumDigits>1?"s":"",v.querySelector("span").innerText=s.minimumSymbols>1?"s":"",p.querySelector("span").innerText=s.minimumLength>1?"s":"",g=new RegExp("(?=(.*[a-z]){"+parseInt(s.minimumLowercaseLetters)+",})"),h=new RegExp("(?=(.*[A-Z]){"+parseInt(s.minimumUppercaseLetters)+",})"),_=new RegExp("(?=(.*[0-9]){"+parseInt(s.minimumDigits)+",})"),b=new RegExp("(?=(.*[^a-zA-Z0-9]){"+parseInt(s.minimumSymbols)+",})");function y(){e.value.match(g)?(r.classList.remove("invalid"),r.classList.add("valid")):(r.classList.remove("valid"),r.classList.add("invalid")),e.value.match(h)?(m.classList.remove("invalid"),m.classList.add("valid")):(m.classList.remove("valid"),m.classList.add("invalid")),e.value.match(_)?(u.classList.remove("invalid"),u.classList.add("valid")):(u.classList.remove("valid"),u.classList.add("invalid")),e.value.match(b)?(v.classList.remove("invalid"),v.classList.add("valid")):(v.classList.remove("valid"),v.classList.add("invalid")),e.value.length>=s.minimumLength?(p.classList.remove("invalid"),p.classList.add("valid")):(p.classList.remove("valid"),p.classList.add("invalid"));const c=document.getElementById("match_warning");e.value!==i.value&&i.value.length===0?(i.classList.remove("wrong_input"),i.classList.add("lacks_input"),c.classList.add("hide")):e.value!==i.value&&i.value.length>0?(i.classList.remove("lacks_input"),i.classList.add("wrong_input"),c.classList.remove("hide")):(i.classList.remove("lacks_input"),i.classList.remove("wrong_input"),c.classList.add("hide")),e.value.match(g)&&e.value.match(_)&&e.value.match(b)&&e.value.match(h)&&e.value.length>=s.minimumLength&&e.value==i.value?(L.classList.remove("hide"),f.classList.add("hide")):(L.classList.add("hide"),f.classList.remove("hide"))}e.addEventListener("keyup",y),i.addEventListener("keyup",y)};function I(a){if(a.key==="Enter")if(a.preventDefault(),e.value.match(g)&&e.value.match(_)&&e.value.match(b)&&e.value.match(h)&&e.value.length>=s.minimumLength&&e.value==i.value)x();else return}async function x(){if(e.value!==i.value){E("Passwords do not match");return}L.style.display="none",f.classList.add("hide"),w.classList.remove("hide"),e.tabIndex="-1",i.tabIndex="-1",e.disabled=!0,i.disabled=!0;const a=await fetch("/api/v1/auth/bootstrap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({superadminPassword:e.value})});if(a.ok)T(),setTimeout(function(){f.classList.add("hide"),w.classList.add("hide"),L.style.display="block",e.tabIndex="1",i.tabIndex="1",e.disabled=!1,i.disabled=!1,document.location.href="/#/connectivity"},3e3);else{const t=await a.json();E(t.message),f.classList.add("hide"),w.classList.add("hide"),L.style.display="block",e.tabIndex="1",i.tabIndex="1",e.disabled=!1,i.disabled=!1}}function k(a){const t=a.target.parentElement.querySelector(".icon");t.classList.contains("icon-eye")?(t.classList.remove("icon-eye"),t.classList.add("icon-eye-closed")):t.classList.contains("icon-eye-closed")&&(t.classList.remove("icon-eye-closed"),t.classList.add("icon-eye"));const n=t.parentElement.parentElement.querySelector("input");n.type!="password"?n.type="password":n.type="text"}function T(){const a=document.getElementById("error");a.innerHTML="";const t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert--info");const n=document.createElement("div");n.classList.add("alert__icon"),n.classList.add("icon-info-outline"),t.appendChild(n);const d=document.createElement("div");d.classList.add("alert__message");const o=document.createElement("a"),y=document.createTextNode("If your browser does not automatically redirect you, please click here.");o.appendChild(y),d.appendChild(o),o.title="redirection",o.href="/#/connectivity",t.appendChild(d),a.appendChild(t)}function E(a){const t=document.getElementById("error");t.innerHTML="";const n=document.createElement("div");n.classList.add("alert"),n.classList.add("alert--warning");const d=document.createElement("div");d.classList.add("alert__icon"),d.classList.add("icon-warning-outline"),n.appendChild(d);const o=document.createElement("div");o.classList.add("alert__message"),o.textContent=a,n.appendChild(o),t.appendChild(n)}e.onkeyup=I;i.onkeyup=I;L.onclick=x;for(let a of S)a.addEventListener("click",t=>{k(t)});
