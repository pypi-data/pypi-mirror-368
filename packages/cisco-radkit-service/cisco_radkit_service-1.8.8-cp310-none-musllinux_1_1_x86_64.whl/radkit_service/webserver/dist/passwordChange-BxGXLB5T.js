import{g as N}from"./mixins-B-skLgHR.js";let t,_,b,E,I;const m=document.getElementById("letter"),u=document.getElementById("capital"),v=document.getElementById("number"),p=document.getElementById("symbol"),L=document.getElementById("length"),r=document.getElementById("old-password"),e=document.getElementById("password"),i=document.getElementById("password-repeat"),x=document.getElementById("loader"),y=document.getElementById("submit-btn"),w=document.getElementById("submit-btn-inactive"),h=document.getElementById("generate-password-btn"),q=document.getElementById("secure-password"),A=N(document.cookie,"csrf_token"),j=document.querySelectorAll(".show-password");window.onload=async function(){const n=(await(await fetch("/api/v1/system/version")).json()).result,d=document.getElementById("versionHolder_2");d.innerHTML=n,navigator.userAgent.indexOf("Chrome")!=-1||navigator.userAgent.indexOf("Edg")!=-1||navigator.userAgent.indexOf("Edge")!=-1||navigator.userAgent.indexOf("Firefox")!=-1||(document.getElementById("browserWarning").style.display="block");const c=await fetch("/api/v1/settings");var o=(await c.json()).result;if(t={},c.status===200){let a=0;for(let s of o)s.setting==="service.password_policy.minimum_lowercase_letters"?(isNaN(s.effective_value)||(t.minimumLowercaseLetters=s.effective_value),a++):s.setting==="service.password_policy.minimum_uppercase_letters"?(isNaN(s.effective_value)||(t.minimumUppercaseLetters=s.effective_value),a++):s.setting==="service.password_policy.minimum_digits"?(isNaN(s.effective_value)||(t.minimumDigits=s.effective_value),a++):s.setting==="service.password_policy.minimum_symbols"?(isNaN(s.effective_value)||(t.minimumSymbols=s.effective_value),a++):s.setting==="service.password_policy.minimum_length"&&(isNaN(s.effective_value)||(t.minimumLength=s.effective_value),a++);a!==5&&console.error("Expected 5 password_policy settings; received "+a)}m.querySelector("b").innerText=parseInt(t.minimumLowercaseLetters),u.querySelector("b").innerText=parseInt(t.minimumUppercaseLetters),t.minimumDigits===0&&v.classList.add("hide"),t.minimumLowercaseLetters===0&&m.classList.add("hide"),t.minimumLength===0&&L.classList.add("hide"),t.minimumUppercaseLetters===0&&u.classList.add("hide"),t.minimumSymbols===0&&p.classList.add("hide"),v.querySelector("b").innerText=parseInt(t.minimumDigits),p.querySelector("b").innerText=parseInt(t.minimumSymbols),L.querySelector("b").innerText=parseInt(t.minimumLength),m.querySelector("span").innerText=t.minimumLowercaseLetters>1?"s":"",u.querySelector("span").innerText=t.minimumUppercaseLetters>1?"s":"",v.querySelector("span").innerText=t.minimumDigits>1?"s":"",p.querySelector("span").innerText=t.minimumSymbols>1?"s":"",L.querySelector("span").innerText=t.minimumLength>1?"s":"",_=new RegExp("(?=(.*[a-z]){"+parseInt(t.minimumLowercaseLetters)+",})"),b=new RegExp("(?=(.*[A-Z]){"+parseInt(t.minimumUppercaseLetters)+",})"),E=new RegExp("(?=(.*[0-9]){"+parseInt(t.minimumDigits)+",})"),I=new RegExp("(?=(.*[^a-zA-Z0-9]){"+parseInt(t.minimumSymbols)+",})");function f(){e.value.match(_)?(m.classList.remove("invalid"),m.classList.add("valid")):(m.classList.remove("valid"),m.classList.add("invalid")),e.value.match(b)?(u.classList.remove("invalid"),u.classList.add("valid")):(u.classList.remove("valid"),u.classList.add("invalid")),e.value.match(E)?(v.classList.remove("invalid"),v.classList.add("valid")):(v.classList.remove("valid"),v.classList.add("invalid")),e.value.match(I)?(p.classList.remove("invalid"),p.classList.add("valid")):(p.classList.remove("valid"),p.classList.add("invalid")),e.value.length>=t.minimumLength?(L.classList.remove("invalid"),L.classList.add("valid")):(L.classList.remove("valid"),L.classList.add("invalid"));const a=document.getElementById("match_warning");e.value!==i.value&&i.value.length===0?(i.classList.remove("wrong_input"),i.classList.add("lacks_input"),a.classList.add("hide")):e.value!==i.value&&i.value.length>0?(i.classList.remove("lacks_input"),i.classList.add("wrong_input"),a.classList.remove("hide")):(i.classList.remove("lacks_input"),i.classList.remove("wrong_input"),a.classList.add("hide")),e.value.match(_)&&e.value.match(E)&&e.value.match(I)&&e.value.match(b)&&e.value.length>=t.minimumLength&&e.value==i.value&&r.value.length>0?(y.classList.remove("hide"),w.classList.add("hide")):(y.classList.add("hide"),w.classList.remove("hide"))}async function B(){h.tabIndex="-1",h.disabled=!0;var a=Number(q.value);a||(a=24);const s=await fetch(`/api/v1/admins/generate_password?password_length=${a}`,{method:"GET"});if(s.ok){const g=await s.json();e.value=g.result,i.value=g.result,f()}h.tabIndex="1",h.disabled=!1}function C(a){const s=a.target.parentElement.querySelector(".icon");s.classList.contains("icon-eye")?(s.classList.remove("icon-eye"),s.classList.add("icon-eye-closed")):s.classList.contains("icon-eye-closed")&&(s.classList.remove("icon-eye-closed"),s.classList.add("icon-eye"));const g=s.parentElement.parentElement.querySelector("input");g.type!="password"?g.type="password":g.type="text"}e.addEventListener("keyup",k),e.addEventListener("keyup",f),i.addEventListener("keyup",k),i.addEventListener("keyup",f),r.addEventListener("keyup",k),r.addEventListener("keyup",f),h.addEventListener("click",B);for(let a of j)a.addEventListener("click",s=>{C(s)})};function k(l){if(l.key==="Enter")if(l.preventDefault(),e.value.match(_)&&e.value.match(E)&&e.value.match(I)&&e.value.match(b)&&e.value.length>=t.minimumLength&&e.value==i.value)T();else return}async function T(){if(e.value!==i.value){S("Passwords do not match");return}y.style.display="none",w.classList.add("hide"),x.classList.remove("hide"),r.tabIndex="-1",e.tabIndex="-1",i.tabIndex="-1",r.disabled=!0,e.disabled=!0,i.disabled=!0;const l=await fetch("/api/v1/admins/change_password",{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":A},body:JSON.stringify({password:e.value,oldPassword:r.value})});if(l.ok)D(),setTimeout(function(){w.classList.add("hide"),x.classList.add("hide"),y.style.display="block",r.tabIndex="1",e.tabIndex="1",i.tabIndex="1",r.disabled=!1,e.disabled=!1,i.disabled=!1,document.location.href="/#/"},3e3);else{const n=await l.json();S(n.message),w.classList.add("hide"),x.classList.add("hide"),y.style.display="block",r.tabIndex="1",e.tabIndex="1",i.tabIndex="1",r.disabled=!1,e.disabled=!1,i.disabled=!1}}function D(){const l=document.getElementById("error");l.innerHTML="";const n=document.createElement("div");n.classList.add("alert"),n.classList.add("alert--info");const d=document.createElement("div");d.classList.add("alert__icon"),d.classList.add("icon-info-outline"),n.appendChild(d);const c=document.createElement("div");c.classList.add("alert__message");const o=document.createElement("a"),f=document.createTextNode("If your browser does not automatically redirect you, please click here.");o.appendChild(f),c.appendChild(o),o.title="redirection",o.href="/#/connectivity",n.appendChild(c),l.appendChild(n)}function S(l){const n=document.getElementById("error");n.innerHTML="";const d=document.createElement("div");d.classList.add("alert"),d.classList.add("alert--warning");const c=document.createElement("div");c.classList.add("alert__icon"),c.classList.add("icon-warning-outline"),d.appendChild(c);const o=document.createElement("div");o.classList.add("alert__message"),o.textContent=l,d.appendChild(o),n.appendChild(d)}y.onclick=T;
