import{w as De,u as Me}from"./store-BDLt0vbv.js";import{q as Se,x as Le,p as $e,r as p,l as e}from"./chunk-GNGMS2XR-KLeu_BA0.js";import{a as oe,L as Ie,Z,W as H}from"./Layout-CP5Hc7nX.js";import{K as Ae}from"./KickoffNavigation-DfJcBmsR.js";import{C as f,a as y,b as J,c as z,d as G}from"./card-DMpzrDC2.js";import{T as Oe,a as Ve,b as $,c as I}from"./tabs-BvsZBTz_.js";import{B as _}from"./badge-CzGG4LGd.js";import{I as se,T as Ue,a as qe,b as Fe,A as ae,c as re,d as ie,e as ne,S as Re}from"./scroll-area-CkefNqLd.js";import{C as le,a as de,S as Be,b as Pe,c as We,d as Ze}from"./sheet-DgYB9uNH.js";import{L as ce}from"./play-BgHo1Tz0.js";import{C as A}from"./circle-alert-CVY5oy2y.js";import{C as O}from"./clock-D9RgnNZI.js";import"./index-BKaxNvVC.js";import"./chevron-down-BlJJcPQY.js";import"./transform-BEtJ_6wc.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],K=oe("Brain",He);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],ze=oe("Users",Je);function ht(){return[{title:"CrewAI - Execution Traces"},{name:"description",content:"View execution traces for your CrewAI agents"}]}const ut=De(function(){Se(),Le();const{isDarkMode:Ke}=Me(),[me]=$e(),V=me.get("crewId"),[X,xe]=p.useState([]),[t,Q]=p.useState(null),[he,Y]=p.useState(!0),[ee,ue]=p.useState(null),[ge,pe]=p.useState("overview"),[U,je]=p.useState(null),[Xe,D]=p.useState(null),[fe,te]=p.useState(!1),[M,ye]=p.useState(null),q=p.useRef(null),Ne=p.useMemo(()=>{var b,S;if(!t)return[];console.log("Creating timeline spans for trace:",{traceId:t.id,hasLLMCalls:!!t.llmCalls,llmCallsCount:((b=t.llmCalls)==null?void 0:b.length)||0,hasToolExecutions:!!t.toolExecutions,toolExecutionsCount:((S=t.toolExecutions)==null?void 0:S.length)||0,agentsCount:Object.keys(t.agents||{}).length,tasksCount:Object.keys(t.tasks||{}).length});const s=[],r=new Date(t.start_time),a=t.end_time?new Date(t.end_time):null,h=a?a.getTime()-r.getTime():0,l={id:t.id,name:`Crew: ${t.crew_name}`,startTime:r,endTime:a,status:t.status,depth:0,duration:h,serviceName:"crew",operation:"execution",children:[]};s.push(l),t.agents&&typeof t.agents=="object"&&Object.values(t.agents).forEach(n=>{const N=new Date(n.start_time),m=n.end_time?new Date(n.end_time):null,j=m?m.getTime()-N.getTime():0,T={id:n.id,name:`Agent: ${n.name}`,startTime:N,endTime:m,status:n.status,parentId:t.id,depth:1,duration:j,serviceName:"agent",operation:n.role,children:[]};s.push(T),n.llmCalls&&n.llmCalls.length>0&&n.llmCalls.forEach((x,L)=>{const w=new Date(x.timestamp),k=x.duration?new Date(w.getTime()+x.duration):x.status==="completed"?new Date(w.getTime()+2e3):null,i={id:`${n.id}-llm-${L}`,name:`LLM Call: ${x.model||"Unknown Model"}`,startTime:w,endTime:k,status:x.status,parentId:n.id,depth:2,duration:x.duration||(k?k.getTime()-w.getTime():0),serviceName:"llm",operation:x.type,children:[]};s.push(i)}),n.toolExecutions&&n.toolExecutions.length>0&&n.toolExecutions.forEach((x,L)=>{const w=new Date(x.timestamp),k=x.duration?new Date(w.getTime()+x.duration):x.status==="completed"?new Date(w.getTime()+1e3):null,i={id:`${n.id}-tool-${L}`,name:`Tool: ${x.tool_name||"Unknown Tool"}`,startTime:w,endTime:k,status:x.status,parentId:n.id,depth:2,duration:x.duration||(k?k.getTime()-w.getTime():0),serviceName:"tool",operation:x.type,children:[]};s.push(i)})}),t.tasks&&typeof t.tasks=="object"&&Object.values(t.tasks).forEach(n=>{const N=new Date(n.start_time),m=n.end_time?new Date(n.end_time):null,j=m?m.getTime()-N.getTime():0,T={id:n.id,name:n.description.length>30?`${n.description.substring(0,30)}...`:n.description,startTime:N,endTime:m,status:n.status,parentId:n.agent_id||t.id,depth:2,duration:j,serviceName:"task",operation:"execution",children:[]};s.push(T)}),t.llmCalls&&t.llmCalls.length>0&&t.llmCalls.forEach((n,N)=>{if(!n.agent_id){const m=new Date(n.timestamp),j=n.duration?new Date(m.getTime()+n.duration):n.status==="completed"?new Date(m.getTime()+2e3):null,T={id:`crew-llm-${N}`,name:`LLM Call: ${n.model||"Unknown Model"}`,startTime:m,endTime:j,status:n.status,parentId:t.id,depth:1,duration:n.duration||(j?j.getTime()-m.getTime():0),serviceName:"llm",operation:n.type,children:[]};s.push(T)}}),t.toolExecutions&&t.toolExecutions.length>0&&t.toolExecutions.forEach((n,N)=>{if(!n.agent_id){const m=new Date(n.timestamp),j=n.duration?new Date(m.getTime()+n.duration):n.status==="completed"?new Date(m.getTime()+1e3):null,T={id:`crew-tool-${N}`,name:`Tool: ${n.tool_name||"Unknown Tool"}`,startTime:m,endTime:j,status:n.status,parentId:t.id,depth:1,duration:n.duration||(j?j.getTime()-m.getTime():0),serviceName:"tool",operation:n.type,children:[]};s.push(T)}});const o=new Map;return s.forEach(n=>o.set(n.id,n)),s.forEach(n=>{n.parentId&&o.has(n.parentId)&&o.get(n.parentId).children.push(n)}),s},[t]);p.useMemo(()=>{if(!t)return 0;const s=new Date(t.start_time).getTime();return(t.end_time?new Date(t.end_time).getTime():Date.now())-s},[t]);const ve=s=>{je(s),setTimeout(()=>{q.current&&q.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},we=s=>{ye(s),Q(s),te(!0),s.llmCalls&&s.toolExecutions&&s.telemetryMetrics&&D({llmCalls:s.llmCalls,toolExecutions:s.toolExecutions,metrics:s.telemetryMetrics})};p.useEffect(()=>{async function s(){try{Y(!0);const r=await fetch(`/api/crews/${V}/traces`);if(!r.ok)throw new Error(`Failed to fetch traces: ${r.statusText}`);const h=(await r.json()).map(l=>{const o={...l,agents:l.agents||{},tasks:l.tasks||{},events:l.events||[]},b=be(o);return{...o,telemetryMetrics:b.metrics,llmCalls:b.llmCalls,toolExecutions:b.toolExecutions}});if(xe(h),h.length>0){const l=h[0];Q(l),l.llmCalls&&l.toolExecutions&&l.telemetryMetrics&&D({llmCalls:l.llmCalls,toolExecutions:l.toolExecutions,metrics:l.telemetryMetrics})}}catch(r){console.error("Error fetching traces:",r),ue(r instanceof Error?r.message:String(r))}finally{Y(!1)}}s()},[V]);const be=s=>{const r=[],a=[],h=s.events||[],l=new Map,o=new Map;h.forEach(i=>{if(i.type.startsWith("llm.")){const g=`${i.data.agent_id||"unknown"}-${i.data.task_id||"unknown"}`;l.has(g)||l.set(g,{});const d=l.get(g);i.type==="llm.started"?d.started=i:i.type==="llm.completed"?d.completed=i:i.type==="llm.failed"&&(d.failed=i)}else if(i.type.startsWith("tool.")){const g=`${i.data.agent_id||"unknown"}-${i.data.tool_name||"unknown"}`;o.has(g)||o.set(g,{});const d=o.get(g);i.type==="tool.started"?d.started=i:i.type==="tool.completed"?d.completed=i:i.type==="tool.failed"&&(d.failed=i)}}),l.forEach((i,g)=>{var C;const d=i.started,c=i.completed||i.failed;if(d||c){const u=c||d,B=d?new Date(d.timestamp).getTime():new Date(u.timestamp).getTime(),E=c?new Date(c.timestamp).getTime():null,P=E?E-B:void 0,W={id:u.data.id||`llm-${g}-${u.timestamp}`,type:c?c.type:d.type,timestamp:d?d.timestamp:u.timestamp,model:u.data.model||"Unknown Model",prompt:u.data.prompt,completion:c==null?void 0:c.data.completion,tokens:c==null?void 0:c.data.tokens,status:i.completed?"completed":i.failed?"failed":"started",agent_id:u.data.agent_id,agent_name:u.data.agent_name,task_id:u.data.task_id,error:(C=i.failed)==null?void 0:C.data.error,duration:P};r.push(W)}}),o.forEach((i,g)=>{var C;const d=i.started,c=i.completed||i.failed;if(d||c){const u=c||d,B=d?new Date(d.timestamp).getTime():new Date(u.timestamp).getTime(),E=c?new Date(c.timestamp).getTime():null,P=E?E-B:void 0,W={id:u.data.id||`tool-${g}-${u.timestamp}`,type:c?c.type:d.type,timestamp:d?d.timestamp:u.timestamp,tool_name:u.data.tool_name||"Unknown Tool",inputs:u.data.inputs,outputs:c==null?void 0:c.data.outputs,status:i.completed?"completed":i.failed?"failed":"started",agent_id:u.data.agent_id,agent_name:u.data.agent_name,error:(C=i.failed)==null?void 0:C.data.error,duration:P};a.push(W)}});const b=r.length,S=r.filter(i=>i.status==="completed").length,n=r.filter(i=>i.status==="failed").length,N=a.length,m=a.filter(i=>i.status==="completed").length,j=a.filter(i=>i.status==="failed").length,T=r.reduce((i,g)=>i+(g.tokens||0),0),x=s.start_time?new Date(s.start_time).getTime():0,w=(s.end_time?new Date(s.end_time).getTime():Date.now())-x,k={totalLLMCalls:b,totalToolExecutions:N,totalTokens:T,executionTime:w,completedLLMCalls:S,failedLLMCalls:n,completedToolExecutions:m,failedToolExecutions:j};return Object.values(s.agents||{}).forEach(i=>{i.llmCalls=r.filter(g=>g.agent_id===i.id),i.toolExecutions=a.filter(g=>g.agent_id===i.id)}),console.log("Extracted telemetry data:",{llmCallsCount:r.length,toolExecutionsCount:a.length,llmCalls:r.map(i=>({id:i.id,model:i.model,agent_id:i.agent_id,duration:i.duration})),toolExecutions:a.map(i=>({id:i.id,tool_name:i.tool_name,agent_id:i.agent_id,duration:i.duration}))}),{llmCalls:r,toolExecutions:a,metrics:k}};p.useEffect(()=>{t&&t.llmCalls&&t.toolExecutions&&t.telemetryMetrics?D({llmCalls:t.llmCalls,toolExecutions:t.toolExecutions,metrics:t.telemetryMetrics}):D(null)},[t]);const v=s=>new Date(s).toLocaleString(),F=(s,r)=>{if(!s||!r)return"N/A";try{const a=new Date(s).getTime(),l=new Date(r).getTime()-a;if(l<1e3)return`${l}ms`;if(l<6e4)return`${(l/1e3).toFixed(2)}s`;{const o=Math.floor(l/6e4),b=(l%6e4/1e3).toFixed(2);return`${o}m ${b}s`}}catch{return"Invalid time"}},R=s=>{switch(s.toLowerCase()){case"running":case"initializing":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300 border-blue-200 dark:border-blue-800";case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300 border-green-200 dark:border-green-800";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300 border-red-200 dark:border-red-800";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300 border-gray-200 dark:border-gray-800"}},Te=()=>{if(!t)return null;const s=Object.keys(t.agents).length,r=Object.keys(t.tasks).length,a=t.events.length,h=Object.values(t.agents).filter(o=>o.status==="completed").length,l=Object.values(t.tasks).filter(o=>o.status==="completed").length;return e.jsxs("div",{className:"space-y-6",children:[t.telemetryMetrics&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Telemetry Metrics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(f,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.telemetryMetrics.totalLLMCalls}),e.jsx("div",{className:"text-sm text-gray-500",children:"LLM Calls"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.telemetryMetrics.completedLLMCalls," completed, ",t.telemetryMetrics.failedLLMCalls," failed"]})]}),e.jsx(K,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(f,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.telemetryMetrics.totalToolExecutions}),e.jsx("div",{className:"text-sm text-gray-500",children:"Tool Executions"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.telemetryMetrics.completedToolExecutions," completed, ",t.telemetryMetrics.failedToolExecutions," failed"]})]}),e.jsx(H,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(f,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.telemetryMetrics.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Tokens"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Across all LLM calls"})]}),e.jsx(Z,{className:"h-8 w-8 text-purple-500"})]})})}),e.jsx(f,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.telemetryMetrics.executionTime<6e4?`${(t.telemetryMetrics.executionTime/1e3).toFixed(1)}s`:`${(t.telemetryMetrics.executionTime/6e4).toFixed(1)}m`}),e.jsx("div",{className:"text-sm text-gray-500",children:"Execution Time"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Total duration"})]}),e.jsx(Ue,{className:"h-8 w-8 text-orange-500"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f,{children:e.jsxs(y,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Agents (",h," completed)"]})]})}),e.jsx(f,{children:e.jsxs(y,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Tasks (",l," completed)"]})]})}),e.jsx(f,{children:e.jsxs(y,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:"Events"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Execution Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Crew ID"}),e.jsx("div",{className:"text-sm font-mono",children:t.crew_id}),e.jsx("div",{className:"text-sm text-gray-500",children:"Trace ID"}),e.jsx("div",{className:"text-sm font-mono",children:t.id}),e.jsx("div",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("div",{children:e.jsx(_,{className:R(t.status),children:t.status})}),e.jsx("div",{className:"text-sm text-gray-500",children:"Start Time"}),e.jsx("div",{className:"text-sm",children:v(t.start_time)}),t.end_time&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"End Time"}),e.jsx("div",{className:"text-sm",children:v(t.end_time)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("div",{className:"text-sm",children:F(t.start_time,t.end_time)})]})]})]}),e.jsxs(f,{children:[e.jsxs(J,{className:"pb-2",children:[e.jsx(z,{className:"text-lg",children:"Execution Timeline"}),e.jsx(G,{children:"A hierarchical view of the execution spans"})]}),e.jsx(y,{children:e.jsx(qe,{spans:Ne,onSpanClick:ve})})]}),U&&e.jsxs(f,{ref:q,children:[e.jsxs(J,{className:"pb-2",children:[e.jsx(z,{className:"text-lg",children:"Span Details"}),e.jsxs(G,{children:["Detailed information for the selected span: ",U.name]})]}),e.jsx(y,{children:e.jsx(Fe,{span:U})})]})]})},ke=()=>{if(!t)return null;const s=t.agents&&typeof t.agents=="object"?Object.values(t.agents):[];return s.length===0?e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No agent data available."}):e.jsx("div",{className:"space-y-4",children:e.jsx(ae,{type:"single",collapsible:!0,className:"w-full",children:s.map(r=>e.jsxs(re,{value:r.id,children:[e.jsx(ie,{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 px-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:R(r.status),variant:"outline",children:r.status}),e.jsx("span",{className:"ml-2 font-medium",children:r.name}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",r.role,")"]})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:F(r.start_time,r.end_time)})]})}),e.jsx(ne,{className:"px-4 py-2 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Agent ID"}),e.jsx("div",{className:"text-sm font-mono",children:r.id}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Time"}),e.jsx("div",{children:v(r.start_time)}),r.end_time&&e.jsxs("div",{className:"grid grid-cols-2 col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"End Time"}),e.jsx("div",{children:v(r.end_time)})]}),r.llmCalls&&r.llmCalls.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"LLM Calls (",r.llmCalls.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.llmCalls.map((a,h)=>e.jsxs("div",{className:"border rounded-md p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:a.status==="completed"?"default":a.status==="failed"?"destructive":"secondary",children:a.status}),a.model&&e.jsx("span",{className:"text-sm font-mono",children:a.model})]}),e.jsx("span",{className:"text-xs text-gray-500",children:v(a.timestamp)})]}),a.tokens&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:[e.jsx(Z,{className:"h-3 w-3 inline mr-1"}),a.tokens," tokens"]}),a.prompt&&e.jsxs("details",{className:"mb-2",children:[e.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:text-blue-600",children:"View Prompt"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono whitespace-pre-wrap",children:a.prompt.length>500?`${a.prompt.substring(0,500)}...`:a.prompt})]}),a.completion&&e.jsxs("details",{children:[e.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:text-blue-600",children:"View Response"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono whitespace-pre-wrap",children:a.completion.length>500?`${a.completion.substring(0,500)}...`:a.completion})]}),a.error&&e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400 mt-2",children:[e.jsx(A,{className:"h-3 w-3 inline mr-1"}),a.error]})]},h))})]}),r.toolExecutions&&r.toolExecutions.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Tool Executions (",r.toolExecutions.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.toolExecutions.map((a,h)=>e.jsxs("div",{className:"border rounded-md p-3 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:a.status==="completed"?"default":a.status==="failed"?"destructive":"secondary",children:a.status}),a.tool_name&&e.jsx("span",{className:"text-sm font-mono",children:a.tool_name})]}),e.jsx("span",{className:"text-xs text-gray-500",children:v(a.timestamp)})]}),a.inputs&&e.jsxs("details",{className:"mb-2",children:[e.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:text-green-600",children:"View Inputs"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono",children:JSON.stringify(a.inputs,null,2)})]}),a.outputs&&e.jsxs("details",{children:[e.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:text-green-600",children:"View Outputs"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs font-mono",children:JSON.stringify(a.outputs,null,2)})]}),a.error&&e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400 mt-2",children:[e.jsx(A,{className:"h-3 w-3 inline mr-1"}),a.error]})]},h))})]})]})})]},r.id))})})},_e=()=>{if(!t)return null;const s=t.tasks&&typeof t.tasks=="object"?Object.values(t.tasks):[];return s.length===0?e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No task data available."}):e.jsx("div",{className:"space-y-4",children:e.jsx(ae,{type:"single",collapsible:!0,className:"w-full",children:s.map(r=>e.jsxs(re,{value:r.id,children:[e.jsx(ie,{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 px-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:R(r.status),variant:"outline",children:r.status}),e.jsx("span",{className:"ml-2 font-medium truncate max-w-md",children:r.description})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:F(r.start_time,r.end_time)})]})}),e.jsx(ne,{className:"px-4 py-2 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Task ID"}),e.jsx("div",{className:"text-sm font-mono",children:r.id}),r.agent_id&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Assigned Agent"}),e.jsx("div",{className:"text-sm font-mono",children:r.agent_id})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Time"}),e.jsx("div",{children:v(r.start_time)}),r.end_time&&e.jsxs("div",{className:"grid grid-cols-2 col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"End Time"}),e.jsx("div",{children:v(r.end_time)})]}),r.output&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Output"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-2 rounded-md text-sm whitespace-pre-wrap font-mono",children:r.output})]})]})})]},r.id))})})},Ce=s=>s.includes("completed")?{color:"text-green-600",bgColor:"bg-green-100 dark:bg-green-900/30",icon:le}:s.includes("failed")||s.includes("error")?{color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900/30",icon:de}:s.includes("started")?{color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30",icon:O}:s.includes("llm")?{color:"text-purple-600",bgColor:"bg-purple-100 dark:bg-purple-900/30",icon:K}:s.includes("tool")?{color:"text-orange-600",bgColor:"bg-orange-100 dark:bg-orange-900/30",icon:H}:{color:"text-gray-600",bgColor:"bg-gray-100 dark:bg-gray-900/30",icon:se},Ee=()=>{if(!t)return null;const s=Array.isArray(t.events)?t.events:[];if(s.length===0)return e.jsx("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"No event data available."});const r=[...s].sort((a,h)=>new Date(a.timestamp).getTime()-new Date(h.timestamp).getTime());return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Events Timeline (",r.length,")"]})}),e.jsx(Re,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-3",children:r.map((a,h)=>{const l=Ce(a.type),o=l.icon;return e.jsxs("div",{className:`border rounded-lg p-4 ${l.bgColor} hover:shadow-md transition-shadow`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:`h-5 w-5 ${l.color} flex-shrink-0`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"outline",className:`${l.color} border-current`,children:a.type}),a.data.agent_name&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Agent: ",a.data.agent_name]}),a.data.task_id&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Task: ",a.data.task_id]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:v(a.timestamp)})]})]})}),a.data.model&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Model:"})," ",a.data.model]}),a.data.tokens&&e.jsxs("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Tokens:"})," ",a.data.tokens]}),a.data.tool_name&&e.jsxs("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Tool:"})," ",a.data.tool_name]}),a.data.error&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:[e.jsx("strong",{children:"Error:"})," ",a.data.error]}),Object.keys(a.data).length>0&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:text-blue-600 dark:hover:text-blue-400",children:"View Raw Event Data"}),e.jsx("div",{className:"mt-2 text-xs font-mono bg-gray-50 dark:bg-gray-800 p-3 rounded border overflow-x-auto",children:e.jsx("pre",{children:JSON.stringify(a.data,null,2)})})]})]},h)})})})]})};return e.jsx(Ie,{children:e.jsxs("div",{className:"w-full",children:[e.jsx(Ae,{crewId:V||void 0}),he?e.jsx(f,{className:"mb-6",children:e.jsxs(y,{className:"flex items-center justify-center py-12",children:[e.jsx(ce,{className:"h-8 w-8 animate-spin text-indigo-500 mr-2"}),e.jsx("p",{children:"Loading crew traces..."})]})}):ee?e.jsx(f,{className:"mb-6",children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Error Loading Traces"}),e.jsx("p",{children:ee})]})})}):X.length===0?e.jsx(f,{className:"mb-6",children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Crew Traces Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"There are no execution traces available for this crew yet."})]})})}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(f,{children:[e.jsx(J,{className:"flex flex-row justify-between items-start",children:e.jsxs("div",{children:[e.jsx(z,{children:"Crew Execution Traces"}),e.jsx(G,{children:"Click a trace to view detailed execution information"})]})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsx("div",{className:"border rounded-lg overflow-hidden hover:bg-muted/10 transition-all cursor-pointer w-full",onClick:()=>we(s),children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center",children:s.status==="completed"?e.jsx(le,{className:"h-5 w-5 text-green-500"}):s.status==="running"?e.jsx(ce,{className:"h-5 w-5 text-blue-500 animate-spin"}):s.status==="failed"?e.jsx(de,{className:"h-5 w-5 text-red-500"}):e.jsx(A,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium mr-2",children:s.crew_name}),e.jsx(_,{variant:s.status==="completed"?"outline":s.status==="running"?"default":"destructive",className:s.status==="completed"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"",children:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[v(s.start_time)," •"," ",s.agents&&typeof s.agents=="object"?Object.keys(s.agents).length:0," agents •"," ",s.tasks&&typeof s.tasks=="object"?Object.keys(s.tasks).length:0," tasks"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium",children:s.end_time?`${Math.round((new Date(s.end_time).getTime()-new Date(s.start_time).getTime())/1e3)}s`:"Running..."}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v(s.start_time)})]})]})})},s.id))})})]})}),e.jsx(Be,{open:fe,onOpenChange:te,children:e.jsxs(Pe,{className:"w-[75vw] max-w-[75vw] sm:w-[75vw] md:w-[75vw] lg:w-[75vw] overflow-y-auto",children:[e.jsx(We,{children:e.jsx(Ze,{children:(M==null?void 0:M.crew_name)||"Crew Trace Details"})}),M&&e.jsx("div",{className:"mt-6",children:e.jsxs(Oe,{defaultValue:"overview",value:ge,onValueChange:pe,className:"w-full",children:[e.jsxs(Ve,{className:"grid grid-cols-4 mb-4",children:[e.jsxs($,{value:"overview",className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:"Overview"})]}),e.jsxs($,{value:"agents",className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Agents"})]}),e.jsx($,{value:"tasks",children:"Tasks"}),e.jsxs($,{value:"events",className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:"Events"})]})]}),e.jsx(I,{value:"overview",children:Te()}),e.jsx(I,{value:"agents",children:ke()}),e.jsx(I,{value:"tasks",children:_e()}),e.jsx(I,{value:"events",children:Ee()})]})})]})})]})})});export{ut as default,ht as meta};
