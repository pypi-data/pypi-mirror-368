import{w as pe,u as ge}from"./store-BDLt0vbv.js";import{q as re,r as c,l as e}from"./chunk-GNGMS2XR-KLeu_BA0.js";import{B as xe,L as we}from"./Layout-CP5Hc7nX.js";import{L as be,T as je,I as ye}from"./textarea-CUBdk2de.js";import{S as Ne,i as ve,j as Se,k as Fe,l as Ee}from"./select-CrlOLXkx.js";import{F as ze}from"./FlowNavigation-DHrQLs8L.js";import{A as le,a as ae,b as ce}from"./alert-DAr1l6eU.js";import"./tabs-BvsZBTz_.js";import{d as de,u as ke,f as $e,M as Q,i as _e,B as We,c as Ie,e as Ce,H as G,P as J}from"./index-K9TuxQyt.js";import{B as Z}from"./badge-CzGG4LGd.js";import{C as He}from"./card-DMpzrDC2.js";import{L as X}from"./play-BgHo1Tz0.js";import{M as ne}from"./index-ChbM4Wl4.js";import"./index-BKaxNvVC.js";import"./chevron-down-BlJJcPQY.js";import"./transform-BEtJ_6wc.js";const Me=[],Te=[],L=new de.graphlib.Graph().setDefaultEdgeLabel(()=>({}));function Re(t){let o=180,w=80;return t.forEach(d=>{var k,C,v,l,M,T,_;let $=220,p=100;if((k=d.data)!=null&&k.measured&&typeof d.data.measured=="object"&&"width"in d.data.measured&&"height"in d.data.measured){const F=d.data.measured;typeof F.width=="number"&&typeof F.height=="number"&&F.width>0&&F.height>0&&($=F.width+20,p=F.height+10)}else{if((C=d.data)!=null&&C.label&&typeof d.data.label=="string"){const F=d.data.label.length;$=Math.max(180,F*12)}if((v=d.data)!=null&&v.description&&(p+=25),(l=d.data)!=null&&l.error&&(p+=40),(M=d.data)!=null&&M.dependencies&&Array.isArray(d.data.dependencies)&&(p+=30+d.data.dependencies.length*20),(T=d.data)!=null&&T.flowMethod&&(p+=25),(_=d.data)!=null&&_.outputs&&typeof d.data.outputs=="object"){const F=JSON.stringify(d.data.outputs).length;p+=Math.min(200,F/5)}}$=Math.max(180,Math.min(400,$)),p=Math.max(80,Math.min(400,p)),o=Math.max(o,$),w=Math.max(w,p)}),{width:o,height:w}}function B(t,N,h="TB"){if(t.length===0)return{nodes:[],edges:[],fullWidth:0,fullHeight:0};const{width:f,height:m}=Re(t);L.setGraph({}),L.setGraph({rankdir:h,ranksep:100,nodesep:80}),t.forEach(p=>{L.removeNode(p.id)}),t.forEach(p=>{L.setNode(p.id,{width:f,height:m})}),N.forEach(p=>{L.setEdge(p.source,p.target)}),de.layout(L);const o=L.graph(),w=o&&o.width?o.width/2:0,d=o&&o.height?o.height/2:0;return{nodes:t.map(p=>{const k=L.node(p.id);return k?{...p,position:{x:k.x-f/2,y:k.y-m/2},data:{...p.data,uniformWidth:f,uniformHeight:m}}:(console.warn(`No dagre node found for id: ${p.id}`),p)}),edges:N,fullWidth:w,fullHeight:d}}function U(){const t=c.useRef(null),[N,h]=c.useState({width:0,height:0});return c.useEffect(()=>{const f=()=>{if(t.current){const{offsetWidth:w,offsetHeight:d}=t.current;w>0&&d>0&&h({width:w,height:d})}},m=setTimeout(f,0);let o=null;try{o=new ResizeObserver(()=>{t.current&&f()}),t.current&&o.observe(t.current)}catch(w){console.error("ResizeObserver error:",w)}return()=>{if(clearTimeout(m),o&&t.current)try{o.unobserve(t.current),o.disconnect()}catch(w){console.error("Error cleaning up ResizeObserver:",w)}}},[]),{ref:t,dimensions:N}}const Le=({data:t})=>{const{ref:N,dimensions:h}=U();c.useEffect(()=>{h.width>0&&h.height>0&&(t.measured=h)},[h,t]);const f=o=>{switch(o){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}},m=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:N,className:`px-4 py-2 shadow-md rounded-md border bg-card flex flex-col justify-center ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:m,children:e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${f(t.status)}`}),e.jsx("div",{className:"font-bold text-lg text-center",children:t.label})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":"outline",children:t.status})})]})})},De=({data:t})=>{const{ref:N,dimensions:h}=U();c.useEffect(()=>{h.width>0&&h.height>0&&(t.measured=h)},[h,t]);const f=o=>{switch(o){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";case"initializing":return"bg-purple-500";case"pending":return"bg-gray-500";default:return"bg-gray-500"}},m=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:N,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:m,children:[!t.isFirst&&e.jsx(G,{type:"target",position:J.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(G,{type:"source",position:J.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${f(t.status)}`}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsxs(Z,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":t.status==="initializing"?"default":"outline",className:`${t.status==="completed"?"bg-green-100 text-green-800 border-green-500 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":""} ${t.status==="running"?"animate-pulse":""}`,children:[t.status==="running"&&e.jsx("span",{className:"mr-1",children:"⚡"}),t.status==="completed"&&e.jsx("span",{className:"mr-1",children:"✓"}),t.status==="failed"&&e.jsx("span",{className:"mr-1",children:"✗"}),t.status]})}),t.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-xs text-red-500 dark:text-red-400 text-center max-h-16 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold",children:"Error:"}),e.jsx("div",{children:t.error})]}),t.dependencies&&Array.isArray(t.dependencies)&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-semibold text-center",children:"Dependencies:"}),e.jsx("div",{className:"max-h-16 overflow-y-auto",children:t.dependencies.map((o,w)=>e.jsx("div",{className:"ml-2 truncate",children:o},w))})]}),t.flowMethod&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:[e.jsx("span",{className:"font-semibold",children:"Method:"})," ",t.flowMethod]})]})]})},Oe=({data:t})=>{const{ref:N,dimensions:h}=U();c.useEffect(()=>{h.width>0&&h.height>0&&(t.measured=h)},[h,t]);const f=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:N,className:`px-4 py-2 shadow-md rounded-md border bg-card overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:f,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"font-bold mb-2 text-center",children:"Flow Output"}),e.jsx("div",{className:"text-xs overflow-auto flex-1",children:t.output?JSON.stringify(t.output):"No output yet"})]})})},Ae=({data:t})=>{const{ref:N,dimensions:h}=U();c.useEffect(()=>{h.width>0&&h.height>0&&(t.measured=h)},[h,t]);const f=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:N,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:f,children:[!t.isFirst&&e.jsx(G,{type:"target",position:J.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(G,{type:"source",position:J.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[t.is_step&&e.jsx(Z,{variant:"secondary",className:"mr-2",children:"Step"}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),t.dependencies&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("div",{className:"font-medium text-center",children:"Dependencies:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1 justify-center max-h-16 overflow-y-auto",children:t.dependencies.map(m=>e.jsx(Z,{variant:"outline",className:"text-xs",children:m},m))})]})]})]})},Be=({flowId:t,isRunning:N,resetKey:h})=>{re();const[f,m,o]=ke(Me),[w,d,$]=$e(Te),[p,k]=c.useState(null),[C,v]=c.useState(null),[l,M]=c.useState(null),[T,_]=c.useState(null),[F,A]=c.useState(!1),[W,V]=c.useState("TB"),P=c.useCallback(()=>{if(f.length>0){const{nodes:s,edges:a}=B(f,w,W);m([...s]),d([...a]),setTimeout(()=>{const{nodes:i,edges:x}=B(s,a,W);m([...i]),d([...x])},100)}},[f,w,W,m,d]);c.useCallback(()=>{V(s=>s==="TB"?"LR":"TB"),setTimeout(()=>P(),100)},[V,P]);const[g,j]=c.useState(null),[y,S]=c.useState(!1),[H,ee]=c.useState(!1),[K,Y]=c.useState(null),te=c.useCallback(async s=>{if(s){ee(!0),_(null);try{const a=await fetch(`/api/initialize?flow_id=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}}),i=await a.json();if(!a.ok)throw new Error(i.detail||"Failed to initialize flow");return console.log("Flow initialization successful:",i),i.flow_id&&Y(i.flow_id),console.log("Flow initialized, waiting for structure via WebSocket..."),i}catch(a){throw console.error("Error initializing flow:",a),_(`Failed to initialize flow: ${a instanceof Error?a.message:String(a)}`),a}finally{ee(!1)}}},[]);c.useEffect(()=>{M(null),_(null),p&&(p.close(),k(null))},[h]),c.useEffect(()=>{if(!t)return;(async()=>{S(!0),_(null);try{const i=await(await fetch("/api/flows")).json();if(i.status==="success"&&!i.flows.some(n=>n.id===t)){_(`Flow with ID ${t} not found. Please select a valid flow.`),S(!1);return}await te(t)}catch(a){console.error("Error initializing flow:",a),_("Failed to initialize flow. Please try again.")}finally{S(!1)}})()},[t,te]),c.useEffect(()=>t?(console.log(`Setting up flow visualization WebSocket for flow: ${t}`),(()=>{const i=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/flow-visualization/${t}`;console.log(`Connecting to flow visualization WebSocket at ${i}`);const x=new WebSocket(i);x.onopen=()=>{console.log("Flow visualization WebSocket connection established"),x.send(JSON.stringify({type:"register_flow",flow_id:t})),x.send(JSON.stringify({type:"request_state"}))},x.onmessage=n=>{var E,I;try{const r=JSON.parse(n.data);if(console.log("Flow visualization WebSocket message:",r),r.type==="connection_established")console.log(`Flow visualization connection established with client ID: ${r.client_id}`);else if(r.type==="flow_registered")console.log(`Registered for flow visualization: ${r.flow_id}`);else if(r.type==="flow_initialization_requested")console.log("Flow initialization requested via visualization WebSocket:",r),r.flow_id&&Y(r.flow_id);else if(r.type==="flow_initialization_completed"){console.log("Flow initialization completed via visualization WebSocket:",r);const b=r.state;if(b&&b.structure){console.log("Received flow structure via visualization WebSocket:",b.structure);const D=((E=b.structure)==null?void 0:E.methods_info)||{},R=Object.values(D),O={id:r.flow_id,name:b.name||"Flow",description:b.description||"",methods:R,structure:b.structure,api_flow_id:r.api_flow_id};console.log("Creating visualization from WebSocket data:",O),j(b.structure),oe(O)}}else if(r.type==="flow_state"){console.log("Flow state update via visualization WebSocket:",r);const b=r.state;if(b&&(r.flow_id&&Y(r.flow_id),b.structure)){console.log("Updating flow structure from state:",b.structure);const D=((I=b.structure)==null?void 0:I.methods_info)||{},R=Object.values(D),O={id:r.flow_id,name:b.name||"Flow",description:b.description||"",methods:R,structure:b.structure,api_flow_id:r.api_flow_id};j(b.structure),oe(O)}}else typeof r=="object"&&r!==null&&("id"in r||"name"in r||"status"in r||"steps"in r)&&(console.log("Direct flow state update received:",r),M(b=>b?{...b,...r,steps:r.steps||b.steps||[]}:r))}catch(r){console.error("Error parsing flow visualization WebSocket message:",r)}},x.onerror=n=>{console.error("Flow visualization WebSocket error:",n)},x.onclose=n=>{console.log(`Flow visualization WebSocket connection closed: ${n.code} ${n.reason}`),v(null)},v(x)})(),()=>{C&&(console.log("Closing flow visualization WebSocket connection"),C.close(),v(null))}):void 0,[t,W]),c.useEffect(()=>{l&&(m(s=>{if(s.length===0)return s;new Map(s.map(n=>[n.id,n]));const a=[`flow-${l.id}`,`flow-${K}`,l.api_flow_id?`flow-${l.api_flow_id}`:null].filter(Boolean),i=[...s];let x=!1;for(const n of a){const E=s.findIndex(I=>I.id===n);if(E>=0){console.log(`Updating flow node with ID: ${n}, status: ${l.status}`),i[E]={...s[E],data:{...s[E].data,status:l.status}},x=!0;break}}return x||(console.warn("Flow node not found. Tried IDs:",a),console.warn("Available nodes:",s.map(n=>n.id))),l.steps.forEach(n=>{const E=`method-${n.id}`,I=s.findIndex(r=>r.id===E);I>=0&&(i[I]={...s[I],data:{...s[I].data,status:n.status,outputs:n.outputs,error:n.error},className:fe(n.status)})}),i}),d(s=>{const a=[...s];if(l.steps.forEach(i=>{const x=`method-${i.id}`;a.forEach((n,E)=>{(n.source===x||n.target===x)&&(a[E]={...n,animated:i.status==="running",style:{...n.style,stroke:ie(i.status),strokeWidth:i.status==="running"?3:2,opacity:i.status==="pending"?.6:1},markerEnd:n.markerEnd?{...n.markerEnd,color:ie(i.status)}:void 0})})}),l.status==="completed"&&l.outputs&&(typeof l.outputs=="string"?l.outputs.trim().length>0:Object.keys(l.outputs).length>0)&&!s.some(i=>i.id==="flow-to-output")){const i=`flow-${l.id}`;a.push({id:"flow-to-output",source:i,target:"output-node",type:"smoothstep",style:{stroke:"#4caf50",strokeWidth:2},markerEnd:{type:Q.ArrowClosed,color:"#4caf50"}})}return a}))},[l]);const[ue,se]=c.useState(!1);c.useEffect(()=>{if(f.length===0||ue&&(l==null?void 0:l.status)!=="pending")return;const s=f.some(x=>{var n;return((n=x.data)==null?void 0:n.measured)&&typeof x.data.measured=="object"&&"width"in x.data.measured&&"height"in x.data.measured}),{nodes:a,edges:i}=B(f,w,W);m(a),d(i),s?setTimeout(()=>{const{nodes:x,edges:n}=B(a,i,W);m(x),d(n),se(!0)},150):se(!0)},[f.length,w.length,W,l==null?void 0:l.status]);const ie=s=>{switch(s){case"running":return"#2196f3";case"completed":return"#4caf50";case"failed":return"#f44336";case"pending":return"#9e9e9e";case"initializing":return"#9c27b0";default:return"#9e9e9e"}},fe=s=>{switch(s){case"running":return"animate-pulse-subtle";case"initializing":return"animate-fade-in";default:return""}},oe=s=>{if(!s||!s.methods)return;const a=[],i=[],x={id:`flow-${s.id}`,type:"flowNode",position:{x:0,y:0},data:{label:s.name,status:"pending",id:s.id}};a.push(x);const n=200,E=0,I=150,r={};s.methods.forEach(u=>{r[u.name]=u});const b=new Set,D=new Set,R=[],O=u=>{if(D.has(u)||b.has(u))return;D.add(u);const z=r[u];z&&z.listens_to&&z.listens_to.length>0&&z.listens_to.forEach(q=>{r[q]&&O(q)}),D.delete(u),b.add(u),z&&R.push(z)};s.methods.forEach(u=>{O(u.name)}),R.forEach((u,z)=>{const q=I+z*n;a.push({id:`method-${u.name}`,type:"methodNode",position:{x:E,y:q},data:{label:u.name,description:u.description,is_start:u.is_start,is_listener:u.is_listener,is_router:u.is_router,listens_to:u.listens_to||[],status:u.status||"pending",isFirst:z===0,isLast:z===R.length-1}}),(!u.listens_to||u.listens_to.length===0||u.is_start)&&i.push({id:`edge-flow-${u.name}`,source:`flow-${s.id}`,target:`method-${u.name}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#2196f3"},style:{stroke:"#2196f3",strokeWidth:2}})}),R.forEach(u=>{u.listens_to&&u.listens_to.length>0&&u.listens_to.forEach(z=>{r[z]&&i.push({id:`edge-${z}-to-${u.name}`,source:`method-${z}`,target:`method-${u.name}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#ff9800"},style:{stroke:"#ff9800",strokeWidth:2,strokeDasharray:"5 5"}})})});const{nodes:me,edges:he}=B(a,i,W);m(me),d(he)};return e.jsxs(He,{className:"p-6 mb-6 overflow-hidden",children:[e.jsx("div",{className:"p-4 flex justify-between items-center flex-shrink-0",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Flow Visualization"}),K&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Internal Flow ID: ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-xs",children:K})]})]})}),(F||y||H)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-background/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H?"Initializing flow...":F?"Connecting to flow execution...":"Loading flow structure..."})]})}),T&&e.jsx("div",{className:"p-4",children:e.jsxs(le,{children:[e.jsx(ae,{children:"Error"}),e.jsx(ce,{children:T})]})}),!g&&f.length===0&&!F&&!y&&!T&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Flow Visualization"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a flow to visualize its structure."})]})}),e.jsx("div",{className:"h-[600px] border rounded-md overflow-hidden mb-6",children:e.jsxs(_e,{nodes:f,edges:w,onNodesChange:o,onEdgesChange:$,nodeTypes:Ve,fitView:!0,fitViewOptions:{padding:.2,includeHiddenNodes:!1,minZoom:.1,maxZoom:1.5},minZoom:.1,maxZoom:2,defaultViewport:{x:0,y:0,zoom:.8},children:[e.jsx(We,{}),e.jsx(Ie,{}),e.jsx(Ce,{})]})}),(l==null?void 0:l.status)==="completed"&&(l==null?void 0:l.outputs)&&(typeof l.outputs=="string"?l.outputs.trim().length>0:Object.keys(l.outputs).length>0)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Flow Results"}),e.jsx("div",{className:"p-6 rounded-lg border bg-card overflow-auto",children:e.jsx("div",{className:"text-base leading-7",children:typeof l.outputs=="string"?e.jsx(ne,{components:{h1:({...s})=>e.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4",...s}),h2:({...s})=>e.jsx("h2",{className:"text-xl font-bold mt-5 mb-3",...s}),h3:({...s})=>e.jsx("h3",{className:"text-lg font-bold mt-4 mb-2",...s}),p:({...s})=>e.jsx("p",{className:"mb-4",...s}),ul:({...s})=>e.jsx("ul",{className:"list-disc pl-6 mb-4",...s}),ol:({...s})=>e.jsx("ol",{className:"list-decimal pl-6 mb-4",...s}),li:({...s})=>e.jsx("li",{className:"mb-1",...s}),a:({...s})=>e.jsx("a",{className:"text-blue-500 hover:underline",...s}),blockquote:({...s})=>e.jsx("blockquote",{className:"border-l-4 border-muted pl-4 italic my-4",...s}),code:({children:s,className:a,...i})=>!/language-(\w+)/.exec(a||"")&&!(s!=null&&s.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...i,children:s}):e.jsx("pre",{className:"bg-muted p-4 rounded-md overflow-x-auto mb-4",children:e.jsx("code",{className:a,...i,children:s})})},children:l.outputs}):e.jsx("div",{className:"space-y-4",children:Object.entries(l.outputs).map(([s,a])=>e.jsxs("div",{className:"border-b border-muted pb-4 last:border-b-0",children:[e.jsx("h4",{className:"font-semibold text-sm uppercase tracking-wide text-muted-foreground mb-2",children:s}),e.jsx("div",{className:"text-sm",children:typeof a=="string"?e.jsx(ne,{components:{p:({...i})=>e.jsx("p",{className:"mb-2",...i}),code:({children:i,className:x,...n})=>!/language-(\w+)/.exec(x||"")&&!(i!=null&&i.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...n,children:i}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto mb-2",children:e.jsx("code",{className:x,...n,children:i})})},children:a}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto text-xs",children:JSON.stringify(a,null,2)})})]},s))})})})]})]})},Ve={flowNode:Le,stepNode:De,outputNode:Oe,methodNode:Ae};function rt(){return[{title:"CrewAI - Flow Mode"},{name:"description",content:"Run a flow directly with specific inputs"}]}const lt=pe(function(){re();const{flows:N,setFlows:h}=ge(),[f,m]=c.useState(!1),[o,w]=c.useState(""),[d,$]=c.useState(null),[p,k]=c.useState([]),[C,v]=c.useState(null),[l,M]=c.useState(null),[T,_]=c.useState(!1),[F,A]=c.useState(0);c.useEffect(()=>{_(!1),M(null),v(null),A(1)},[]),c.useEffect(()=>{(async()=>{m(!0);try{const y=await(await fetch("/api/flows")).json();y.flows&&(h(y.flows),y.flows.length>0?y.flows.some(H=>H.id===o)||w(y.flows[0].id):(w(""),$(null),k([]),v("No flows available. Please check your configuration.")))}catch(j){console.error("Error fetching flows:",j),v("Failed to fetch flows. Please try again later.")}finally{m(!1)}})()},[h]),c.useEffect(()=>{(async()=>{if(!o){$(null),k([]);return}try{m(!0);const j=N.find(H=>H.id===o);if(!j){v(`Flow with ID ${o} not found. Please select a valid flow.`),m(!1);return}const y=await fetch(`/api/initialize?flow_id=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!y.ok){y.status===404?v(`Flow with ID ${o} not found. Please select a valid flow.`):v(`Error initializing flow: ${y.statusText}`),m(!1);return}const S=await y.json();S.status==="success"?(console.log("Flow initialization successful:",S),$({id:j.id,name:j.name,description:j.description,required_inputs:S.required_inputs||[]}),k((S.required_inputs||[]).map(H=>({name:H.name,description:H.description,value:""})))):v(S.detail||"Failed to initialize flow")}catch(j){console.error("Error initializing flow:",j),v("Failed to initialize flow. Please try again later.")}finally{m(!1)}})()},[o,N]);const W=(g,j)=>{k(y=>y.map(S=>S.name===g?{...S,value:j}:S))},V=async g=>{if(g.preventDefault(),!o)return;m(!0),v(null),M(null),_(!0),A(y=>y+1);const j={};p.forEach(y=>{j[y.name]=y.value});try{const S=await(await fetch(`/api/flows/${o}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:j})})).json();S.status==="success"||v(S.detail||"Failed to run flow")}catch(y){console.error("Error running flow:",y),v("Failed to run flow. Please try again later.")}finally{m(!1)}},P=e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select a Flow"}),e.jsxs(Ne,{value:o,onValueChange:g=>{w(g),A(j=>j+1)},disabled:f,children:[e.jsx(ve,{id:"flow-select",className:"w-full",children:e.jsx(Se,{placeholder:"Select a flow"})}),e.jsx(Fe,{children:N.map(g=>e.jsx(Ee,{value:g.id,children:g.name},g.id))})]})]}),d&&e.jsxs("div",{className:"p-4 rounded-lg border bg-accent/50",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:d.description})]}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Required Inputs"}),p.map(g=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{htmlFor:g.name,children:g.name}),g.name.toLowerCase().includes("prompt")?e.jsx(je,{id:g.name,placeholder:g.description,value:g.value,onChange:j=>W(g.name,j.target.value),className:"min-h-[100px]"}):e.jsx(ye,{id:g.name,placeholder:g.description,value:g.value,onChange:j=>W(g.name,j.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.description})]},g.name)),e.jsx(xe,{type:"submit",className:"w-full",disabled:f||p.some(g=>!g.value),children:f?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Flow..."]}):"Run Flow"})]})]});return e.jsxs(we,{rightSidebar:P,children:[C&&e.jsxs(le,{variant:"destructive",className:"mb-6",children:[e.jsx(ae,{children:"Error"}),e.jsx(ce,{children:C})]}),o&&e.jsx(ze,{flowId:o}),o&&e.jsx(Be,{flowId:o,isRunning:T,resetKey:F}),!C&&!o&&e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Run a Flow Directly"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a flow from the sidebar, provide the required inputs, and run it to see results here."}),f&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"})})]})})]})});export{lt as default,rt as meta};
