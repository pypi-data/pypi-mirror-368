import{A as k,B as I,C as D,w as E,r as R,D as N,v as x}from"./chunk-GNGMS2XR-KLeu_BA0.js";function K(t){return function(){const e={params:E(),loaderData:D(),actionData:I(),matches:k()};return R.createElement(t,e)}}function Q(t){return function(){const e={params:E(),loaderData:D(),actionData:I()};return R.createElement(t,e)}}function Y(t){return function(){const e={params:E(),loaderData:D(),actionData:I(),error:N()};return R.createElement(t,e)}}const O=t=>{let r;const e=new Set,n=(u,y)=>{const g=typeof u=="function"?u(r):u;if(!Object.is(g,r)){const p=r;r=y??(typeof g!="object"||g===null)?g:Object.assign({},r,g),e.forEach(h=>h(r,p))}},a=()=>r,c={setState:n,getState:a,getInitialState:()=>f,subscribe:u=>(e.add(u),()=>e.delete(u))},f=r=t(n,a,c);return c},P=t=>t?O(t):O,M=t=>t;function F(t,r=M){const e=x.useSyncExternalStore(t.subscribe,()=>r(t.getState()),()=>r(t.getInitialState()));return x.useDebugValue(e),e}const _=t=>{const r=P(t),e=n=>F(r,n);return Object.assign(e,r),e},J=t=>t?_(t):_;function T(t,r){let e;try{e=t()}catch{return}return{getItem:a=>{var o;const l=f=>f===null?null:JSON.parse(f,void 0),c=(o=e.getItem(a))!=null?o:null;return c instanceof Promise?c.then(l):l(c)},setItem:(a,o)=>e.setItem(a,JSON.stringify(o,void 0)),removeItem:a=>e.removeItem(a)}}const H=t=>r=>{try{const e=t(r);return e instanceof Promise?e:{then(n){return H(n)(e)},catch(n){return this}}}catch(e){return{then(n){return this},catch(n){return H(n)(e)}}}},B=(t,r)=>(e,n,a)=>{let o={storage:T(()=>localStorage),partialize:s=>s,version:0,merge:(s,v)=>({...v,...s}),...r},l=!1;const c=new Set,f=new Set;let u=o.storage;if(!u)return t((...s)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),e(...s)},n,a);const y=()=>{const s=o.partialize({...n()});return u.setItem(o.name,{state:s,version:o.version})},g=a.setState;a.setState=(s,v)=>{g(s,v),y()};const p=t((...s)=>{e(...s),y()},n,a);a.getInitialState=()=>p;let h;const U=()=>{var s,v;if(!u)return;l=!1,c.forEach(d=>{var m;return d((m=n())!=null?m:p)});const S=((v=o.onRehydrateStorage)==null?void 0:v.call(o,(s=n())!=null?s:p))||void 0;return H(u.getItem.bind(u))(o.name).then(d=>{if(d)if(typeof d.version=="number"&&d.version!==o.version){if(o.migrate){const m=o.migrate(d.state,d.version);return m instanceof Promise?m.then(b=>[!0,b]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,d.state];return[!1,void 0]}).then(d=>{var m;const[b,j]=d;if(h=o.merge(j,(m=n())!=null?m:p),e(h,!0),b)return y()}).then(()=>{S==null||S(h,void 0),h=n(),l=!0,f.forEach(d=>d(h))}).catch(d=>{S==null||S(void 0,d)})};return a.persist={setOptions:s=>{o={...o,...s},s.storage&&(u=s.storage)},clearStorage:()=>{u==null||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>U(),hasHydrated:()=>l,onHydrate:s=>(c.add(s),()=>{c.delete(s)}),onFinishHydration:s=>(f.add(s),()=>{f.delete(s)})},o.skipHydration||U(),h||p},L=B;var C,A=new Uint8Array(16);function W(){if(!C&&(C=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!C))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(A)}const V=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function $(t){return typeof t=="string"&&V.test(t)}var i=[];for(var w=0;w<256;++w)i.push((w+256).toString(16).substr(1));function G(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(i[t[r+0]]+i[t[r+1]]+i[t[r+2]]+i[t[r+3]]+"-"+i[t[r+4]]+i[t[r+5]]+"-"+i[t[r+6]]+i[t[r+7]]+"-"+i[t[r+8]]+i[t[r+9]]+"-"+i[t[r+10]]+i[t[r+11]]+i[t[r+12]]+i[t[r+13]]+i[t[r+14]]+i[t[r+15]]).toLowerCase();if(!$(e))throw TypeError("Stringified UUID is invalid");return e}function X(t,r,e){t=t||{};var n=t.random||(t.rng||W)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,G(n)}const Z=J()(L((t,r)=>({flows:[],crews:[],currentCrewId:null,currentChatId:null,chatHistory:{},isDarkMode:!1,generateUUID:()=>X(),findChatByCrewId:e=>{const{chatHistory:n}=r(),l=Object.entries(n).sort((c,f)=>f[1].lastUpdated-c[1].lastUpdated).find(([c,f])=>f.crewId===e);return l?l[0]:null},setCrews:e=>t({crews:e}),setFlows:e=>t({flows:e}),setCurrentCrew:e=>t(n=>e===null||n.crews.some(a=>a.id===e)?{currentCrewId:e}:n),setCurrentChat:e=>t({currentChatId:e}),addMessage:(e,n)=>t(a=>{const o=a.chatHistory[e];return o?{chatHistory:{...a.chatHistory,[e]:{...o,messages:[...o.messages,n],lastUpdated:Date.now()}}}:a}),createChat:(e,n,a="New Chat")=>t(o=>{if(o.chatHistory[e])return o;const l=o.crews.find(c=>c.id===n);return{chatHistory:{...o.chatHistory,[e]:{id:e,title:a,crewId:n,crewName:l==null?void 0:l.name,messages:[],lastUpdated:Date.now()}}}}),deleteChat:e=>t(n=>{const{[e]:a,...o}=n.chatHistory;return{chatHistory:o}}),toggleDarkMode:()=>t(e=>({isDarkMode:!e.isDarkMode})),updateChatTitle:(e,n)=>t(a=>{const o=a.chatHistory[e];return o?{chatHistory:{...a.chatHistory,[e]:{...o,title:n}}}:a}),updateChatThread:(e,n)=>t(a=>{const o=a.chatHistory[e];return o?{chatHistory:{...a.chatHistory,[e]:{...o,...n,lastUpdated:Date.now()}}}:a})}),{name:"chat-storage",storage:{getItem:t=>{const r=localStorage.getItem(t);if(r===null)return null;try{return JSON.parse(r)}catch(e){return console.error("Error parsing stored data:",e),null}},setItem:(t,r)=>{try{localStorage.setItem(t,JSON.stringify(r))}catch(e){console.error("Error storing data:",e)}},removeItem:t=>localStorage.removeItem(t)},partialize:t=>t}));export{Q as a,Y as b,J as c,Z as u,K as w};
