import{w as le,u as ce}from"./store-BDLt0vbv.js";import{q as te,r as l,l as e}from"./chunk-GNGMS2XR-KLeu_BA0.js";import{B as de,L as ue}from"./Layout-CP5Hc7nX.js";import{L as me,T as fe,I as he}from"./textarea-CUBdk2de.js";import{S as pe,i as xe,j as ge,k as we,l as ye}from"./select-CrlOLXkx.js";import{F as je}from"./FlowNavigation-DHrQLs8L.js";import{A as se,a as ie,b as ne}from"./alert-DAr1l6eU.js";import"./tabs-BvsZBTz_.js";import{d as re,u as be,f as Ne,M as Q,i as ve,B as Se,c as Ee,e as $e,H as _,P as G}from"./index-K9TuxQyt.js";import{B as Z}from"./badge-CzGG4LGd.js";import{C as Fe}from"./card-DMpzrDC2.js";import{L as X}from"./play-BgHo1Tz0.js";import{M as ee}from"./index-ChbM4Wl4.js";import"./index-BKaxNvVC.js";import"./chevron-down-BlJJcPQY.js";import"./transform-BEtJ_6wc.js";const ke=[],We=[],R=new re.graphlib.Graph().setDefaultEdgeLabel(()=>({}));function He(t){let n=180,w=80;return t.forEach(a=>{var F,r,v,I,S,z,H;let W=220,c=100;if((F=a.data)!=null&&F.measured&&typeof a.data.measured=="object"&&"width"in a.data.measured&&"height"in a.data.measured){const b=a.data.measured;typeof b.width=="number"&&typeof b.height=="number"&&b.width>0&&b.height>0&&(W=b.width+20,c=b.height+10)}else{if((r=a.data)!=null&&r.label&&typeof a.data.label=="string"){const b=a.data.label.length;W=Math.max(180,b*12)}if((v=a.data)!=null&&v.description&&(c+=25),(I=a.data)!=null&&I.error&&(c+=40),(S=a.data)!=null&&S.dependencies&&Array.isArray(a.data.dependencies)&&(c+=30+a.data.dependencies.length*20),(z=a.data)!=null&&z.flowMethod&&(c+=25),(H=a.data)!=null&&H.outputs&&typeof a.data.outputs=="object"){const b=JSON.stringify(a.data.outputs).length;c+=Math.min(200,b/5)}}W=Math.max(180,Math.min(400,W)),c=Math.max(80,Math.min(400,c)),n=Math.max(n,W),w=Math.max(w,c)}),{width:n,height:w}}function q(t,j,u="TB"){if(t.length===0)return{nodes:[],edges:[],fullWidth:0,fullHeight:0};const{width:m,height:f}=He(t);R.setGraph({}),R.setGraph({rankdir:u,ranksep:100,nodesep:80}),t.forEach(c=>{R.removeNode(c.id)}),t.forEach(c=>{R.setNode(c.id,{width:m,height:f})}),j.forEach(c=>{R.setEdge(c.source,c.target)}),re.layout(R);const n=R.graph(),w=n&&n.width?n.width/2:0,a=n&&n.height?n.height/2:0;return{nodes:t.map(c=>{const F=R.node(c.id);return F?{...c,position:{x:F.x-m/2,y:F.y-f/2},data:{...c.data,uniformWidth:m,uniformHeight:f}}:(console.warn(`No dagre node found for id: ${c.id}`),c)}),edges:j,fullWidth:w,fullHeight:a}}function Y(){const t=l.useRef(null),[j,u]=l.useState({width:0,height:0});return l.useEffect(()=>{const m=()=>{if(t.current){const{offsetWidth:w,offsetHeight:a}=t.current;w>0&&a>0&&u({width:w,height:a})}},f=setTimeout(m,0);let n=null;try{n=new ResizeObserver(()=>{t.current&&m()}),t.current&&n.observe(t.current)}catch(w){console.error("ResizeObserver error:",w)}return()=>{if(clearTimeout(f),n&&t.current)try{n.unobserve(t.current),n.disconnect()}catch(w){console.error("Error cleaning up ResizeObserver:",w)}}},[]),{ref:t,dimensions:j}}const Te=({data:t})=>{const{ref:j,dimensions:u}=Y();l.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const m=n=>{switch(n){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}},f=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:j,className:`px-4 py-2 shadow-md rounded-md border bg-card flex flex-col justify-center ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:f,children:e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${m(t.status)}`}),e.jsx("div",{className:"font-bold text-lg text-center",children:t.label})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":"outline",children:t.status})})]})})},Ce=({data:t})=>{const{ref:j,dimensions:u}=Y();l.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const m=n=>{switch(n){case"running":return"bg-blue-500";case"completed":return"bg-green-500";case"failed":return"bg-red-500";case"initializing":return"bg-purple-500";case"pending":return"bg-gray-500";default:return"bg-gray-500"}},f=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:j,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:f,children:[!t.isFirst&&e.jsx(_,{type:"target",position:G.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(_,{type:"source",position:G.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${m(t.status)}`}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsxs(Z,{variant:t.status==="running"?"secondary":t.status==="completed"?"outline":t.status==="failed"?"destructive":t.status==="initializing"?"default":"outline",className:`${t.status==="completed"?"bg-green-100 text-green-800 border-green-500 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":""} ${t.status==="running"?"animate-pulse":""}`,children:[t.status==="running"&&e.jsx("span",{className:"mr-1",children:"⚡"}),t.status==="completed"&&e.jsx("span",{className:"mr-1",children:"✓"}),t.status==="failed"&&e.jsx("span",{className:"mr-1",children:"✗"}),t.status]})}),t.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-xs text-red-500 dark:text-red-400 text-center max-h-16 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold",children:"Error:"}),e.jsx("div",{children:t.error})]}),t.dependencies&&Array.isArray(t.dependencies)&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-semibold text-center",children:"Dependencies:"}),e.jsx("div",{className:"max-h-16 overflow-y-auto",children:t.dependencies.map((n,w)=>e.jsx("div",{className:"ml-2 truncate",children:n},w))})]}),t.flowMethod&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:[e.jsx("span",{className:"font-semibold",children:"Method:"})," ",t.flowMethod]})]})]})},Me=({data:t})=>{const{ref:j,dimensions:u}=Y();l.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const m=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsx("div",{ref:j,className:`px-4 py-2 shadow-md rounded-md border bg-card overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:m,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"font-bold mb-2 text-center",children:"Flow Output"}),e.jsx("div",{className:"text-xs overflow-auto flex-1",children:t.output?JSON.stringify(t.output):"No output yet"})]})})},Ae=({data:t})=>{const{ref:j,dimensions:u}=Y();l.useEffect(()=>{u.width>0&&u.height>0&&(t.measured=u)},[u,t]);const m=t.uniformWidth&&t.uniformHeight?{width:`${t.uniformWidth}px`,height:`${t.uniformHeight}px`,minWidth:`${t.uniformWidth}px`,minHeight:`${t.uniformHeight}px`}:{};return e.jsxs("div",{ref:j,className:`px-4 py-2 shadow-md rounded-md border bg-card relative overflow-hidden ${t.uniformWidth&&t.uniformHeight?"uniform-sized":""}`,style:m,children:[!t.isFirst&&e.jsx(_,{type:"target",position:G.Top,className:"w-2 h-2 bg-slate-500"}),!t.isLast&&e.jsx(_,{type:"source",position:G.Bottom,className:"w-2 h-2 bg-slate-500"}),e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[t.is_step&&e.jsx(Z,{variant:"secondary",className:"mr-2",children:"Step"}),e.jsx("div",{className:"font-bold text-center truncate",children:t.label})]}),t.description&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground text-center truncate",children:t.description}),t.dependencies&&t.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("div",{className:"font-medium text-center",children:"Dependencies:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1 justify-center max-h-16 overflow-y-auto",children:t.dependencies.map(f=>e.jsx(Z,{variant:"outline",className:"text-xs",children:f},f))})]})]})]})},Le=({flowId:t,isRunning:j,resetKey:u})=>{te();const[m,f,n]=be(ke),[w,a,W]=Ne(We),[c,F]=l.useState(null),[r,v]=l.useState(null),[I,S]=l.useState(null),[z,H]=l.useState(!1),[b,P]=l.useState("TB"),B=l.useCallback(()=>{if(m.length>0){const{nodes:s,edges:p}=q(m,w,b);f([...s]),a([...p]),setTimeout(()=>{const{nodes:i,edges:d}=q(s,p,b);f([...i]),a([...d])},100)}},[m,w,b,f,a]);l.useCallback(()=>{P(s=>s==="TB"?"LR":"TB"),setTimeout(()=>B(),100)},[P,B]);const[K,U]=l.useState(null),[h,g]=l.useState(!1);l.useEffect(()=>{v(null),S(null),c&&(c.close(),F(null))},[u]),l.useEffect(()=>{if(!t)return;(async()=>{g(!0),S(null);try{const i=await(await fetch("/api/flows")).json();if(i.status==="success"&&!i.flows.some(E=>E.id===t)){S(`Flow with ID ${t} not found. Please select a valid flow.`),g(!1);return}const d=await fetch(`/api/flows/${t}/structure`);if(!d.ok){d.status===404?S(`Flow with ID ${t} not found. Please select a valid flow.`):S(`Error fetching flow structure: ${d.statusText}`),g(!1);return}const o=await d.json();o.status==="success"&&o.flow?(U(o.flow),ae(o.flow)):S(o.detail||"Failed to fetch flow structure")}catch(p){console.error("Error fetching flow structure:",p),S("Failed to fetch flow structure. Please try again.")}finally{g(!1)}})()},[t]),l.useEffect(()=>{if(!t||!j)return;H(!0),S(null);let s=0;const p=3;let i=null;const d=()=>{const A=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/flow/${t}`,E=new WebSocket(A),T=setTimeout(()=>{E.readyState!==WebSocket.OPEN&&(console.warn("WebSocket connection timeout"),E.close(),s<p?(s++,i=setTimeout(d,1e3)):(S("Failed to connect to flow execution after multiple attempts. Please try again."),H(!1)))},5e3);E.onopen=()=>{clearTimeout(T),H(!1)},E.onmessage=L=>{try{const N=JSON.parse(L.data);N.type==="flow_state"?v(D=>{if(!D)return N.payload;const C=JSON.parse(JSON.stringify(D));if(C.status=N.payload.status,N.payload.outputs&&(C.outputs=N.payload.outputs),N.payload.steps&&Array.isArray(N.payload.steps)){const V=new Map(C.steps.map(O=>[O.id,O]));N.payload.steps.forEach(O=>{V.set(O.id,{...V.get(O.id)||{},...O})}),C.steps=Array.from(V.values())}return N.payload.errors&&Array.isArray(N.payload.errors)&&(C.errors=[...C.errors||[],...N.payload.errors]),C}):N.type==="error"&&S(N.message||"An error occurred during flow execution")}catch(N){console.error("Error parsing WebSocket message:",N)}},E.onerror=L=>{console.error("WebSocket error:",L),clearTimeout(T),s>=p&&(S("Failed to connect to flow execution. Please try again."),H(!1))},E.onclose=L=>{clearTimeout(T),L.code!==1e3&&L.code!==1001&&s<p&&(s++,i=setTimeout(d,1e3))},F(E)};return d(),()=>{c&&c.close(),i&&clearTimeout(i)}},[t,j,u]),l.useEffect(()=>{r&&(f(s=>{if(s.length===0)return s;new Map(s.map(o=>[o.id,o]));const p=`flow-${r.id}`,i=[...s],d=s.findIndex(o=>o.id===p);return d>=0&&(i[d]={...s[d],data:{...s[d].data,status:r.status}}),r.steps.forEach(o=>{const A=`method-${o.id}`,E=s.findIndex(T=>T.id===A);E>=0&&(i[E]={...s[E],data:{...s[E].data,status:o.status,outputs:o.outputs,error:o.error},className:oe(o.status)})}),i}),a(s=>{const p=[...s];if(r.steps.forEach(i=>{const d=`method-${i.id}`;p.forEach((o,A)=>{(o.source===d||o.target===d)&&(p[A]={...o,animated:i.status==="running",style:{...o.style,stroke:M(i.status),strokeWidth:i.status==="running"?3:2,opacity:i.status==="pending"?.6:1},markerEnd:o.markerEnd?{...o.markerEnd,color:M(i.status)}:void 0})})}),r.status==="completed"&&r.outputs&&(typeof r.outputs=="string"?r.outputs.trim().length>0:Object.keys(r.outputs).length>0)&&!s.some(i=>i.id==="flow-to-output")){const i=`flow-${r.id}`;p.push({id:"flow-to-output",source:i,target:"output-node",type:"smoothstep",style:{stroke:"#4caf50",strokeWidth:2},markerEnd:{type:Q.ArrowClosed,color:"#4caf50"}})}return p}))},[r]);const[y,$]=l.useState(!1);l.useEffect(()=>{if(m.length===0||y&&(r==null?void 0:r.status)!=="pending")return;const s=m.some(d=>{var o;return((o=d.data)==null?void 0:o.measured)&&typeof d.data.measured=="object"&&"width"in d.data.measured&&"height"in d.data.measured}),{nodes:p,edges:i}=q(m,w,b);f(p),a(i),s?setTimeout(()=>{const{nodes:d,edges:o}=q(p,i,b);f(d),a(o),$(!0)},150):$(!0)},[m.length,w.length,b,r==null?void 0:r.status]);const M=s=>{switch(s){case"running":return"#2196f3";case"completed":return"#4caf50";case"failed":return"#f44336";case"pending":return"#9e9e9e";case"initializing":return"#9c27b0";default:return"#9e9e9e"}},oe=s=>{switch(s){case"running":return"animate-pulse-subtle";case"initializing":return"animate-fade-in";default:return""}},ae=s=>{if(!s||!s.methods)return;const p=[],i=[],d={id:`flow-${s.id}`,type:"flowNode",position:{x:0,y:0},data:{label:s.name,status:"pending",id:s.id}};p.push(d);const o=200,A=0,E=150,T={};s.methods.forEach(x=>{T[x.id]=x});const L=new Set,N=new Set,D=[],C=x=>{if(N.has(x)||L.has(x))return;N.add(x);const k=T[x];k&&k.dependencies&&k.dependencies.forEach(J=>{T[J]&&C(J)}),N.delete(x),L.add(x),k&&D.push(k)};s.methods.forEach(x=>{C(x.id)}),D.forEach((x,k)=>{const J=E+k*o;p.push({id:`method-${x.id}`,type:"methodNode",position:{x:A,y:J},data:{label:x.name,description:x.description,is_step:x.is_step,dependencies:x.dependencies||[],isFirst:k===0,isLast:k===D.length-1}}),(!x.dependencies||x.dependencies.length===0)&&i.push({id:`edge-flow-${x.id}`,source:`flow-${s.id}`,target:`method-${x.id}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#2196f3"},style:{stroke:"#2196f3",strokeWidth:2}})}),D.forEach(x=>{x.dependencies&&x.dependencies.length>0&&x.dependencies.forEach(k=>{T[k]&&i.push({id:`edge-${k}-to-${x.id}`,source:`method-${k}`,target:`method-${x.id}`,type:"smoothstep",markerEnd:{type:Q.ArrowClosed,color:"#ff9800"},style:{stroke:"#ff9800",strokeWidth:2,strokeDasharray:"5 5"}})})});const{nodes:V,edges:O}=q(p,i,b);f(V),a(O)};return e.jsxs(Fe,{className:"p-6 mb-6 overflow-hidden",children:[e.jsx("div",{className:"p-4 flex justify-between items-center flex-shrink-0",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Flow Visualization"})}),(z||h)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-background/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:z?"Connecting to flow execution...":"Loading flow structure..."})]})}),I&&e.jsx("div",{className:"p-4",children:e.jsxs(se,{children:[e.jsx(ie,{children:"Error"}),e.jsx(ne,{children:I})]})}),!K&&m.length===0&&!z&&!h&&!I&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Flow Visualization"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a flow to visualize its structure."})]})}),e.jsx("div",{className:"h-[600px] border rounded-md overflow-hidden mb-6",children:e.jsxs(ve,{nodes:m,edges:w,onNodesChange:n,onEdgesChange:W,nodeTypes:ze,fitView:!0,fitViewOptions:{padding:.2,includeHiddenNodes:!1,minZoom:.1,maxZoom:1.5},minZoom:.1,maxZoom:2,defaultViewport:{x:0,y:0,zoom:.8},children:[e.jsx(Se,{}),e.jsx(Ee,{}),e.jsx($e,{})]})}),(r==null?void 0:r.status)==="completed"&&(r==null?void 0:r.outputs)&&(typeof r.outputs=="string"?r.outputs.trim().length>0:Object.keys(r.outputs).length>0)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Flow Results"}),e.jsx("div",{className:"p-6 rounded-lg border bg-card overflow-auto",children:e.jsx("div",{className:"text-base leading-7",children:typeof r.outputs=="string"?e.jsx(ee,{components:{h1:({...s})=>e.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4",...s}),h2:({...s})=>e.jsx("h2",{className:"text-xl font-bold mt-5 mb-3",...s}),h3:({...s})=>e.jsx("h3",{className:"text-lg font-bold mt-4 mb-2",...s}),p:({...s})=>e.jsx("p",{className:"mb-4",...s}),ul:({...s})=>e.jsx("ul",{className:"list-disc pl-6 mb-4",...s}),ol:({...s})=>e.jsx("ol",{className:"list-decimal pl-6 mb-4",...s}),li:({...s})=>e.jsx("li",{className:"mb-1",...s}),a:({...s})=>e.jsx("a",{className:"text-blue-500 hover:underline",...s}),blockquote:({...s})=>e.jsx("blockquote",{className:"border-l-4 border-muted pl-4 italic my-4",...s}),code:({children:s,className:p,...i})=>!/language-(\w+)/.exec(p||"")&&!(s!=null&&s.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...i,children:s}):e.jsx("pre",{className:"bg-muted p-4 rounded-md overflow-x-auto mb-4",children:e.jsx("code",{className:p,...i,children:s})})},children:r.outputs}):e.jsx("div",{className:"space-y-4",children:Object.entries(r.outputs).map(([s,p])=>e.jsxs("div",{className:"border-b border-muted pb-4 last:border-b-0",children:[e.jsx("h4",{className:"font-semibold text-sm uppercase tracking-wide text-muted-foreground mb-2",children:s}),e.jsx("div",{className:"text-sm",children:typeof p=="string"?e.jsx(ee,{components:{p:({...i})=>e.jsx("p",{className:"mb-2",...i}),code:({children:i,className:d,...o})=>!/language-(\w+)/.exec(d||"")&&!(i!=null&&i.toString().includes(`
`))?e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",...o,children:i}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto mb-2",children:e.jsx("code",{className:d,...o,children:i})})},children:p}):e.jsx("pre",{className:"bg-muted p-2 rounded-md overflow-x-auto text-xs",children:JSON.stringify(p,null,2)})})]},s))})})})]})]})},ze={flowNode:Te,stepNode:Ce,outputNode:Me,methodNode:Ae};function Xe(){return[{title:"CrewAI - Flow Mode"},{name:"description",content:"Run a flow directly with specific inputs"}]}const et=le(function(){te();const{flows:j,setFlows:u}=ce(),[m,f]=l.useState(!1),[n,w]=l.useState(""),[a,W]=l.useState(null),[c,F]=l.useState([]),[r,v]=l.useState(null),[I,S]=l.useState(null),[z,H]=l.useState(!1),[b,P]=l.useState(0);l.useEffect(()=>{H(!1),S(null),v(null),P(1)},[]),l.useEffect(()=>{(async()=>{f(!0);try{const y=await(await fetch("/api/flows")).json();y.flows&&(u(y.flows),y.flows.length>0?y.flows.some(M=>M.id===n)||w(y.flows[0].id):(w(""),W(null),F([]),v("No flows available. Please check your configuration.")))}catch(g){console.error("Error fetching flows:",g),v("Failed to fetch flows. Please try again later.")}finally{f(!1)}})()},[u]),l.useEffect(()=>{(async()=>{if(!n){W(null),F([]);return}try{f(!0);const g=j.find(M=>M.id===n);if(!g){v(`Flow with ID ${n} not found. Please select a valid flow.`),f(!1);return}const y=await fetch(`/api/flows/${n}/initialize`);if(!y.ok){y.status===404?v(`Flow with ID ${n} not found. Please select a valid flow.`):v(`Error fetching flow details: ${y.statusText}`),f(!1);return}const $=await y.json();$.status==="success"?(W({id:g.id,name:g.name,description:g.description,required_inputs:$.required_inputs||[]}),F(($.required_inputs||[]).map(M=>({name:M.name,description:M.description,value:""})))):v($.detail||"Failed to fetch flow details")}catch(g){console.error("Error fetching flow details:",g),v("Failed to fetch flow details. Please try again later.")}finally{f(!1)}})()},[n,j]);const B=(h,g)=>{F(y=>y.map($=>$.name===h?{...$,value:g}:$))},K=async h=>{if(h.preventDefault(),!n)return;f(!0),v(null),S(null),H(!0),P(y=>y+1);const g={};c.forEach(y=>{g[y.name]=y.value});try{const $=await(await fetch(`/api/flows/${n}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:g})})).json();$.status==="success"||v($.detail||"Failed to run flow")}catch(y){console.error("Error running flow:",y),v("Failed to run flow. Please try again later.")}finally{f(!1)}},U=e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select a Flow"}),e.jsxs(pe,{value:n,onValueChange:h=>{w(h),P(g=>g+1)},disabled:m,children:[e.jsx(xe,{id:"flow-select",className:"w-full",children:e.jsx(ge,{placeholder:"Select a flow"})}),e.jsx(we,{children:j.map(h=>e.jsx(ye,{value:h.id,children:h.name},h.id))})]})]}),a&&e.jsxs("div",{className:"p-4 rounded-lg border bg-accent/50",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:a.description})]}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Required Inputs"}),c.map(h=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:h.name,children:h.name}),h.name.toLowerCase().includes("prompt")?e.jsx(fe,{id:h.name,placeholder:h.description,value:h.value,onChange:g=>B(h.name,g.target.value),className:"min-h-[100px]"}):e.jsx(he,{id:h.name,placeholder:h.description,value:h.value,onChange:g=>B(h.name,g.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h.description})]},h.name)),e.jsx(de,{type:"submit",className:"w-full",disabled:m||c.some(h=>!h.value),children:m?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Flow..."]}):"Run Flow"})]})]});return e.jsxs(ue,{rightSidebar:U,children:[r&&e.jsxs(se,{variant:"destructive",className:"mb-6",children:[e.jsx(ie,{children:"Error"}),e.jsx(ne,{children:r})]}),n&&e.jsx(je,{flowId:n}),n&&e.jsx(Le,{flowId:n,isRunning:z,resetKey:b}),!r&&!n&&e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Run a Flow Directly"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a flow from the sidebar, provide the required inputs, and run it to see results here."}),m&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"})})]})})]})});export{et as default,Xe as meta};
