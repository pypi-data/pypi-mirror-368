[tox]
requires = tox>=4
env_list = 
    py313-django{52, 51}
    py312-django{52, 51, 50, 42}
    py311-django{52, 51, 50, 42}
    py310-django{52, 51, 50, 42}

[testenv]
; runner = uv-venv-lock-runner
package = wheel
wheel_build_env = .pkg
set_env =
    PYTHONDEVMODE = 1
deps =
    django42: django>=4.2,<4.3
    django50: django>=5.0,<5.1
    django51: django>=5.1,<5.2
    django52: django>=5.2,<5.3
    pytest>=7.0
    pytest-django>=4.5
    pytest-cov>=4.0
    pytest-mock
    factory-boy
    freezegun
    model-bakery
commands =
    pytest tests/ -v --cov=logmancer --cov-report=term-missing

[testenv:lint]
deps =
    flake8>=6.0
    black>=23.0
    isort>=5.12
    bandit[toml]
allowlist_externals = python
commands =
    flake8 logmancer/
    black --check logmancer/
    isort --check-only logmancer/
    bandit -r logmancer/ -ll

[testenv:format]
deps =
    black>=23.0
    isort>=5.12
allowlist_externals = python
commands =
    black logmancer/ tests/
    isort logmancer/ tests/

[testenv:coverage]
deps = 
    {[testenv]deps}
    coverage[toml]>=7.0
allowlist_externals = python
commands =
    coverage run --source=logmancer -m pytest tests/
    coverage report --show-missing --fail-under=80
    coverage html -d htmlcov
    coverage xml
